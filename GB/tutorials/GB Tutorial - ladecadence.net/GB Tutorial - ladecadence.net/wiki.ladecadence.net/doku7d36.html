<!DOCTYPE html>
<html lang="es" dir="ltr" class="no-js">

<!-- Mirrored from wiki.ladecadence.net/doku.php?id=tutorial_de_ensamblador by HTTraQt Website Copier/1.x [Karbofos 2012-2017] Sun, 14 Apr 2019 02:33:41 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8" />
    <title>tutorial_de_ensamblador [La decadence]</title>
    <script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script>
    <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="keywords" content="tutorial_de_ensamblador"/>
<link rel="search" type="application/opensearchdescription+xml" href="lib/exe/opensearch.php" title="La decadence"/>
<link rel="start" href="index.html"/>
<link rel="contents" href="doku208b.html?id=tutorial_de_ensamblador&amp;do=index" title="Índice"/>
<link rel="alternate" type="application/rss+xml" title="Cambios recientes" href="feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Espacio de nombres actual" href="feed8be0.php?mode=list&amp;ns="/>
<link rel="alternate" type="text/html" title="HTML sencillo" href="doku957f.html?do=export_xhtml&amp;id=tutorial_de_ensamblador"/>
<link rel="alternate" type="text/plain" title="Etiquetado Wiki" href="tutorial_de_ensamblador7a3f.txt?do=export_raw&amp;id=tutorial_de_ensamblador"/>
<link rel="canonical" href="doku7d36.html?id=tutorial_de_ensamblador"/>
<link rel="stylesheet" type="text/css" href="lib/exe/css1a12.css?t=dokuwiki&amp;tseed=248b811c2b302349cd4a24bf6679b0bf"/>
<!--[if gte IE 9]><!-->
<script type="text/javascript">/*<![CDATA[*/var NS='';var JSINFO = {"id":"tutorial_de_ensamblador","namespace":""};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="lib/exe/jquery5543.php?tseed=38e996c870c1e0ebbe9b13928b7ba9b8"></script>
<script type="text/javascript" charset="utf-8" src="lib/exe/js1a12.php?t=dokuwiki&amp;tseed=248b811c2b302349cd4a24bf6679b0bf"></script>
<!--<![endif]-->
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="lib/tpl/dokuwiki/images/favicon.ico" />
<link rel="apple-touch-icon" href="lib/tpl/dokuwiki/images/apple-touch-icon.png" />
    </head>

<body>
    <div id="dokuwiki__site"><div id="dokuwiki__top" class="site dokuwiki mode_show tpl_dokuwiki     ">

        
<!-- ********** HEADER ********** -->
<div id="dokuwiki__header"><div class="pad group">

    
    <div class="headings group">
        <ul class="a11y skip">
            <li><a href="#dokuwiki__content">Saltar a contenido</a></li>
        </ul>

        <h1><a href="dokud459.html?id=LaDecadence"  accesskey="h" title="[H]"><img src="lib/tpl/dokuwiki/images/logo.png" width="64" height="64" alt="" /> <span>La decadence</span></a></h1>
            </div>

    <div class="tools group">
        <!-- USER TOOLS -->
                    <div id="dokuwiki__usertools">
                <h3 class="a11y">Herramientas de usuario</h3>
                <ul>
                    <li><a href="doku8cbc.html?id=tutorial_de_ensamblador&amp;do=login&amp;sectok=c477e5214f82cd344510c4edf74ef4e8"  class="action login" rel="nofollow" title="Conectarse">Conectarse</a></li>                </ul>
            </div>
        
        <!-- SITE TOOLS -->
        <div id="dokuwiki__sitetools">
            <h3 class="a11y">Herramientas del sitio</h3>
            <form action="../external.html?link=http://wiki.ladecadence.net/doku.php?id=LaDecadence" accept-charset="utf-8" class="search" id="dw__search" method="get" role="search"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" placeholder="Buscar" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><button type="submit" title="Buscar">Buscar</button><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>            <div class="mobileTools">
                <form action="../external.html?link=http://wiki.ladecadence.net/doku.php" method="get" accept-charset="utf-8"><div class="no"><input type="hidden" name="id" value="tutorial_de_ensamblador" /><select name="do" class="edit quickselect" title="Herramientas"><option value="">Herramientas</option><optgroup label="Herramientas de la página"><option value="edit">Ver la fuente de esta página</option><option value="revisions">Revisiones antiguas</option><option value="backlink">Enlaces a esta página</option></optgroup><optgroup label="Herramientas del sitio"><option value="recent">Cambios recientes</option><option value="media">Administrador de Ficheros</option><option value="index">Índice</option></optgroup><optgroup label="Herramientas de usuario"><option value="login">Conectarse</option></optgroup></select><button type="submit">&gt;</button></div></form>            </div>
            <ul>
                <li><a href="doku10e2.html?id=tutorial_de_ensamblador&amp;do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Cambios recientes [R]">Cambios recientes</a></li><li><a href="dokuf53e.html?id=tutorial_de_ensamblador&amp;do=media&amp;ns="  class="action media" rel="nofollow" title="Administrador de Ficheros">Administrador de Ficheros</a></li><li><a href="doku208b.html?id=tutorial_de_ensamblador&amp;do=index"  class="action index" accesskey="x" rel="nofollow" title="Índice [X]">Índice</a></li>            </ul>
        </div>

    </div>

    <!-- BREADCRUMBS -->
            <div class="breadcrumbs">
                                        <div class="trace"><span class="bchead">Traza:</span> <span class="bcsep">•</span> <span class="curid"><bdi><a href="doku7d36.html?id=tutorial_de_ensamblador"  class="breadcrumbs" title="tutorial_de_ensamblador">tutorial_de_ensamblador</a></bdi></span></div>
                    </div>
    


    <hr class="a11y" />
</div></div><!-- /header -->

        <div class="wrapper group">

            
            <!-- ********** CONTENT ********** -->
            <div id="dokuwiki__content"><div class="pad group">
                
                <div class="pageId"><span>tutorial_de_ensamblador</span></div>

                <div class="page group">
                                                            <!-- wikipage start -->
                    <!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Tabla de Contenidos</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="#introduccion">Introducción</a></div>
<ul class="toc">
<li class="clear">
<ul class="toc">
<li class="level3"><div class="li"><a href="#nintendo_gameboy_dmg">Nintendo Gameboy (DMG)</a></div></li>
<li class="level3"><div class="li"><a href="#gbz80">GBz80</a></div></li>
<li class="level3"><div class="li"><a href="#mapa_de_memoria">Mapa de memoria</a></div></li>
<li class="level3"><div class="li"><a href="#organizacion_de_una_rom_de_gameboy">Organización de una ROM de GameBoy</a></div></li>
<li class="level3"><div class="li"><a href="#sistema_de_video">Sistema de vídeo</a></div></li>
<li class="level3"><div class="li"><a href="#fondos">Fondos</a></div></li>
<li class="level3"><div class="li"><a href="#sprites">Sprites</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#herramientas">Herramientas</a></div>
<ul class="toc">
<li class="clear">
<ul class="toc">
<li class="level3"><div class="li"><a href="#ensamblador">Ensamblador</a></div></li>
<li class="level3"><div class="li"><a href="#editor">Editor</a></div></li>
<li class="level3"><div class="li"><a href="#emulador">Emulador</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#hola_mundo">Hola mundo</a></div>
<ul class="toc">
<li class="clear">
<ul class="toc">
<li class="level3"><div class="li"><a href="#codigo">Código</a></div></li>
<li class="level3"><div class="li"><a href="#explicacion">Explicación</a></div></li>
<li class="level3"><div class="li"><a href="#mejoras">Mejoras</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#hola_sprites">Hola sprites</a></div></li>
<li class="level1"><div class="li"><a href="#hola_joypad">Hola JoyPad</a></div></li>
<li class="level1"><div class="li"><a href="#hola_ventana">Hola Ventana</a></div></li>
<li class="level1"><div class="li"><a href="#hola_timer">Hola Timer</a></div>
<ul class="toc">
<li class="clear">
<ul class="toc">
<li class="level3"><div class="li"><a href="#explicacion1">Explicación</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#hola_bancos">Hola Bancos</a></div></li>
<li class="level1"><div class="li"><a href="#hola_sonido">Hola Sonido</a></div>
<ul class="toc">
<li class="clear">
<ul class="toc">
<li class="level3"><div class="li"><a href="#canal_1_-_tono_y_portamento">Canal 1 - Tono y portamento</a></div></li>
<li class="level3"><div class="li"><a href="#canal_2_-_tono">Canal 2 - Tono</a></div></li>
<li class="level3"><div class="li"><a href="#canal_3_-_onda_programable">Canal 3 - Onda programable</a></div></li>
<li class="level3"><div class="li"><a href="#canal_4_-_ruido">Canal 4 - Ruido</a></div></li>
<li class="level3"><div class="li"><a href="#registros_de_control_generales_del_sonido">Registros de control generales del sonido</a></div></li>
<li class="level3"><div class="li"><a href="#ejemplo">Ejemplo</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"><a href="#hola_color">Hola Color</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="introduccion">Introducción</h1>
<div class="level1">
<pre class="code">    NINTENDO
   ______                     ____             
  / ____/___ _____ ___  ___  / __ )____  __  __
 / / __/ __ `/ __ `__ \/ _ \/ __  / __ \/ / / /
/ /_/ / /_/ / / / / / /  __/ /_/ / /_/ / /_/ / 
\____/\__,_/_/ /_/ /_/\___/_____/\____/\__, /  
                                      /____/   
			Tutorial de programación
			Por David Pello (ladecadence.net)


             _n_________________     
            |_|_______________|_|    
            |  ,-------------.  |    
            | |  .---------.  | |    
            | |  |         |  | |    
            | |  |         |  | |    
            | |  |         |  | |    
            | |  |         |  | |    
            | |  `---------&#039;  | |   
            | `---------------&#039; |  
            |   _ GAME BOY      |    
            | _| |_         ,-. |    
            ||_ O _|   ,-. &quot;._,&quot;|    
            |  |_|    &quot;._,&quot;   A | 
            |      _  _  B      |
            |     // //         |    
            |    // //  \\\\\\  |    
            |    `  `    \\\\\\ ,    
            |________...______,&quot;     </pre>

</div>

<h3 class="sectionedit2" id="nintendo_gameboy_dmg">Nintendo Gameboy (DMG)</h3>
<div class="level3">

<p>
Para empezar este tutorial de desarrollo para la gameboy, vamos a repasar un poco las caracteristicas técnicas de nuestra maravillosa consola:
</p>
<ul>
<li class="level1"><div class="li"> CPU: 8-bit Sharp LR35902 (Similar al Z80) a 4.19 <abbr title="Megahertz">MHz</abbr></div>
</li>
<li class="level1"><div class="li"> 8K de RAM principal</div>
</li>
<li class="level1"><div class="li"> 8K de Video RAM</div>
</li>
<li class="level1"><div class="li"> 2.6“ LCD 160&times;144, 4 Tonos</div>
</li>
<li class="level1"><div class="li"> Sonido estéreo, 4 Canales</div>
</li>
<li class="level1"><div class="li"> Puerto serie (ext)</div>
</li>
<li class="level1"><div class="li"> 6V, 0.7A</div>
</li>
<li class="level1"><div class="li"> 90 mm x 148 x 32 mm</div>
</li>
</ul>

<p>
Bien, en el corazón de la GameBoy, tenemos una cpu propia fabricada por Sharp para Nintendo, con el nombre técnico de LR35902, tenemos un microprocesador a caballo entre el 8080 y el Z80, ya que aunque no tiene los juegos extra de registros del Z80 o los índice, si incorpora la mayoría de su juego extendido de instrucciones, como las de manipulación de bits. Además incorpora circuitería extra para el control del LCD, del joypad, del puerto serie y la generación de audio. 
</p>

<p>
Este tutorial no pretende ser una guía de programación completa del z80 o en este caso del gbz80 como se le suele llamar, sino que se centra en el hardware de la GameBoy y como usarlo. Para aprender ensamblador de z80 recomiendo la documentación existente como por ejemplo la lista de instrucciones de la CPU de la GameBoy en <a href="../external.html?link=http://gbdev.gg8.se/wiki/articles/CPU_Instruction_Set" class="urlextern" title="http://gbdev.gg8.se/wiki/articles/CPU_Instruction_Set" rel="nofollow">http://gbdev.gg8.se/wiki/articles/CPU_Instruction_Set</a> y el curso de ensamblador de z80 de spectrum de <a href="../external.html?link=https://wiki.speccy.org/cursos/ensamblador/indice" class="urlextern" title="https://wiki.speccy.org/cursos/ensamblador/indice" rel="nofollow">https://wiki.speccy.org/cursos/ensamblador/indice</a> . Tened en cuenta que el z80 tiene algunas instrucciones que la CPU de la GameBoy no, pero por lo demás aprender ensamblador de z80 nos viene perfecto para la GameBoy (además de para Spectrum, Amstrad CPC, MSX, Sega Master System…).
</p>

</div>

<h3 class="sectionedit3" id="gbz80">GBz80</h3>
<div class="level3">

<p>
La CPU, vamos a llamarla gbz80, es una cpu de 8bit, con un bus de direcciones de 16 bit. Esto es, los datos internamente y en la memoria externa, se organizan en bytes, y se pueden direccionar 2^16 = 64KB de memoria externa.
</p>

</div>

<h4 id="registros">Registros</h4>
<div class="level4">

<p>
El gbz80, tiene varios registros internos, en los que podemos almacenar datos mientras operamos con ellos y los movemos a o desde la memoria externa a la CPU.
Estos registros de 8 bit, son: a, b, c, d, e, h y l.
</p>

</div>

<h4 id="flags">Flags</h4>
<div class="level4">

<p>
Además está el registro especial &#039;f&#039;, que guarda el estado de los flags del procesador. El procesador al realizar ciertas operaciones, puede activar o desactivar algunos de estos flags, que nos serán muy útiles a la hora de programar. Por ejemplo, un bit dentro de ese registro es el flag Zero, que nos indica si el resultado de la operación anterior, ha sido cero o no. No todas las operaciones modifican los flags, pero muchas de ellas si lo hacen. Para conocer a fondo todas las operaciones que puede realizar el gbz80, podeis echar un vistazo a la sección correspondiente de los Pan Docs:
<a href="../external.html?link=http://gbdev.gg8.se/wiki/articles/CPU_Instruction_Set" class="urlextern" title="http://gbdev.gg8.se/wiki/articles/CPU_Instruction_Set" rel="nofollow">http://gbdev.gg8.se/wiki/articles/CPU_Instruction_Set</a>
</p>

<p>
Los flags del registro f, son los siguientes:
</p>
<pre class="code">Bit Nombre (1)  (0)  Explicación
 7    zf    Z   NZ   Flag Zero 
 6    n     -   -    Flag de Suma/Resta (BCD)
 5    h     -   -    Flag de medio acarreo (BCD)
 4    cy    C   NC   Flag de Acarreo
 3-0  -     -   -    Sin uso (siempre a cero)</pre>

<p>
Los flags mas usados son:
</p>

</div>

<h5 id="flag_zero_z">Flag Zero (Z)</h5>
<div class="level5">

<p>
Este bit se pone a 1 si el resultado de una operación ha sido cero (0). Muy usado en saltos condicionales.
</p>

</div>

<h5 id="flag_de_acarreo_c_o_cy">Flag de acarreo (C, ó Cy)</h5>
<div class="level5">

<p>
Se pone a 1 cuando el resultado de una suma es mayor que $FF (8bit) o $FFFF (16bit), o cuando el resultado de una resta o comparación es menor que cero.
Además se pone a uno cuando en una instrucción de rotación o desplazamiento, la operación saca fuera un 1. Usado en saltos condicionales o en instrucciones como ADC, SBC, RL, RLA, etc. 
</p>

</div>

<h4 id="registros_de_16_bit">Registros de 16 bit</h4>
<div class="level4">

<p>
Algunos de estos registros se pueden combinar, para formar registros de 16 bits, muy útiles para manejar direcciones de memoria o números más grandes si los necesitamos. Los registros de 16 bits son: af, bc, de, y hl.
</p>

<p>
Además tenemos otros dos registros especiales, el pc, o program counter, de 16 bits, que guarda la dirección de memoria de la siguiente instrucción que se ejecutará, y el sp, ó stack pointer, también de 16 bits, que guarda el puntero de la pila. 
</p>

</div>

<h3 class="sectionedit4" id="mapa_de_memoria">Mapa de memoria</h3>
<div class="level3">

<p>
La memoria principal de la gameboy, mapeada en un espacio de 16 bit, nos permite direccionar directamente 64K (2^16 = 65536).
En este espacio de direcciones, tenemos que direccionar todos los bloques de memoria a los que la gameboy necesita acceder, esto es, la RAM, la ROM del cartucho, la RAM interna del cartucho para los juegos que graban partidas, la memoria de vídeo, etc. Para la ello los diseñadores de la GameBoy mapearon la memoria en diferentes bloques necesarios, como la RAM interna o la memoria de video, dejando dos bloques de 16K para el acceso a la ROM de los juegos, y un bloque de 8K para el acceso a la RAM de los juegos (partidas guardadas). Como muchos juegos empezaron a requerir mas de 32K de ROM o de 8K de RAM de guardado, se empezó a emplear una técnica denominada “Banking”, en la que la ROM del juego se divide en diversos bloques que se puedan independizar (los gráficos o sonidos de cada pantalla por ejemplo), que se van mapeando en el bloque de acceso a la memoria según sean necesarios. En la GameBoy, esto se diseñó de la siguiente manera; tenemos un bloque fijo de 16K(donde programamos la lógica principal del juego), y luego, mediante ciertas instrucciones (dependiendo del chip de mapping que usemos en nuestro cartucho), podemos ir intercambiando bancos de 16K en el otro bloque disponible. Parece complicado, pero hablaremos de banking más adelante.
Todo esto queda reflejado en el siguiente mapa de memoria con todos los bloques disponibles en el espacio de direcciones de la GameBoy.
</p>
<pre class="code"> 
  Mapa general de memoria*                  Registros de escritura de bancos
 -------------------------                 ----------------------------------

  Registro de activacion de 
  Interrupciones
 ---------------------------------- $FFFF
  RAM Alta Interna
 ---------------------------------- $FF80
  No usable
 ---------------------------------- $FF4C
  Puertos de E/S
 ---------------------------------- $FF00
  No usable
 ---------------------------------- $FEA0
  Atributos de sprite (OAM)
 ---------------------------------- $FE00
  Espejo de los 8kB de RAM interna 
 ---------------------------------- $E000
  8kB de RAM interna
 ---------------------------------- $C000       ------------------------------
  8kB banco intercambiable de RAM              /      Selector MBC1 ROM/RAM
 ---------------------------------- $A000     /  -----------------------------
  8kB Video RAM                              /  /     Selector banco RAM 
 ---------------------------------- $8000 --/  /  ----------------------------
  16kB banco intercambiable de ROM  $6000 ----/  /    Selector banco ROM 
 ---------------------------------- $4000 ------/  ---------------------------
  16kB Banco #0 de ROM              $2000 --------/   Activación de Banco RAM
 ---------------------------------- $0000 ------------------------------------
</pre>

<p>
 * <strong>NOTA</strong>: b = bit, B = byte
</p>

<p>
 * <strong>NOTA</strong>: Usando la convención del RGBDS, el ensamblador que usaremos en el tutorial, los números en notación hexadecimal, los escribiré con un “$” delante, en binario con un ”%“ y en decimal sin prefijo.
</p>

</div>

<h3 class="sectionedit5" id="organizacion_de_una_rom_de_gameboy">Organización de una ROM de GameBoy</h3>
<div class="level3">

<p>
Las ROMs de GameBoy tienen que guardar cierta estructura para que la GameBoy las acepte, especialmente en el tema de la cabecera.
A continuación detallo las partes de una ROM y su función:
</p>
<pre class="code">ESQUEMA DE UNA IMAGEN ROM DE GAMEBOY
------------------------------------

$0    -  $100:	Vectores de interrupción. Aunque también se pueden usar estas 
			direcciones para meter código propio
				
$100  -  $103:	Punto de entrada a la ejecución del programa, normalmente se 
		suele poner un nop, seguido de un salto a nuestro propio
		punto de inicio.
				
$104  - $14E:	Cabecera del cartucho. Contiene el logo de nintendo, (104h-133h)
		que es comparado con el existente en la rom justo al arranque de
		la consola, si no coiciden, se detiene la ejecución.
		
		Luego tenemos los siguientes datos:
		
		$134 - Nombre del cartucho - 15bytes
		
		$143 - Soporte de gameboy color
			$80 = GBColor, $00 u otro = B/N
					
		$144 - Codigo de licencia, 2 bytes (no importante)
		
		$146 - Soporte de supergameboy (SGB)
			00 = GameBoy, 03 = Super GameBoy
					
		$147 - Tipo de cartucho (Sólo ROM, MBC1, MBC1+RAM.. etc)
			 0 - SOLO ROM                12 - ROM+MBC3+RAM
			 1 - ROM+MBC1                13 - ROM+MBC3+RAM+BATT
			 2 - ROM+MBC1+RAM            19 - ROM+MBC5
			 3 - ROM+MBC1+RAM+BATT       1A - ROM+MBC5+RAM
			 5 - ROM+MBC                 1B - ROM+MBC5+RAM+BATT
			 6 - ROM+MBC2+BATT           1C - ROM+MBC5+RUMBLE
			 8 - ROM+RAM                 1D - ROM+MBC5+RUMBLE+SRAM
			 9 - ROM+RAM+BATT            1E - ROM+MBC5+RUMBLE+SRAM+BATT
			 B - ROM+MMM01               1F - GBCamera
			 C - ROM+MMM01+SRAM          FD - Bandai TAMA5
			 D - ROM+MMM01+SRAM+BATT     FE - Hudson HuC-3
		 	 F - ROM+MBC3+TIMER+BATT     FF - Hudson HuC-1
			10 - ROM+MBC3+TIMER+RAM+BATT
			11 - ROM+MBC3
			
		$148 - Tamaño ROM 
			  0 - 256Kbit =  32KByte =   2 bancos
		  	  1 - 512Kbit =  64KByte =   4 bancos
		   	  2 -   1Mbit = 128KByte =   8 bancos
		  	  3 -   2Mbit = 256KByte =  16 bancos
		  	  4 -   4Mbit = 512KByte =  32 bancos
		  	  5 -   8Mbit =   1MByte =  64 bancos
		  	  6 -  16Mbit =   2MByte = 128 bancos
                          7 -  32Mbit =   4MByte = 256 bancos
			$52 -   9Mbit = 1.1MByte =  72 bancos
			$53 -  10Mbit = 1.2MByte =  80 bancos
			$54 -  12Mbit = 1.5MByte =  96 bancos
			
		$149 - Tamaño RAM
			0 - Ninguna
			1 -  16kBit =   2kB =  1 banco
			2 -  64kBit =   8kB =  1 banco
			3 - 256kBit =  32kB =  4 bancos
			4 -   1MBit = 128kB = 16 bancos
			
		$14A - Código de zona 
			0 - Japonés
			1 - No Japonés
			
		$14B - Codigo de licencia antiguo, 2 bytes 
			$33 - Buscar el ćodigo en $0144/$0145
			(Las funciones de SGB no funcionan si no es $33)
		
		$14C - Versión de ROM (Normalmente $00)
		
		$14D - Prueba de complemento (importante)
		
		$14E - Checksum (no importante)

$14F  - $3FFF:	Nuestro código. Este es el banco 0 de 16K, y es fijo.

$4000 - $7FFF:	Segundo banco de 16K. En el arranque de la gameboy este se
		corresponde con el banco 1 (hasta 32K de la rom), pero podría 
		ser intercambiado por bancos superiores de 16K hasta el total
		de ROM que tengamos disponible usando un mapper como el MBC1.
</pre>

</div>

<h3 class="sectionedit6" id="sistema_de_video">Sistema de vídeo</h3>
<div class="level3">

<p>
El sistema de video de la GameBoy, no es un sistema de acceso directo pixel a pixel, como en un PC, sino que es un sistema de bloques o “tiles”. Consta de un 
buffer de 256&times;256 pixeles (32&times;32 tiles) del que se pueden mostrar 160&times;144 en cada momento (tamaño real de la pantalla, 20&times;18 tiles). Tenemos un par de registros SCROLLX y SCROLLY, que nos permiten mover el buffer por el área visualizable. Además el buffer es circular, cuando se hace scroll más allá de un extremo del buffer, empezamos a visualizar los datos del lado opuesto.
</p>
<pre class="code">				  ^
				  |
				  v

		+------------------------------------+
		|(scrollx, scrolly)                  |
		|   +----------------+               |
		|   |                |               |
		|   |                |               |
		|   |                |               |
		|   |     20x18      |               |
		|   |  área visible  |               |
		|   |                |               |
		|   |                |               |
	&lt;-&gt;	|   |                |               |	&lt;-&gt;
		|   +----------------+               |
		|                                    |
		|                32x32               |
		|            mapa de fondo           |
		|                                    |
		|                                    |
		|                                    |
		|                                    |
		|                                    |
		+------------------------------------+		
				  ^
				  |
				  v
</pre>

<p>
Los registros que controlan el sistema de vídeo, son muy importantes, ya que nos permiten controlar lo que mostramos por pantalla, y cómo.
Los más importantes para empezar son:
</p>

</div>

<h4 id="ff40_-_lcdc_-_control_del_lcd_r_w">$FF40 - LCDC - Control del LCD (R/W)</h4>
<div class="level4">

<p>
Este registro de control, nos permite ajustar la pantalla de la GameBoy, con lo que deberemos manejarlo para cualquier operación que involucre mostrar algo en ella.
</p>

<p>
Cada bit de este registro tiene un siginificado especial, que pasaré a detallar:
</p>
<pre class="code"> Bit 7 - Control del Display                          (0=Off, 1=On)
 Bit 6 - Selección del Window Tile Map                (0=9800-9BFF, 1=9C00-9FFF)
 Bit 5 - Control de la Ventana                        (0=Off, 1=On)
 Bit 4 - Selección del Tile Data de fondo y ventana   (0=8800-97FF, 1=8000-8FFF)
 Bit 3 - Selección del Tile Map de fondo              (0=9800-9BFF, 1=9C00-9FFF)
 Bit 2 - Tamaño de los OBJ (Sprites)                  (0=8x8, 1=8x16)
 Bit 1 - Control de los OBJ (Sprites)                 (0=Off, 1=On)
 Bit 0 - Control del fondo                            (0=Off, 1=On)</pre>

<p>
Vamos a detallar las funciones de algún bit, porque esto es muy importante:
</p>

</div>

<h5 id="bit_7_-_control_del_display">Bit 7  - Control del display</h5>
<div class="level5">

<p>
Activa o desactiva el LCD. El display ha de activarse antes de que podamos mostrar algo en él, y a veces lo querremos desactivar si tenemos que escribir muchos datos en pantalla, como una imagen de prensentación o fin completa, para que de tiempo a meter todos los gráficos en memoria antes de que la pantalla empieze a dibujarlos y veamos cosas raras y gráficos a medias.
</p>

<p>
<strong>ATENCIÓN</strong> - El display solo puede activarse y desactivarse cuando estamos en el periodo de intervalo vertical (V-Blank). Activarlo o desactivarlo fuera de este periodo puede dañar el hardware. Mucho cuidado con esto, ya que en los emuladores no pasa nada, pero puedes estropear tu gameboy si lo haces en el hardware real. Asi que para activar o desactivar el LCD, primero espera al intervalo vertical (veremos como hacer esto).
</p>

</div>

<h5 id="bit_0_-_control_del_fondo">Bit 0  - Control del fondo</h5>
<div class="level5">

<p>
Si este bit es cero, el fondo no se dibuja, se queda en blanco (con lo que para dibujar el fondo tenemos que poner este bit a uno, claro). Hemos visto esto en muchos juegos para hacer efectos de parpadeos y cosas asi.
</p>

<p>
El resto de bits se comportan de manera similar y creo que quedan explicados en la tabla.
</p>

</div>

<h4 id="ff41_-_status_-_status_del_lcd_r_w">$FF41 - Status - status del LCD (R/W)</h4>
<div class="level4">

<p>
Este registro es también muy importante, ya que nos permite conocer que está haciendo el LCD en cada momento. Deberemos consultarlo para numerosas operaciones, asi que atentos. Además nos permite activar las interrupciones del LCD, asi que como veis, tenemos mucha funcionalidad en este registro.
</p>

<p>
Una tabla explicativa y luego lo detallamos:
</p>
<pre class="code"> Bit 5 - Interrupción Modo 2 OAM          (1=Activada) (Lectura/Escritura)
 Bit 4 - Interrupción Modo 1 V-Blank      (1=Activada) (Lectura/Escritura)
 Bit 3 - Interrupción Modo 0 H-Blank      (1=Activada) (Lectura/Escritura)
 Bit 2 - Flag de coincidencia             (0:LYC&lt;&gt;LY, 1:LYC=LY) (Sólo Lectura)
 Bit 1-0 - Flag de Modo                   (Modo 0-3, ver abajo) (Sólo Lectura)
           0: Estamos en H-Blank
           1: Estamos en V-Blank
           2: Buscando OAM-RAM
           3: Transfiriendo datos al LCD</pre>

<p>
Los bytes del 3 al 5, nos permiten activar las interrupciones del LCD, muy útiles para ciertos procesos que requieran redibujados rápidos de la pantalla, ya que escribiendo nuestro código de dibujado en ellas, estamos seguros de que el dibujado se producirá correctamente (sobretodo en los periodos de intervalo).
</p>

<p>
El byte 2, sirve para comparar dos registros especiales, el LY ($FF44), que es la coordenada Y donde el LCD está dibujando en este momento, y el registro LCY ($FF45), que podemos definir nosotros. 
</p>

<p>
Los bytes 1 y 0, nos indican el modo en que está el LCD, ya sea en los dos periodos de intervalo, o accediendo a la RAM o escribiendo en el LCD.
Como dijimos antes, esto es muy útil para saber si estamos en el periodo de VBLank por ejemplo; sólo tendriamos que ver si en los bits 1-0 de este registro, tenemos “01”, esto en ensamblador de la gameboy es tan sencillo como hacer lo siguiente:
</p>
<pre class="code asm">ld     a<span class="sy1">,</span> <span class="br0">&#91;</span><span class="sy2">$</span>FF41<span class="br0">&#93;</span>
<span class="kw1">and</span>    <span class="nu0">1</span>
cp     <span class="nu0">1</span></pre>

<p>
Esto es, cargamos en el registro a, el valor que tenemos en el registro de status del LCD, y hacemos un AND con 1. Cualquier valor que tenga el registro, al hacerle and con 1, si en las ultimas posiciones tenia 01, el resultado será 01, asi que lo comparamos con 1 (cp 1). Si ahora el resultado de la comparación es 0 (iguales), es que estamos en el periodo de VBlank.
</p>

<p>
Aunque hay otra manera más rápida de saber si estamos en V-Blank, y es usando el registro LY que comenté antes. Como dije, el registro LY nos indica en que línea horizontal se encuentra “dibujando” el LCD. A partir de la linea 144, el LCD está fuera de pantalla y por lo tanto estamos en el periodo de intervalo vertical.
Asi que haciendo esto…
</p>
<pre class="code asm">ld     a<span class="sy1">,</span> <span class="br0">&#91;</span><span class="sy2">$</span>FF44<span class="br0">&#93;</span>
cp     <span class="nu0">145</span></pre>

<p>
Cargamos en a, el valor contenido en el registro LY, y lo comparamos con 145, si son iguales, acabamos de entrar en VBlank… como vemos, una instrucción menos, y en ensamblador, esto es muy importante.
</p>

<p>
Asi por ejemplo, para que vayais viendo un poco el ensamblador de la gameboy, si queremos esperar hasta que estemos en VBlank (para activar o desactivar el LCD por ejemplo, como vimos antes), podriamos hacer algo asi:
</p>
<pre class="code asm"><span class="sy1">.</span>espera_vblank<span class="sy1">:</span>
    ld     a<span class="sy1">,</span> <span class="br0">&#91;</span><span class="sy2">$</span>FF44<span class="br0">&#93;</span>
    cp     <span class="nu0">145</span>
    jr     nz<span class="sy1">,</span> <span class="sy1">.</span>espera_vblank</pre>

<p>
Lo mismo que antes, pero después de la comparación, si el resultado no es cero (el LCD no está en la linea 145), saltamos a la etiqueta inicial con lo que volvemos a hacer la comprobación… este bucle se ejecutaria hasta que el LCD llegue a la linea 145, con lo que continuará con las instrucciones a continuación.
Tranquilos con el ensamblador, lo iremos explicando más adelante.
</p>

</div>

<h4 id="ff42_-_scy_-_scroll_y_r_w_ff43_-_scx_-_scroll_x_r_w">$FF42 - SCY - Scroll Y (R/W), $FF43 - SCX - Scroll X (R/W)</h4>
<div class="level4">

<p>
Registros de control del scroll del display, como expliqué anteriormente, nos permiten mover la ventana visible sobre el mapa de fondo escribiendo en ellos.
Para posicionar el área visible en la coordenada (0,0) del fondo, simplemente escribimos cero en ambos registros.
</p>

</div>

<h4 id="ff4a_-_wy_-_posicion_y_de_la_ventana_r_w_ff4b_-_wx_-_posicion_x_de_la_ventana_menos_7_r_w">$FF4A - WY - Posición Y de la ventana (R/W), $FF4B - WX - Posición X de la ventana menos 7 (R/W)</h4>
<div class="level4">

<p>
Controlan la posición x,y de la ventana. La ventana es un fondo alternativo, que puede ser dibujado encima del fondo normal, para efectos como la pantalla de estatus del zelda. Esta ventana no tiene scroll, pero puede ser posicionada en cualquier posición moviendola usando estos registros. Si la colocamos en WY=0, WX=7, la ventana cubrirá todo el fondo visible. Los sprites quedan también por encima de la ventana.
</p>

</div>

<h3 class="sectionedit7" id="fondos">Fondos</h3>
<div class="level3">

<p>
Tenemos entonces un área en la VRAM, conocida como “Background Tile Map”, (mapa de tiles de fondo) de 32&times;32 = 1024 bytes. Cada uno de estos bytes, contiene un número que referencia al tile a mostrar de la “Tile Data Table” (tabla de datos de tiles). En realidad tenemos dos mapas de fondo, uno en $9800-9BFF y el otro en $9C00-9FFF, pudiendo seleccionar uno u otro a través del registro LCDC ($FF40).
</p>

<p>
Además tenemos una “ventana” que flota encima del fondo, controlada por los registros WNDPOSX y WNDPOSY.
</p>

<p>
Tenemos también dos Tile Data Tables, una que va desde $8000 a 8FFF, sin signo (0-255) y que puede ser usada para el fondo, sprites y ventana, y otra que va
de $8800 a $97FF, con signo (-128, 127) y solo puede ser usada para los fondos.
</p>

<p>
Los dibujos de los tiles 8&times;8 pixéles, se guardan en las Tile Data Tables usando 16 bits por línea del sprite, esto es, dos bits por pixel para guardar los datos del color; ya que en la GameBoy tenemos 4 posibles colores: blanco, gris claro, gris oscuro y negro, en binario: 00, 01, 10 y 11 <img src="lib/images/smileys/icon_wink.gif" class="icon" alt=";-)" />
</p>

<p>
Se guardan en memoria de la siguiente manera:
</p>
<ul>
<li class="level1"><div class="li"> Byte 0-1 - Primera línea (8 pixeles)</div>
</li>
<li class="level1"><div class="li"> Byte 2-3 - Segunda línea </div>
</li>
<li class="level1"><div class="li"> …</div>
</li>
<li class="level1"><div class="li"> Byte 14-15 - Octava línea.</div>
</li>
</ul>

<p>
De los dos bytes de cada línea (esto se complica un poco), el primer byte, recibe los bits menos significativos del color de cada pixel, y el segundo byte los más significativos, siendo el bit 7 el pixel de más a la izquierda, y el 0 el pixel de más a la derecha; eso es, si el primer pixel es gris oscuro (10) el bit 7 del primer byte será 1 y el bit 7 del segundo byte será cero.
</p>

<p>
Con lo que para un sprite que dibuje una “A” multicolor, tenemos algo asi:
</p>
<pre class="code">   Tile:                               		Datos:

  .33333..				 %01111100 %01111100 -- $7C $7C (Hex)
  22...22.                     		 %11000110 %00000000 -- $C6 $00
  11...11.                     		 %00000000 %11000110 -- $00 $C6
  2222222. &lt;-- los digitos     		 %11111110 %00000000 -- $FE $00
  33...33.     representan     		 %11000110 %11000110 -- $C6 $C6
  22...22.     los colores     		 %11000110 %00000000 -- $C6 $00
  11...11.     		       		 %00000000 %11000110 -- $00 $C6
  ........                		 %00000000 %00000000 -- $00 $00
</pre>

<p>
Asi que si escribimos  los 16 bytes $7C, $7C, $C6, $00, $00, $C6, $FE, $00, $C6, $C6, $C6, $00, $00, $C6, $00, $00 a partir de la posición de memoria $8000, el tile número 0, será nuestra “A” multicolor.
</p>

<p>
Entonces ahora tenemos el mapa de tiles de fondo, que como dijimos guarda en una tabla de 32&times;32 (1024 bytes) los números de los tiles a mostrar en nuestra pantalla virtual de 32&times;32 tiles (32 columnas x 32 lineas) 20&times;18 visibles).
Asi, si ahora, en la posición $9800 de memoria, escribimos $00, le estamos diciendo que en la posición de tiles de fondo de pantalla (0,0), dibuje el tile 0,
Si activamos el LCD, y activamos el fondo, ahora en la esquina superior izquierda de la pantalla, tendriamos nuestra “A” multicolor.
</p>

<p>
<strong>IMPORTANTE:</strong>
</p>

<p>
Hay que tener en cuenta que no se debe escribir en la memoria de video mientras no estemos en un periodo de intervalo (ya sea horizontal o vertical) o desactivando el LCD. Esto es porque podrian suceder cosas muy raras si accedemos a la memoria de video para escribir en ella, mientras el LCD está intentando leer de ella para dibujar… tendremos parpadeos y otros efectos no deseados. Lo mismo se aplica para los sprites.
</p>

</div>

<h3 class="sectionedit8" id="sprites">Sprites</h3>
<div class="level3">

<p>
Además de los fondos, por supuesto tenemos los sprites. Los sprites son objetos gráficos que se mueven por encima del fondo, tienen un color transparente, y propiedades que les podemos aplicar como reflejo horizontal y vertical.
Normalmente los sprites son usados para dibujar nuestros personajes, naves, enemigos, y cualquier objeto gráfico que queramos manejar independientemente del fondo.
</p>

<p>
El controlador de video de la GameBoy, puede dibujar 40 sprites en modos 8&times;8 px o 8&times;16 px, aunque por una limitación de hardware, sólo 10 sprites pueden dibujarse simultáneamente en una linea horizontal (solo 10 sprites pueden compartir la misma coordenada Y). Los gráficos de los sprites, se guardan en memoria en el mismo formato que los tiles de fondo, en la tabla conocida como Sprite Pattern Table (Tabla de patrones de sprites), entre las posiciones de memoria $8000-8FFF, con lo que podemos definir hasta 256 sprites (4096 bytes / 16 bytes por sprite). Como vimos antes, la dirección $8000 está también usada por la tabla de datos de tiles de fondo, asi que si, los gráficos para tiles y sprites se comparten, hay que tener esto en cuenta cuando diseñemos nuestros gráficos.
</p>

<p>
Los atributos de los sprites, la tabla que define que sprites vamos a usar y cómo los usaremos, residen en la Sprite Atributte Table, entre las posiciones de memoria $FE00-FE9F. Cada una de estas entradas consta de 4 bytes, con lo que tenemos 160/4 =  40 entradas, como dijimos antes.
</p>

<p>
Cada entrada está formada de la siguiente manera:
</p>

</div>

<h5 id="byte_0_-_coordenada_y">Byte 0  - Coordenada Y</h5>
<div class="level5">

<p>
Especifica la posición Y del sprite menos 8. ¿Cómo?, que el primer pixel vertical visible en pantalla es el 8, esto es así para que podamos poner el sprite un poco o totalmente fuera de la pantalla, dibujandolo entre las posiciones 0-7. Asi mismo podemos ir sacándolo de la pantalla por abajo dibujándolo en posiciones mayores a 140.
</p>

</div>

<h5 id="byte_1_-_coordenada_x">Byte 1  - Coordenada X</h5>
<div class="level5">

<p>
Especifica la posición X del sprite menos 8. Se aplica lo mismo que la posición Y salvo que tenemos 160 pixeles visibles en la coordenada X.
</p>

</div>

<h5 id="byte_2_-_numero_de_sprite">Byte 2 - Número de sprite</h5>
<div class="level5">

<p>
Especifica el número de sprite a usar para esta entrada de los sprites definidos en la tabla $8000-8FFF.
</p>

</div>

<h5 id="byte_3_-_atributos">Byte 3 - Atributos</h5>
<div class="level5">

<p>
Especifica los atributos especiales que se pueden aplicar a un sprite. Cada bit de este byte, es un flag que aplica diferentes modificaciones al sprite, según la siguiente tabla:
</p>
<pre class="code"> Bit7   Prioridad (0= Sprite por encima del fondo, 1=Objeto por debajo de los colores de fondo 1-3)
        (Válido para el fondo y la ventana. El color 0 de fondo, está siempre detrás del sprite (transparente))
 Bit6   Reflejo Y       (0=Normal, 1=Espejado vertical)
 Bit5   Reflejo X       (0=Normal, 1=Espejado horizontal)
 Bit4   Número de paleta  **Solo en GB no Color**  (0=OBP0, 1=OBP1)
 Bit3   Banco de VRAM     **Solo en GB Color**     (0=Banco 0, 1=Banco 1)
 Bit2-0 Número de paleta  **Solo en GB Color**     (OBP0-7)</pre>

<p>
Como vemos, varios bits son sólo aplicables a la <abbr title="Gigabyte">GB</abbr> Color, asi que de momento lo ignoramos, y nos centramos en la prioridad, espejados y paleta.
</p>

</div>

<h1 class="sectionedit9" id="herramientas">Herramientas</h1>
<div class="level1">

</div>

<h3 class="sectionedit10" id="ensamblador">Ensamblador</h3>
<div class="level3">

<p>
Para programar en ensablador para la GameBoy, lo primero que necesitamos, ¿qué es? Pues un ensamblador, el programa que convertirá nuestro código escrito en ensamblador, a código máquina de la gameboy, en forma de una ROM que podremos ejecutar en nuestro emulador favorito o cargar directamente en nuestra Gameboy con un FlashCart.
</p>

<p>
Personalmente, utilizo el RGBDS, un sistema de desarrollo en ensamblador específico para la GameBoy, asi que todo es muy sencillo con él.
La podeis descargar de aqui:
</p>

<p>
<strong>Windows</strong>: Hay builds para windows en <a href="../external.html?link=https://github.com/rednex/rgbds/releases" class="urlextern" title="https://github.com/rednex/rgbds/releases" rel="nofollow">https://github.com/rednex/rgbds/releases</a>
</p>

<p>
Lo descargais y copiais los .exe a c:\windows o similar dentro del PATH
</p>

<p>
<strong>Linux</strong>: Desde hace un tiempo, el RGBDS para Unix está alojado en GitHUB: <a href="../external.html?link=https://github.com/bentley/rgbds" class="urlextern" title="https://github.com/bentley/rgbds" rel="nofollow">https://github.com/bentley/rgbds</a>
</p>

<p>
En linux puede que tengais que compilarlo (Por ejemplo en Arch hay un paquete en el AUR), pero vamos, es simplemente ejecutar como root un “make install” en el directorio después de haberlo descargado con git, en el github teneis las instrucciones de instalación.
</p>

<p>
Teneis la documentación del RGBDS en: <a href="../external.html?link=https://rednex.github.io/rgbds/" class="urlextern" title="https://rednex.github.io/rgbds/" rel="nofollow">https://rednex.github.io/rgbds/</a>
</p>

<p>
Bien, RGBDS viene con cuatro herramientas, <strong>rgbasm</strong>, el ensamblador en si mismo, <strong>rgblink</strong>, el enlazador que creará nuestras roms, el <strong>rgblib</strong>, para crear librerias, y el <strong>rgbfix</strong>, para modificar la cabecera de la rom, para que cumpla los requerimientos necesarios para que la rom se ejecute. Como vimos en la introducción, la cabecera de una rom de GameBoy, lleva varios checksums y demás, pues esta herramienta los ajusta para que la rom sea correcta.
</p>

<p>
Además necesitaremos algunos archivos que nos harán más sencillo el tema de ensamblar y generar nuestras roms, os los dejo a continuación:
</p>

<p>
<strong>Windows</strong>: <a href="lib/exe/assemble40c8.bat_%3b?media=assemble.bat" class="media mediafile mf_bat" title="assemble.bat (571 B)">assemble.bat</a>
</p>

<p>
<strong>Linux</strong>: <a href="lib/exe/assemble8d22.sh_%3b?media=assemble.sh" class="media mediafile mf_sh" title="assemble.sh (325 B)">assemble.sh</a>
</p>

<p>
<strong>NOTA</strong> - El código fuente, deberá llevar la extension .agb (assembler gameboy) para que estos scripts funcionen.
</p>

<p>
Y por último, una ayuda más que importante, un fichero que podeis incluir en vuestro código fuente, que define nombres para todos los registros y direcciones de memoria de la gameboy, así como algunas ayudas como la cabecera de la rom, etc.
</p>

<p>
Podeis descargarlo aqui: <a href="lib/exe/gbhwfc6a.inc_%3b?media=gbhw.inc" class="media mediafile mf_inc" title="gbhw.inc (18.5 KB)">gbhw.inc</a>
</p>

</div>

<h3 class="sectionedit11" id="editor">Editor</h3>
<div class="level3">

<p>
Necesitareis además un editor para vuestro código fuente. Yo personalmente utilizo VIM, y tengo definido un archivo de sintaxis para los ficheros de ensamblador de gameboy .agb, si alguien lo quiere puede descargarlo aqui: <a href="lib/exe/agb2b43.vim_%3b?media=agb.vim" class="media mediafile mf_vim" title="agb.vim (3.5 KB)">agb.vim</a>, e instalarlo en su ~/.vim/syntax/. Recordad añadir la siguiente línea a vuestro .vimrc para que os reconozca esta extension:
</p>
<pre class="code">au BufRead,BufNewFile *.agb set filetype=agb</pre>

<p>
También tengo un archivo de sintaxis para los archivos .agb para el Gedit: <a href="lib/exe/agb0e65.lang_%3b?media=agb.lang" class="media mediafile mf_lang" title="agb.lang (8.3 KB)">agb.lang</a>, podeis instalarlo en ~/.local/share/gtksourceview-3.0/language-specs (cread el directorio si no existe)
</p>

<p>
Si preferis Atom, podeis instalar el paquete “language-gb” desde el gestor de paquetes del editor para tener resaltado de sintaxis. Si quereis que os reconozca automáticamente los archivos .agb podeis editar el código del paquete desde las preferencias, seleccionando el paquete, settings → view code, y editando el archivo gb-assembly.cson en grammars, añadir &#039;agb&#039; a la lista de “Filetypes” (Recordad la coma).
</p>

</div>

<h3 class="sectionedit12" id="emulador">Emulador</h3>
<div class="level3">

<p>
Además, para ir probando vuestros programas, lo mejor es un emulador.
Hay muchos emuladores de GameBoy disponibles, aunque yo os recomiendo el BGB, funciona tanto en Windows como en Linux usando el Wine (en Options → Graphics, seleccionar en output DirectDraw u OpenGL si teneis problemas con la imagen), y es realmente fiel a la máquina original, asi no os llevareis sorpresas al ejecutar vuestras roms en una gameboy real, y que funcionen cosas diferentes al emulador.
Además tiene un debugger integrado, visualizadores de las tablas de tiles y sprites, desensamblador… la caña.
Podeis descargarlo aqui:
<a href="../external.html?link=http://bgb.bircd.org/" class="urlextern" title="http://bgb.bircd.org/" rel="nofollow">http://bgb.bircd.org/</a>
</p>

<p>
También el VisualBoyAdvance funciona muy bien emulando a la GameBoy, y las últimas versiones incorporan <abbr title="Graphical User Interface">GUI</abbr> y algunas herramientas como poder desactivar capas gráficas, canales de sonido, etc. 
</p>

</div>

<h1 class="sectionedit13" id="hola_mundo">Hola mundo</h1>
<div class="level1">

<p>
Vamos a hacer un pequeño programa de ejemplo, un pequeño hola mundo, que podremos ejecutar en nuestra gameboy, y mostrará una pequeña cara sonriente en pantalla. Después, paso a paso, explicaré las instrucciones del programa. Vamos a ello:
</p>

<p>
Primero vamos a dibujar nuestro sprite como aprendimos anteriormente:
</p>
<pre class="code">  .33333..				 %01111100 %01111100 -- $7C $7C 
  3111113.                     		 %10000010 %11111110 -- $82 $FE
  31.1.13.                     		 %10000010 %11010110 -- $82 $D6
  31.1.13.               		 %10000010 %11010110 -- $82 $D6
  3111113.               		 %10000010 %11111110 -- $82 $FE
  3.111.3.              		 %10000010 %10111010 -- $82 $BA
  31...13.     		       		 %10000010 %11000110 -- $82 $C6
  .33333..                		 %01111100 %01111100 -- $7C $7C</pre>

</div>

<h3 class="sectionedit14" id="codigo">Código</h3>
<div class="level3">

<p>
Teniendo estos datos para dibujar nuestra cara sonriente, empezamos con el programa:
</p>
<dl class="code">
<dt><a href="holamundocf8b.asm?do=export_code&amp;id=tutorial_de_ensamblador&amp;codeblock=13" title="Descargar trozo de código fuente" class="mediafile mf_asm">holamundo.asm</a></dt>
<dd><pre class="code asm"><span class="co1">; Hola mundo</span>
<span class="co1">; David Pello 2010</span>
<span class="co1">; ladecadence.net</span>
<span class="co1">; Para el tutorial en: </span>
<span class="co1">; http://wiki.ladecadence.net/doku.php?id=tutorial_de_ensamblador</span>
&nbsp;
INCLUDE <span class="st0">&quot;gbhw.inc&quot;</span>          <span class="co1">; importamos el archivo de definiciones</span>
&nbsp;
&nbsp;
<span class="co1">; El programa comienza aqui:</span>
<span class="kw5">SECTION</span> <span class="st0">&quot;start&quot;</span><span class="sy1">,</span>ROM0<span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">0100</span><span class="br0">&#93;</span>
    <span class="kw1">nop</span>
    <span class="kw1">jp</span>      inicio
&nbsp;
<span class="co1">; Cabecera de la ROM (Macro definido en gbhw.inc)</span>
<span class="co1">; define una rom sin mapper, de 32K y sin RAM, lo más básico</span>
<span class="co1">; (como por ejemplo la del tetris)</span>
    ROM_HEADER  ROM_NOMBC<span class="sy1">,</span> ROM_SIZE_32KBYTE<span class="sy1">,</span> RAM_SIZE_0KBYTE
&nbsp;
<span class="co1">; aqui empieza nuestro programa</span>
inicio<span class="sy1">:</span>
    <span class="kw1">nop</span>
    <span class="kw4">di</span>                      <span class="co1">; deshabilita las interrupciones</span>
    ld      <span class="kw4">sp</span><span class="sy1">,</span> <span class="sy2">$</span>ffff       <span class="co1">; apuntamos la pila al tope de la ram</span>
&nbsp;
inicializacion<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="nu0">%11100100</span>    <span class="co1">; Colores de paleta desde el mas oscuro al</span>
                            <span class="co1">; más claro, 11 10 01 00</span>
    ld      <span class="br0">&#91;</span>rBGP<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; escribimos esto en el registro de paleta</span>
&nbsp;
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>            <span class="co1">; escribimos 0 en los registros de scroll X e Y</span>
    ld      <span class="br0">&#91;</span>rSCX<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; con lo que posicionamos la pantalla visible</span>
    ld      <span class="br0">&#91;</span>rSCY<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; al inicio (arriba a la izq) del fondo.</span>
&nbsp;
    <span class="kw1">call</span>    apaga_LCD       <span class="co1">; llamamos a la rutina que apaga el LCD</span>
&nbsp;
    <span class="co1">; cargamos el tile en la memoria de tiles</span>
&nbsp;
    ld      hl<span class="sy1">,</span> TileCara    <span class="co1">; cargamos en HL la dirección de nuestro tile</span>
    ld      de<span class="sy1">,</span> _VRAM       <span class="co1">; en DE dirección de la memoria de video</span>
    ld      b<span class="sy1">,</span> <span class="nu0">16</span>           <span class="co1">; b = 16, numero de bytes a copiar</span>
&nbsp;
<span class="sy1">.</span>bucle_carga<span class="sy1">:</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>hl<span class="br0">&#93;</span>          <span class="co1">; cargamos en A el dato apuntado por HL</span>
    ld      <span class="br0">&#91;</span>de<span class="br0">&#93;</span><span class="sy1">,</span> a         <span class="co1">; y lo metemos en la dirección apuntada en DE</span>
    <span class="kw1">dec</span>     b               <span class="co1">; decrementamos b, b=b-1</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>fin_bucle_carga <span class="co1">; si b = 0, terminamos, no queda nada por copiar</span>
    <span class="kw1">inc</span>     hl              <span class="co1">; incrementamos la dirección a leer de</span>
    <span class="kw1">inc</span>     de              <span class="co1">; incrementamos la dirección a escribir en</span>
    jr      <span class="sy1">.</span>bucle_carga    <span class="co1">; seguimos</span>
<span class="sy1">.</span>fin_bucle_carga<span class="sy1">:</span>
&nbsp;
    <span class="co1">; escribimos nuestro tile, en el mapa de tiles</span>
&nbsp;
    ld      hl<span class="sy1">,</span> _SCRN0      <span class="co1">; en HL la dirección del mapa de fondo</span>
    ld      <span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>       <span class="co1">; $00 = el tile 0, nuestro tile.</span>
&nbsp;
    <span class="co1">; configuramos y activamos el display</span>
    ld      a<span class="sy1">,</span> LCDCF_ON|LCDCF_BG8000|LCDCF_BG9800|LCDCF_BGON|LCDCF_OBJ8|LCDCF_OBJOFF
    ld      <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; bucle infinito</span>
bucle<span class="sy1">:</span>
    halt
    <span class="kw1">nop</span>
    jr      bucle
&nbsp;
<span class="co1">; Rutina de apagado del LCD</span>
apaga_LCD<span class="sy1">:</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>
    rlca                    <span class="co1">; Pone el bit alto de LCDC en el flag de acarreo</span>
    <span class="kw1">ret</span>     nc              <span class="co1">; La pantalla ya está apagada, volver.</span>
&nbsp;
    <span class="co1">; esperamos al VBlank, ya que no podemos apagar la pantalla</span>
    <span class="co1">; en otro momento</span>
&nbsp;
<span class="sy1">.</span>espera_VBlank
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rLY<span class="br0">&#93;</span>
    cp      <span class="nu0">145</span>
    jr      nz<span class="sy1">,</span> <span class="sy1">.</span>espera_VBlank
&nbsp;
    <span class="co1">; estamos en VBlank, apagamos el LCD</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>       <span class="co1">; en A, el contenido del LCDC</span>
    res     <span class="nu0">7</span><span class="sy1">,</span>a             <span class="co1">; ponemos a cero el bit 7 (activado del LCD)</span>
    ld      <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span>a       <span class="co1">; escribimos en el registro LCDC el contenido de A</span>
&nbsp;
    <span class="kw1">ret</span>                     <span class="co1">; volvemos</span>
&nbsp;
<span class="co1">; Datos de nuestro tile</span>
TileCara<span class="sy1">:</span>
    <span class="kw5">DB</span>  <span class="sy2">$</span>7C<span class="sy1">,</span> <span class="sy2">$</span>7C<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>FE<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>D6<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>D6
    <span class="kw5">DB</span>  <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>FE<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>BA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>C6<span class="sy1">,</span> <span class="sy2">$</span>7C<span class="sy1">,</span> <span class="sy2">$</span>7C
EndTileCara<span class="sy1">:</span></pre>
</dd></dl>

<p>
Bien, ahi está nuestro hola mundo. Guardadlo como hola.agb, y lo compilais usando el bat o sh que os descargasteis de la siguiente manera:
</p>
<pre class="code"> assemble.sh (o assemble.bat) hola</pre>

<p>
El mismo buscará el archivo hola.agb y ensablará y creará la rom.
Ahora deberiais tener un hola.gb que si ejecutais en vuestro emulador o gameboy, vereis una cara sonriente en la esquina superior izquierda de la pantalla.
Bueno, realmente, si el emulador es bueno, o lo ejecutais en la gameboy real, es probable que la pantalla esté llena de estos smileys quizá salvo el logo de nintendo. ¿Por qué?, porque no hemos limpiado la memoria de video y otras cosillas con las que iremos mejorando el programa de ejemplo.
</p>

<p>
<a href="lib/exe/detail01ad.html?id=tutorial_de_ensamblador&amp;media=bgb00001.png" class="media" title="bgb00001.png"><img src="lib/exe/bgb00001bae1.png_%3b?media=bgb00001.png" class="media" alt="" /></a>
</p>

</div>

<h3 class="sectionedit15" id="explicacion">Explicación</h3>
<div class="level3">

<p>
Bien, vamos por partes…
</p>
<pre class="code asm"><span class="co1">; Hola mundo</span>
<span class="co1">; David Pello 2010</span>
<span class="co1">; ladecadence.net</span>
<span class="co1">; Para el tutorial en: </span>
<span class="co1">; http://wiki.ladecadence.net/doku.php?id=tutorial_de_ensamblador</span></pre>

<p>
Bien, en ensamblador, los comentarios del código empiezan por ”;“. Como sabeis, los comentarios sirven para añadir explicaciones y documentación a nuestro código, para que otras personas o nosotros después de un tiempo, sepamos por que programamos tal o cual rutina, etc.
Asi que simplemente, el ensamblador ignora el texto de una linea a partir de un punto y coma y hasta el final de la misma.
</p>
<pre class="code asm">INCLUDE <span class="st0">&quot;gbhw.inc&quot;</span>          <span class="co1">; importamos el archivo de definiciones</span></pre>

<p>
INCLUDE, es un comando del ensamblador, que lo que hace es importar el código del archivo que le decimos, a partir del momento en que aparece este comando; esto es, es como si cogiéramos el código en “gbhw.inc” y lo pegáramos a continuación. Esto es útil, porque podemos tener código que usamos amenudo en archivos aparte, e importarlos desde todos nuestros programas, ahorrándonos teclearlos o copiarlos en cada uno.
Como vemos, más adelante en la linea, aparece un comentario, asi que a partir del ”;“ y hasta el final de la linea, ese texto es ignorado.
</p>
<pre class="code asm"><span class="co1">; El programa comienza aqui:</span>
<span class="kw5">SECTION</span> <span class="st0">&quot;start&quot;</span><span class="sy1">,</span>ROM0<span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">0100</span><span class="br0">&#93;</span>
    <span class="kw1">nop</span>
    <span class="kw1">jp</span>      inicio</pre>

<p>
SECTION define una sección de código, como su propio nombre indica, un bloque de código que queremos definir y colocar en una posición específica de la memoria. El ensamblador del RGBDS nos permite definirle un nombre “start” y una dirección de inicio, la dirección a partir de la cual, colocamos ese código en memoria. En la GameBoy, hemos visto en el mapa de memoria, que la ROM del cartucho, donde debe ir nuestro propio código, comienza en $0000, pero los 256 primeros bytes ($100), están reservados para las rutinas de interrupción, por lo que debemos colocar nuestro código a partir de la dirección, $0100, por eso colocamos la sección “start” a partir de ROM0 ($0000) + $100.
Entonces ejecutamos un <strong>nop</strong>, esta instrucción de gbz80, no hace nada, literalmente (No OPeration). Sirve para perder tiempo (4 ciclos) o para rellenar bloques de datos que necesitemos vacios (1 byte).
Después ejecutamos la instrucción <strong>jp</strong>, que sirve para hacer saltos de un lugar a otro del programa, pudiendo definir condiciones para realizar el salto o no.
En este caso, no hay condiciones, y le decimos que simplemente salte hasta la etiqueta inicio. ¿Por qué hacemos esto?
Bien, si miramos la documentación sobre la organizazión de una ROM de GameBoy, veremos que la cabecera de la ROM debe empezar en la dirección $0104, con lo que si colocamos un nop(1 byte), y luego la instrucción jp &lt;direccion&gt; (3 bytes), estamos llenando 4 bytes, justo lo que necesitamos para empezar a definir la cabecera, que será lo siguiente que introduzcamos. Pero necesitamos ese jp, para que salte desde aqui, hasta el código que empezaremos a ejecutar, ya que en la cabecera van datos, no código ejecutable.
</p>
<pre class="code asm"><span class="co1">; Cabecera de la ROM (Macro definido en gbhw.inc)</span>
<span class="co1">; define una rom sin mapper, de 32K y sin RAM, lo más básico</span>
<span class="co1">; (como por ejemplo la del tetris)</span>
    ROM_HEADER  ROM_NOMBC<span class="sy1">,</span> ROM_SIZE_32KBYTE<span class="sy1">,</span> RAM_SIZE_0KBYTE</pre>

<p>
Este ROM_HEADER es un macro definido dentro del gbhw.inc. Los macros son unas construcciones especiales del RGBDS que nos permiten definir ciertos bloques de código y modificarlos mediante parámetros.
Podemos asumir que con esto, el RGBDS nos introducirá aqui los bytes necesarios de la cabecera del cartucho, sin tener que preocuparnos de definirlos a mano.
Podeis echar un vistazo al final del gbhw.inc si teneis curiosidad.
</p>
<pre class="code asm"><span class="co1">; aqui empieza nuestro programa</span>
inicio<span class="sy1">:</span>
    <span class="kw1">nop</span>
    <span class="kw4">di</span>                      <span class="co1">; deshabilita las interrupciones</span>
    ld      <span class="kw4">sp</span><span class="sy1">,</span> <span class="sy2">$</span>ffff       <span class="co1">; apuntamos la pila al tope de la ram</span></pre>

<p>
Bien, empezamos con el tema. Primero un nop, que ya conocemos, luego con la instrucción <strong>di</strong>, deshabilitamos las interrupciones, no las vamos a usar en este ejemplo, y solo nos molestarian.
Luego cargamos en el registro SP el puntero de pila, la dirección $ffff que es el tope de la ram de la gameboy. La pila se usa para guardar datos temporales que necesitemos, como las direcciones de retorno cuando llamamos a una subrutina. Además, la pila crece en direcciones descendentes. Asi ahora, si guardamos un byte en la pila, SP se decrementa, con lo que vale $fffe y el byte se guarda ahi. Si ahora sacamos un byte de la pila, nos devuelve el dato en $fffe e incrementa SP, que vuelve a apuntar a $ffff. 
</p>
<pre class="code asm">inicializacion<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="nu0">%11100100</span>    <span class="co1">; Colores de paleta desde el mas oscuro al</span>
                            <span class="co1">; más claro, 11 10 01 00</span>
    ld      <span class="br0">&#91;</span>rBGP<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; escribimos esto en el registro de paleta</span></pre>

<p>
Definimos una etiqueta “inicializacion” y empezamos a escribir el código que pondra nuestra gameboy a funcionar correctamente.
Primero la paleta. Como sabemos la GameBoy clásica tiene 4 colores, blanco, negro y dos tonos de gris. Podemos definir dos paletas, vamos, ordenar estos cuatro colores como queramos, para que uno sea el primero, otro el segundo, etc. Además tenemos dos paletas posibles. Esto está bien, porque asi podemos tener por ejemplo una paleta invertida para efectos o cosas asi.
Pero de momento vamos a usar sólo una paleta muy normalita, los colores del mas oscuro (11), al más claro (00).
Entonces con la instrucción <strong>ld</strong>, una de las más importantes y que más usareis en ensamblador de gameboy (básicamente porque sirve para mover datos de un lado a otro de muchas maneras posibles), cargamos en el registro “a”, los datos de la paleta (%11100100 en binario).
La instrucción ld, se construye básicamente de la siguiente manera, <strong>ld &lt;destino&gt; &lt;origen&gt;</strong>, donde destino y origen pueden ser registros, direcciones de memoria o números directos.
</p>

<p>
Ahora con otro ld, cargamos en la dirección de memoria apuntada por rBGP (si miramos gbhw.ic, veremos que rBGP es una dirección de memoria normal), el contenido del registro “a”; rBGP va entre corchetes porque lo que queremos decir es que guarde en esa dirección de memoria.
</p>

<p>
Vamos a explicar esto:
Si tenemos que el registro “a”, contiene el numero 200, y hacemos “ld a, 5”, ahora “a” contiene 5. Pero si por el contrario hacemos “ld [a], 5” lo que estamos haciendo es grabar en la posición de memoria apuntada por “a”, el valor 5, con lo que escribiriamos 5 en la posición de memoria 200 (que era el valor que tenia “a” al inicio).
</p>
<pre class="code asm">    ld      a<span class="sy1">,</span> <span class="nu0">0</span>            <span class="co1">; escribimos 0 en los registros de scroll X e Y</span>
    ld      <span class="br0">&#91;</span>rSCX<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; con lo que posicionamos la pantalla visible</span>
    ld      <span class="br0">&#91;</span>rSCY<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; al inicio (arriba a la izq) del fondo.</span></pre>

<p>
Bien, sencillo ¿verdad?, como hemos visto, simplemente cargamos 0 en el registro a (a=0) y después escribimos el contenido de a, en los registros de scroll vertical y horizontal, con lo que ahora valen 0, posicionando la pantalla arriba a la izquierda del mapa de fondo. Fijaros que usamos los corchetes, para referirnos a, escribe este dato en la posición de memoria apuntada por rSCX y rSCY.
</p>
<pre class="code asm">    <span class="kw1">call</span>    apaga_LCD       <span class="co1">; llamamos a la rutina que apaga el LCD</span></pre>

<p>
Aqui con <strong>call</strong>, llamamos a una subrutina. Las subrutinas en ensamblador, son como las funciones en C u otro lenguaje de programación. Son bloques de código que ejecutan ciertas operaciones y cuando terminan, regresan al lugar del que fueron llamadas. El ensamblador buscará una etiqueta llamada apagaLCD, saltará ahi, y ejecutará el código que se encuentre a continuación, hasta que encuentre la instrucción <strong>ret</strong>, que vuelve al punto en que la subrutina fue llamada.
Al contrario que en C u otros lenguajes, si deseamos pasar parámetros a las subrutinas, tenemos que hacerlo nosotros mismos, preocupandonos de guardar ciertos datos en registros o en la pila antes de llamar a la subrutina, y de tener cuidado de no modificar indeseadamente registros que estemos usando fuera de la subrutina, un error común que nos puede dar buenos dolores de cabeza.
</p>
<pre class="code asm">    <span class="co1">; cargamos el tile en la memoria de tiles</span>
&nbsp;
    ld      hl<span class="sy1">,</span> TileCara    <span class="co1">; cargamos en HL la dirección de nuestro tile</span>
    ld      de<span class="sy1">,</span> _VRAM       <span class="co1">; en DE dirección de la memoria de video</span>
    ld      b<span class="sy1">,</span> <span class="nu0">16</span>           <span class="co1">; b = 16, numero de bytes a copiar</span>
&nbsp;
<span class="sy1">.</span>bucle_carga<span class="sy1">:</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>hl<span class="br0">&#93;</span>          <span class="co1">; cargamos en A el dato apuntado por HL</span>
    ld      <span class="br0">&#91;</span>de<span class="br0">&#93;</span><span class="sy1">,</span> a         <span class="co1">; y lo metemos en la dirección apuntada en DE</span>
    <span class="kw1">dec</span>     b               <span class="co1">; decrementamos b, b=b-1</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>fin_bucle_carga <span class="co1">; si b = 0, terminamos, no queda nada por copiar</span>
    <span class="kw1">inc</span>     hl              <span class="co1">; incrementamos la dirección a leer de</span>
    <span class="kw1">inc</span>     de              <span class="co1">; incrementamos la dirección a escribir en</span>
    jr      <span class="sy1">.</span>bucle_carga    <span class="co1">; seguimos</span>
<span class="sy1">.</span>fin_bucle_carga<span class="sy1">:</span></pre>

<p>
Bueno, vamos con algo interesante, ya que nos va a enseñar como se hacen las cosas en ensamblador, especialmente los bucles. Con este código vamos a cargar en la memoria de tiles, los 16 bytes que definen nuestra cara sonriente. Podriamos hacerlo simplemente con instrucciones ld cargando byte a byte… cargariamos un byte en a por ejemplo, y luego cargariamos el contenido de a, en una direccion de memoria a partir del comienzo de la memoria de tiles, luego el siguiente, etc… pero imaginaros que tenemos que cargar 50 tiles… como que no.
Para eso están los bucles, como en cualquier lenguaje de programación.
Veamos como lo hacemos.
</p>

<p>
Primero, empezamos inicializando ciertos registros con datos. Cargamos en hl(registro de 16 bit), la dirección donde están los bytes de nuestro tile. Si usamos una etiqueta en una instrucción ld, el ensamblador la substituye por la dirección de memoria donde empieza el código o datos después de la etiqueta. Tenemos que usar un registro de 16 bit, porque como hemos visto, las direcciones de memoria del gbz80, son de 16 bits.
</p>

<p>
Luego cargamos en el registro de, la dirección de memoria de video, que empieza en $8000 y que como hemos visto, es la direccion de inicio de la memoria de tiles.
</p>

<p>
Y ahora cargamos en el registro b, el número 16, que son los bytes que tenemos que copiar.
</p>

<p>
Ahora empezamos con el bucle. Ponemos una etiqueta al inicio del bucle, porque tendremos que ir volviendo a ella en cada “vuelta” del bucle. Bien, cargamos en a, el dato apuntado por hl, como sabemos en hl está la dirección donde comienzan los datos de nuestro sprite. Asi que con esta instrucción, cargamos en a, el primer byte de nuestro tile. Ahora metemos en la dirección apuntada por de, el contenido de a, con lo que ya tenemos el primer byte de nuestro tile, copiado a la primera dirección de memoria de tiles. Ahora decrementamos b, usando la instrucción <strong>dec</strong>, que simplemente resta una unidad al registro que le digamos. Como ya hemos copiado un byte, pues ya solo quedan 15 por copiar, asi que restamos uno a b, para reflejar esto.
</p>

<p>
Y ahora viene la lógica principal del bucle. Con jr z, .fin_bucle_carga, lo que hacemos es decir, “salta a .fin_bucle_carga si el resultado de la operación anterior ha sido cero”. Como vimos en la sección de flags, z significaba que el flag zero habia sido activado. Asi que si el resultado de la operación anterior, dec b, es cero, saltamos fuera del bucle, porque ya hemos terminado de copiar. Es sencillo, en cada vuelta del bucle, vamos restando uno a b, asi que cuando hayamos copiado los 16 bytes, b valdrá cero, se activará el flag y el jz z, saltará fuera. 
</p>

<p>
Si el flag de zero no está activado, porque b todavia no es cero, pues no se produce el salto, y la ejecución sigue a continuacion. Ahora con <strong>inc</strong>, incrementamos (sumamos uno) a hl y de. Hacemos esto, porque como ya habíamos copiado el primer dato a la primera dirección de memoria de tiles, ahora tenemos que seguir con el segundo, tercero, etc, asi que en cada vuelta del bucle, incrementamos estas dos direcciones, que irán apuntando a las siguientes direcciones de nuestros datos y de las posiciones de memorias de tiles respectivamente. Y para finalizar, saltamos a .bucle_carga, para copiar los siguientes datos, hasta que b sea cero, con lo que saltará hasta .fin_bloque_carga, terminando nuestro bucle.
</p>
<pre class="code asm">    <span class="co1">; escribimos nuestro tile, en el mapa de tiles</span>
&nbsp;
    ld      hl<span class="sy1">,</span> _SCRN0      <span class="co1">; en HL la dirección del mapa de fondo</span>
    ld      <span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>       <span class="co1">; $00 = el tile 0, nuestro tile.</span></pre>

<p>
Esto es muy sencillo comparado con lo anterior. Simplemente cargamos en hl la dirección del mapa de tiles de fondo, y luego escribimos en esta dirección, el byte cero, para indicarle, que el tile 0,0 del mapa de fondo, sea el tile cero, el primer tile de la tabla, que como sabeis, acabamos de escribir en la tabla de tiles.
</p>
<pre class="code asm">    <span class="co1">; configuramos y activamos el display</span>
    ld      a<span class="sy1">,</span> LCDCF_ON|LCDCF_BG8000|LCDCF_BG9800|LCDCF_BGON|LCDCF_OBJ8|LCDCF_OBJOFF
    ld      <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span> a</pre>

<p>
Pues nada, ya hemos metido los datos de nuestro tile al inicio de la memoria de tiles, por lo que es el tile cero, y hemos escrito un cero en la primera posición del mapa de fondo, con lo que el primer tile del fondo (0,0 esquina superior izquierda), será nuestro sprite. Entonces ahora podemos activar el LCD para ver nuestra creación. Lo que hacemos es cargar en a, ciertas configuraciones del lcd, que están definidas en el gbhw.inc. haciendo un OR (|) entre esas configuraciones, las seleccionamos todas, LCDCF_ON (lcd encendido), LCDCF_BG8000 (tile data en $8000), LCDCF_BG9800 (tile map en $9800), LCDCF_BGON (fondo activado), LCDCF_OBJ8 (sprites de 8&times;8), LCDCF_OBJOFF (sprites desactivados). Y entonces escribimos a en la posición de memoria del registro de control del LCD, que aplicará esa configuración. A partir de aqui, tendriamos nuestro tile en pantalla.
</p>
<pre class="code asm">    <span class="co1">; bucle infinito</span>
bucle<span class="sy1">:</span>
    halt
    <span class="kw1">nop</span>
    jr      bucle</pre>

<p>
Bien, en ensamblador, cuando llegamos a un punto muerto, tenemos que hacer un bucle infinito. ¿Por qué?, porque si no, el procesador seguiria ejecutando código que no hemos escrito, vamos, las siguientes posiciones de memoria después de nuestro código, que no sabemos que contienen (normalmente valores aleatorios), asi que podria pasar cualquier cosa. Asi que ahora, que nuestro programa ha terminado, y no vamos a hacer nada más, creamos este bucle infinito, que se ejecutará hasta que apaguemos la consola o se acaben las pilas <img src="lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />
</p>

<p>
Es muy sencillo, hacemos un halt, que pone el procesador en modo de bajo consumo y detiene la ejecución hasta que ocurra una interrupción. Como podrian llegar interrupciones, pues seguidamente hacemos un nop (nada) y saltamos al inicio del bucle de nuevo, con lo que nos quedariamos aqui por siempre.
</p>
<pre class="code asm"><span class="co1">; Rutina de apagado del LCD</span>
apaga_LCD<span class="sy1">:</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>
    rlca                    <span class="co1">; Pone el bit alto de LCDC en el flag de acarreo</span>
    <span class="kw1">ret</span>     nc              <span class="co1">; La pantalla ya está apagada, volver.</span>
&nbsp;
    <span class="co1">; esperamos al VBlank, ya que no podemos apagar la pantalla</span>
    <span class="co1">; en otro momento</span>
&nbsp;
<span class="sy1">.</span>espera_VBlank
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rLY<span class="br0">&#93;</span>
    cp      <span class="nu0">145</span>
    jr      nz<span class="sy1">,</span> <span class="sy1">.</span>espera_VBlank
&nbsp;
    <span class="co1">; estamos en VBlank, apagamos el LCD</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>       <span class="co1">; en A, el contenido del LCDC</span>
    res     <span class="nu0">7</span><span class="sy1">,</span>a             <span class="co1">; ponemos a cero el bit 7 (activado del LCD)</span>
    ld      <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span>a       <span class="co1">; escribimos en el registro LCDC el contenido de A</span>
&nbsp;
    <span class="kw1">ret</span>                     <span class="co1">; volvemos</span></pre>

<p>
Bien, nuestro programa ha terminado, pero a continuación podemos escribir datos o subrutinas que podrán ser llamadas o usadas por nuestro código si el programa principal hace referecia a ellas. Este es el caso de la rutina apaga_LCD, que habíamos llamado desde el programa principal con el comando <strong>call</strong>.
</p>

<p>
Vamos a analizarla. Lo primero que hacemos, es cargar en a, el contenido del registro de control del lcd, rLCDC. ahora ejecutamos la orden <strong>rlca</strong>. Es una orden bastante peculiar, que lo hace es poner el bit 7 del registro a, en el flag de acarreo. ¿Para que vale esto? pues para hacer comprobaciones, claro, que es lo que hacemos a continuación. Como habiamos comentado, la instrucción ret, sale de la subrutina y devuelve la ejecución a donde se dejó con call, pero ret. también puede aceptar condiciones para retornar o no, dependiendo de un flag. En este caso comprobamos el flag de acarreo, exactamente si está a cero.  ret nc, significa, “retorna si el flag de acarreo es cero”. En el flag de acarreo habiamos puesto el bit 7 de rLCDC, y si miramos que significa ese bit en la sección de video, vemos que significa si el LCD está encendido o apagado. Lo vais viendo, podriamos entonces traducirlo como: “retorna si el lcd está apagado”, vamos, que no tiene sentido apagar el LCD si ya está apagado, por lo tanto, si ya lo está, volvemos y nuestra subrutina no hace nada.
</p>

<p>
Si no estuviera apagado, el bit 7 de rLCDC valdria 1, y por lo tanto el ret no se ejecutaria, con lo que la ejecución continuaria. Vale, ahora como vimos, era muy importante no apagar el LCD mientras no estuviera en el intervalo vertical, porque se podria dañar. Entonces es lo que hacemos ahora. Comprobamos el registro rLY, para ver en que linea se encuentra dibujando el LCD, si es 145, significa que ya está fuera de la pantalla, en el intervalo vertical, y podemos continuar. Si no, seguimos esperando hasta que rLY sea 145.
</p>

<p>
Y ahora apagamos el LCD, cargamos el contenido del rLCDC en a, y con la instrución <strong>res</strong>, que resetea (pone a cero) el bit que le digamos del registro a, pone a cero el bit 7, que como sabemos enciende o apaga el LCD. Ahora volvemos a escribir el contenido de a en rLCDC, con lo que hemos cambiado el bit 7 sin afectar al resto del contenido de rLCDC.
</p>

<p>
El LCD está apagado, con lo que podemos volver con ret.
</p>
<pre class="code asm"><span class="co1">; Datos de nuestro tile</span>
TileCara<span class="sy1">:</span>
    <span class="kw5">DB</span>  <span class="sy2">$</span>7C<span class="sy1">,</span> <span class="sy2">$</span>7C<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>FE<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>D6<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>D6
    <span class="kw5">DB</span>  <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>FE<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>BA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>C6<span class="sy1">,</span> <span class="sy2">$</span>7C<span class="sy1">,</span> <span class="sy2">$</span>7C
EndTileCara<span class="sy1">:</span></pre>

<p>
Y aqui, a continuación escribimos los datos de nuestro sprite. Es común poner los datos entre etiquetas significativas, y además añadir una etiqueta al final. Ahora sabemos que tenemos 16 tiles, pero si tuvieramos muchos, en vez de contarlos, podriamos decirle al ensamblador, que cargue EndTileCara-TileCara bytes, con lo que el ensamblador contaria cuantos bytes hay entre esas direcciones y substituiria ese valor en nuestro programa. Asi que por costumbre está bien hacer esto.
</p>

<p>
Como veis, ponemos los datos de nuestro sprite tal cual, separados por comas, y predecidos por la directiva DB, de Define Byte, que simplemente inserta esos valores en la memoria de nuestro programa tal cual, para usarlos como datos.
</p>

<p>
Por cosas como estas, os decia que era importante el bucle infinito al final de nuestro programa, porque si no, el programa seguiria ejecutando cualquier cosa que pudiera haber a continuacion, y podria interpretar datos de gráficos, música, o textos, como si fueran instrucciones, con lo que podria pasar cualquier cosa <img src="lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />
</p>

<p>
Y hasta aqui nuestro programa de ejemplo, que como habeis visto tiene sus pequeños errores (a propósito), para que veais que hay que inicializar bien las memorias.
</p>

</div>

<h3 class="sectionedit16" id="mejoras">Mejoras</h3>
<div class="level3">

<p>
Entonces ahora, vamos a aplicar un par de mejoras a nuestro programa, os explico lo que voy a hacer, y luego os dejo el código bien comentado para que lo estudieis y trateis de entenderlo.
Primero, voy a definir otro tile, el tile cero, que será un tile totalmente blanco, y con él, voy a llenar todo el mapa de fondo antes de hacer nada. Con lo que, como supondreis, borraré toda la pantalla en blanco.
Después simplemente cambiaré el tile que voy a dibujar en 0,0 por el tile 1, ya que ahora nuestra cara feliz será el segundo tile, y lo dibujaré, por lo demás el programa será el mismo.
</p>

<p>
Os dejo el código:
</p>
<dl class="code">
<dt><a href="holamundo2ed5c.asm?do=export_code&amp;id=tutorial_de_ensamblador&amp;codeblock=28" title="Descargar trozo de código fuente" class="mediafile mf_asm">holamundo2.asm</a></dt>
<dd><pre class="code asm"><span class="co1">; Hola mundo mejorado</span>
<span class="co1">; David Pello 2010</span>
<span class="co1">; ladecadence.net</span>
<span class="co1">; Para el tutorial en: </span>
<span class="co1">; http://wiki.ladecadence.net/doku.php?id=tutorial_de_ensamblador</span>
&nbsp;
INCLUDE <span class="st0">&quot;gbhw.inc&quot;</span>          <span class="co1">; importamos el archivo de definiciones</span>
&nbsp;
&nbsp;
<span class="co1">; El programa comienza aqui:</span>
<span class="kw5">SECTION</span> <span class="st0">&quot;start&quot;</span><span class="sy1">,</span>ROM0<span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">0100</span><span class="br0">&#93;</span>
    <span class="kw1">nop</span>
    <span class="kw1">jp</span>      inicio
&nbsp;
<span class="co1">; Cabecera de la ROM (Macro definido en gbhw.inc)</span>
<span class="co1">; define una rom sin mapper, de 32K y sin RAM, lo más básico</span>
<span class="co1">; (como por ejemplo la del tetris)</span>
    ROM_HEADER  ROM_NOMBC<span class="sy1">,</span> ROM_SIZE_32KBYTE<span class="sy1">,</span> RAM_SIZE_0KBYTE
&nbsp;
<span class="co1">; aqui empieza nuestro programa</span>
inicio<span class="sy1">:</span>
    <span class="kw1">nop</span>
    <span class="kw4">di</span>                      <span class="co1">; deshabilita las interrupciones</span>
    ld      <span class="kw4">sp</span><span class="sy1">,</span> <span class="sy2">$</span>ffff       <span class="co1">; apuntamos la pila al tope de la ram</span>
&nbsp;
inicializacion<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="nu0">%11100100</span>    <span class="co1">; Colores de paleta desde el mas oscuro al</span>
                            <span class="co1">; más claro, 11 10 01 00</span>
    ld      <span class="br0">&#91;</span>rBGP<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; escribimos esto en el registro de paleta</span>
&nbsp;
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>            <span class="co1">; escribimos 0 en los registros de scroll X e Y</span>
    ld      <span class="br0">&#91;</span>rSCX<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; con lo que posicionamos la pantalla visible</span>
    ld      <span class="br0">&#91;</span>rSCY<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; al inicio (arriba a la izq) del fondo.</span>
&nbsp;
    <span class="kw1">call</span>    apaga_LCD       <span class="co1">; llamamos a la rutina que apaga el LCD</span>
&nbsp;
    <span class="co1">; cargamos los tiles en la memoria de tiles</span>
&nbsp;
    ld      hl<span class="sy1">,</span> Tiles       <span class="co1">; cargamos en HL la dirección de nuestro tile</span>
    ld      de<span class="sy1">,</span> _VRAM       <span class="co1">; en DE dirección de la memoria de video</span>
    ld      b<span class="sy1">,</span> <span class="nu0">32</span>           <span class="co1">; b = 32, numero de bytes a copiar (2 tiles)</span>
&nbsp;
<span class="sy1">.</span>bucle_carga<span class="sy1">:</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>hl<span class="br0">&#93;</span>          <span class="co1">; cargamos en A el dato apuntado por HL</span>
    ld      <span class="br0">&#91;</span>de<span class="br0">&#93;</span><span class="sy1">,</span> a         <span class="co1">; y lo metemos en la dirección apuntada en DE</span>
    <span class="kw1">dec</span>     b               <span class="co1">; decrementamos b, b=b-1</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>fin_bucle_carga <span class="co1">; si b = 0, terminamos, no queda nada por copiar</span>
    <span class="kw1">inc</span>     hl              <span class="co1">; incrementamos la dirección a leer de</span>
    <span class="kw1">inc</span>     de              <span class="co1">; incrementamos la dirección a escribir en</span>
    jr      <span class="sy1">.</span>bucle_carga    <span class="co1">; seguimos</span>
<span class="sy1">.</span>fin_bucle_carga<span class="sy1">:</span>
&nbsp;
    <span class="co1">; ahora limpiamos la pantalla (llenamos todo el mapa de fondo), con el tile 0</span>
&nbsp;
    ld      hl<span class="sy1">,</span> _SCRN0
    ld      de<span class="sy1">,</span> <span class="nu0">32</span><span class="sy1">*</span><span class="nu0">32</span>       <span class="co1">; numero de tiles en el mapa de fondo</span>
<span class="sy1">.</span>bucle_limpieza<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>            <span class="co1">; el tile 0 es nuestro tile vacio</span>
    ld      <span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="kw1">dec</span>     de
    <span class="co1">; ahora tengo que comprobar si 'de' es cero, para ver si tengo que </span>
    <span class="co1">; terminar de copiar. dec de no modifica ningun flag, asi que no puedo</span>
    <span class="co1">; comprobar el flag zero directamente, pero para que 'de' sea cero, d y e </span>
    <span class="co1">; tienen que ser cero los dos, asi que puedo hacer un or entre ellos, </span>
    <span class="co1">; y si el resultado es cero, ambos son cero.</span>
    ld      a<span class="sy1">,</span> d            <span class="co1">; cargamos d en a</span>
    <span class="kw1">or</span>      e               <span class="co1">; y hacemos un or con e</span>
    <span class="kw1">jp</span>      z<span class="sy1">,</span> <span class="sy1">.</span>fin_bucle_limpieza  <span class="co1">; si d OR e es cero, de es cero. Terminamos.</span>
    <span class="kw1">inc</span>     hl              <span class="co1">; incrementamos la dirección a escribir en</span>
    <span class="kw1">jp</span>      <span class="sy1">.</span>bucle_limpieza
<span class="sy1">.</span>fin_bucle_limpieza
&nbsp;
    <span class="co1">; bien, tenemos todo el mapa de tiles lleno con el tile 0, </span>
    <span class="co1">;ahora podemos pintar el nuestro</span>
&nbsp;
    <span class="co1">; escribimos nuestro tile, en el mapa de tiles</span>
&nbsp;
    ld      hl<span class="sy1">,</span> _SCRN0      <span class="co1">; en HL la dirección del mapa de fondo</span>
    ld      <span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">01</span>       <span class="co1">; $01 = el tile 1, nuestro tile.</span>
&nbsp;
    <span class="co1">; configuramos y activamos el display</span>
    ld      a<span class="sy1">,</span> LCDCF_ON|LCDCF_BG8000|LCDCF_BG9800|LCDCF_BGON|LCDCF_OBJ8|LCDCF_OBJOFF
    ld      <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; bucle infinito</span>
bucle<span class="sy1">:</span>
    halt
    <span class="kw1">nop</span>
    jr      bucle
&nbsp;
<span class="co1">; Rutina de apagado del LCD</span>
apaga_LCD<span class="sy1">:</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>
    rlca                    <span class="co1">; Pone el bit alto de LCDC en el flag de acarreo</span>
    <span class="kw1">ret</span>     nc              <span class="co1">; La pantalla ya está apagada, volver.</span>
&nbsp;
    <span class="co1">; esperamos al VBlank, ya que no podemos apagar la pantalla</span>
    <span class="co1">; en otro momento</span>
&nbsp;
<span class="sy1">.</span>espera_VBlank
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rLY<span class="br0">&#93;</span>
    cp      <span class="nu0">145</span>
    jr      nz<span class="sy1">,</span> <span class="sy1">.</span>espera_VBlank
&nbsp;
    <span class="co1">; estamos en VBlank, apagamos el LCD</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>       <span class="co1">; en A, el contenido del LCDC</span>
    res     <span class="nu0">7</span><span class="sy1">,</span>a             <span class="co1">; ponemos a cero el bit 7 (activado del LCD)</span>
    ld      <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span>a       <span class="co1">; escribimos en el registro LCDC el contenido de A</span>
&nbsp;
    <span class="kw1">ret</span>                     <span class="co1">; volvemos</span>
&nbsp;
<span class="co1">; Datos de nuestros tiles</span>
Tiles<span class="sy1">:</span>
    <span class="kw5">DB</span>  <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>
    <span class="kw5">DB</span>  <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>
    <span class="kw5">DB</span>  <span class="sy2">$</span>7C<span class="sy1">,</span> <span class="sy2">$</span>7C<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>FE<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>D6<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>D6
    <span class="kw5">DB</span>  <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>FE<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>BA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">82</span><span class="sy1">,</span> <span class="sy2">$</span>C6<span class="sy1">,</span> <span class="sy2">$</span>7C<span class="sy1">,</span> <span class="sy2">$</span>7C
EndTiles<span class="sy1">:</span></pre>
</dd></dl>

<p>
Y el resultado, esta vez si:
</p>

<p>
<a href="lib/exe/detail656b.html?id=tutorial_de_ensamblador&amp;media=bgb00002.png" class="media" title="bgb00002.png"><img src="lib/exe/bgb00002dcf0.png_%3b?media=bgb00002.png" class="media" alt="" /></a>
</p>

</div>

<h1 class="sectionedit17" id="hola_sprites">Hola sprites</h1>
<div class="level1">

<p>
Bien, ahora vamos a modificar el hola mundo, para crear y manejar un sprite. Lo primero, voy a crear otro tile diferente al blanco, va a ser un tile de fondo suave, para que podais ver como el sprite se mueve por encima sin problemas. Entonces haré esto, iniciaré la gameboy, como en el hola mundo, pero añadiendo una paleta también para los sprites (usaré la misma), llenaré el fondo con un tile suave, y luego crearé un sprite, y lo iré moviendo rebotado por la pantalla. Usaré una pequeña rutina de retardo para que todo vaya más lento. Vamos a ver el código:
</p>
<dl class="code">
<dt><a href="holasprite82a8.asm?do=export_code&amp;id=tutorial_de_ensamblador&amp;codeblock=29" title="Descargar trozo de código fuente" class="mediafile mf_asm">holasprite.asm</a></dt>
<dd><pre class="code asm"><span class="co1">; Hola sprite</span>
<span class="co1">; David Pello 2010</span>
<span class="co1">; ladecadence.net</span>
<span class="co1">; Para el tutorial en: </span>
<span class="co1">; http://wiki.ladecadence.net/doku.php?id=tutorial_de_ensamblador</span>
&nbsp;
INCLUDE <span class="st0">&quot;gbhw.inc&quot;</span>          <span class="co1">; importamos el archivo de definiciones</span>
&nbsp;
<span class="co1">; definimos unas constantes para trabajar con nuestro sprite</span>
_SPR0_Y     <span class="kw5">EQU</span>     _OAMRAM <span class="co1">; la Y del sprite 0, es el inicio de la mem de sprites</span>
_SPR0_X     <span class="kw5">EQU</span>     _OAMRAM<span class="sy1">+</span><span class="nu0">1</span>
_SPR0_NUM   <span class="kw5">EQU</span>     _OAMRAM<span class="sy1">+</span><span class="nu0">2</span>
_SPR0_ATT   <span class="kw5">EQU</span>     _OAMRAM<span class="sy1">+</span><span class="nu0">3</span>
&nbsp;
<span class="co1">; creamos un par de variables para ver hacia donde tenemos que mover el sprite</span>
_MOVX       <span class="kw5">EQU</span>     _RAM    <span class="co1">; inicio de la ram dispobible para datos</span>
_MOVY       <span class="kw5">EQU</span>     _RAM<span class="sy1">+</span><span class="nu0">1</span>
&nbsp;
<span class="co1">; El programa comienza aqui:</span>
<span class="kw5">SECTION</span> <span class="st0">&quot;start&quot;</span><span class="sy1">,</span>ROM0<span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">0100</span><span class="br0">&#93;</span>
    <span class="kw1">nop</span>
    <span class="kw1">jp</span>      inicio
&nbsp;
<span class="co1">; Cabecera de la ROM (Macro definido en gbhw.inc)</span>
<span class="co1">; define una rom sin mapper, de 32K y sin RAM, lo más básico</span>
<span class="co1">; (como por ejemplo la del tetris)</span>
    ROM_HEADER  ROM_NOMBC<span class="sy1">,</span> ROM_SIZE_32KBYTE<span class="sy1">,</span> RAM_SIZE_0KBYTE
&nbsp;
<span class="co1">; aqui empieza nuestro programa</span>
inicio<span class="sy1">:</span>
    <span class="kw1">nop</span>
    <span class="kw4">di</span>                      <span class="co1">; deshabilita las interrupciones</span>
    ld      <span class="kw4">sp</span><span class="sy1">,</span> <span class="sy2">$</span>ffff       <span class="co1">; apuntamos la pila al tope de la ram</span>
&nbsp;
inicializacion<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="nu0">%11100100</span>    <span class="co1">; Colores de paleta desde el mas oscuro al</span>
                            <span class="co1">; más claro, 11 10 01 00</span>
    ld      <span class="br0">&#91;</span>rBGP<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; escribimos esto en el registro de paleta de fondo</span>
    ld      <span class="br0">&#91;</span>rOBP0<span class="br0">&#93;</span><span class="sy1">,</span> a      <span class="co1">; y en la paleta 0 de sprites</span>
&nbsp;
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>            <span class="co1">; escribimos 0 en los registros de scroll X e Y</span>
    ld      <span class="br0">&#91;</span>rSCX<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; con lo que posicionamos la pantalla visible</span>
    ld      <span class="br0">&#91;</span>rSCY<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; al inicio (arriba a la izq) del fondo.</span>
&nbsp;
    <span class="kw1">call</span>    apaga_LCD       <span class="co1">; llamamos a la rutina que apaga el LCD</span>
&nbsp;
    <span class="co1">; cargamos los tiles en la memoria de tiles</span>
&nbsp;
    ld      hl<span class="sy1">,</span> Tiles       <span class="co1">; cargamos en HL la dirección de nuestro tile</span>
    ld      de<span class="sy1">,</span> _VRAM       <span class="co1">; en DE dirección de la memoria de video</span>
    ld      b<span class="sy1">,</span> <span class="nu0">32</span>           <span class="co1">; b = 32, numero de bytes a copiar (2 tiles)</span>
&nbsp;
<span class="sy1">.</span>bucle_carga<span class="sy1">:</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>hl<span class="br0">&#93;</span>          <span class="co1">; cargamos en A el dato apuntado por HL</span>
    ld      <span class="br0">&#91;</span>de<span class="br0">&#93;</span><span class="sy1">,</span> a         <span class="co1">; y lo metemos en la dirección apuntada en DE</span>
    <span class="kw1">dec</span>     b               <span class="co1">; decrementamos b, b=b-1</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>fin_bucle_carga <span class="co1">; si b = 0, terminamos, no queda nada por copiar</span>
    <span class="kw1">inc</span>     hl              <span class="co1">; incrementamos la dirección a leer de</span>
    <span class="kw1">inc</span>     de              <span class="co1">; incrementamos la dirección a escribir en</span>
    jr      <span class="sy1">.</span>bucle_carga    <span class="co1">; seguimos</span>
<span class="sy1">.</span>fin_bucle_carga<span class="sy1">:</span>
&nbsp;
    <span class="co1">; ahora limpiamos la pantalla (llenamos todo el mapa de fondo), con el tile 0</span>
&nbsp;
    ld      hl<span class="sy1">,</span> _SCRN0
    ld      de<span class="sy1">,</span> <span class="nu0">32</span><span class="sy1">*</span><span class="nu0">32</span>       <span class="co1">; numero de tiles en el mapa de fondo</span>
<span class="sy1">.</span>bucle_limpieza<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>            <span class="co1">; el tile 0 es nuestro tile vacio</span>
    ld      <span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="kw1">dec</span>     de
    <span class="co1">; ahora tengo que comprobar si de es cero, para ver si tengo que </span>
    <span class="co1">; terminar de copiar. dec de no modifica ningñun flag, asi que no puedo</span>
    <span class="co1">; comprobar el flag zero directamente, pero para que de sea cero, d y e </span>
    <span class="co1">; tienen que ser cero los dos, asi que puedo hacer un or entre ellos, </span>
    <span class="co1">; y si el resultado es cero, ambos son cero.</span>
    ld      a<span class="sy1">,</span> d            <span class="co1">; cargamos d en a</span>
    <span class="kw1">or</span>      e               <span class="co1">; y hacemos un or con e</span>
    <span class="kw1">jp</span>      z<span class="sy1">,</span> <span class="sy1">.</span>fin_bucle_limpieza  <span class="co1">; si d OR e es cero, de es cero. Terminamos.</span>
    <span class="kw1">inc</span>     hl              <span class="co1">; incrementamos la dirección a escribir en</span>
    <span class="kw1">jp</span>      <span class="sy1">.</span>bucle_limpieza
<span class="sy1">.</span>fin_bucle_limpieza
&nbsp;
    <span class="co1">; bien, tenemos todo el mapa de tiles lleno con el tile 0, </span>
    <span class="co1">; ahora vamos a crear el sprite.</span>
&nbsp;
    ld      a<span class="sy1">,</span> <span class="nu0">30</span>
    ld      <span class="br0">&#91;</span>_SPR0_Y<span class="br0">&#93;</span><span class="sy1">,</span> a    <span class="co1">; posición Y del sprite     </span>
    ld      a<span class="sy1">,</span> <span class="nu0">30</span>
    ld      <span class="br0">&#91;</span>_SPR0_X<span class="br0">&#93;</span><span class="sy1">,</span> a    <span class="co1">; posición X del sprite</span>
    ld      a<span class="sy1">,</span> <span class="nu0">1</span>
    ld      <span class="br0">&#91;</span>_SPR0_NUM<span class="br0">&#93;</span><span class="sy1">,</span> a  <span class="co1">; número de tile en la tabla de tiles que usaremos</span>
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>
    ld      <span class="br0">&#91;</span>_SPR0_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a  <span class="co1">; atributos especiales, de momento nada.</span>
&nbsp;
    <span class="co1">; configuramos y activamos el display</span>
    ld      a<span class="sy1">,</span> LCDCF_ON|LCDCF_BG8000|LCDCF_BG9800|LCDCF_BGON|LCDCF_OBJ8|LCDCF_OBJON
    ld      <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; preparamos las variables de la animacion</span>
    ld      a<span class="sy1">,</span> <span class="nu0">1</span>
    ld      <span class="br0">&#91;</span>_MOVX<span class="br0">&#93;</span><span class="sy1">,</span> a
    ld      <span class="br0">&#91;</span>_MOVY<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; bucle infinito</span>
animacion<span class="sy1">:</span>
    <span class="co1">; lo primero, esperamos por el VBlank, ya que no podemos modificar</span>
    <span class="co1">; la VRAM fuera de él, o pasarán cosas raras</span>
<span class="sy1">.</span>wait<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rLY<span class="br0">&#93;</span>
    cp      <span class="nu0">145</span>
    jr      nz<span class="sy1">,</span> <span class="sy1">.</span>wait
    <span class="co1">; incrementamos las y</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_SPR0_Y<span class="br0">&#93;</span>    <span class="co1">; cargamos la posición Y actual del sprite</span>
    ld      hl<span class="sy1">,</span> _MOVY       <span class="co1">; en hl, la dirección del incremento Y</span>
    <span class="kw1">add</span>     a<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>         <span class="co1">; sumamos</span>
    ld      hl<span class="sy1">,</span> _SPR0_Y
    ld      <span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> a         <span class="co1">; guardamos</span>
    <span class="co1">; comparamos para ver si hay que cambiar el sentido</span>
    cp      <span class="nu0">152</span>             <span class="co1">; para que no se salga de la pantalla (max Y)</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>dec_y
    cp      <span class="nu0">16</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>inc_y       <span class="co1">; lo mismo, minima coord Y=16</span>
    <span class="co1">; no hay que cambiar</span>
    jr      <span class="sy1">.</span>end_y
<span class="sy1">.</span>dec_y<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="sy1">-</span><span class="nu0">1</span>           <span class="co1">; ahora hay que decrementar las Y</span>
    ld      <span class="br0">&#91;</span>_MOVY<span class="br0">&#93;</span><span class="sy1">,</span> a
    jr      <span class="sy1">.</span>end_y
<span class="sy1">.</span>inc_y<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="nu0">1</span>            <span class="co1">; ahora hay que incrementar las Y</span>
    ld      <span class="br0">&#91;</span>_MOVY<span class="br0">&#93;</span><span class="sy1">,</span> a
<span class="sy1">.</span>end_y<span class="sy1">:</span>
    <span class="co1">; vamos con las X, lo mismo pero cambiando los márgenes</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_SPR0_X<span class="br0">&#93;</span>    <span class="co1">; cargamos la posición X actual del sprite</span>
    ld      hl<span class="sy1">,</span> _MOVX       <span class="co1">; en hl, la dirección del incremento X</span>
    <span class="kw1">add</span>     a<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>         <span class="co1">; sumamos</span>
    ld      hl<span class="sy1">,</span> _SPR0_X
    ld      <span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> a         <span class="co1">; guardamos</span>
    <span class="co1">; comparamos para ver si hay que cambiar el sentido</span>
    cp      <span class="nu0">160</span>             <span class="co1">; para que no se salga de la pantalla (max X)</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>dec_x
    cp      <span class="nu0">8</span>               <span class="co1">; lo mismo, minima coord izq = 8</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>inc_x
    <span class="co1">; no hay que cambiar</span>
    jr      <span class="sy1">.</span>end_x
<span class="sy1">.</span>dec_x<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="sy1">-</span><span class="nu0">1</span>           <span class="co1">; ahora hay que decrementar las X</span>
    ld      <span class="br0">&#91;</span>_MOVX<span class="br0">&#93;</span><span class="sy1">,</span> a
    jr      <span class="sy1">.</span>end_x
<span class="sy1">.</span>inc_x<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="nu0">1</span>            <span class="co1">; ahora hay que incrementar las X</span>
    ld      <span class="br0">&#91;</span>_MOVX<span class="br0">&#93;</span><span class="sy1">,</span> a
<span class="sy1">.</span>end_x<span class="sy1">:</span>
    <span class="co1">; un pequeño retardo</span>
    <span class="kw1">call</span> retardo
    <span class="co1">; volvemos a empezar</span>
    jr      animacion
&nbsp;
<span class="co1">; Rutina de apagado del LCD</span>
apaga_LCD<span class="sy1">:</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>
    rlca                    <span class="co1">; Pone el bit alto de LCDC en el flag de acarreo</span>
    <span class="kw1">ret</span>     nc              <span class="co1">; La pantalla ya está apagada, volver.</span>
&nbsp;
    <span class="co1">; esperamos al VBlank, ya que no podemos apagar la pantalla</span>
    <span class="co1">; en otro momento</span>
&nbsp;
<span class="sy1">.</span>espera_VBlank
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rLY<span class="br0">&#93;</span>
    cp      <span class="nu0">145</span>
    jr      nz<span class="sy1">,</span> <span class="sy1">.</span>espera_VBlank
&nbsp;
    <span class="co1">; estamos en VBlank, apagamos el LCD</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>       <span class="co1">; en A, el contenido del LCDC</span>
    res     <span class="nu0">7</span><span class="sy1">,</span>a             <span class="co1">; ponemos a cero el bit 7 (activado del LCD)</span>
    ld      <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span>a       <span class="co1">; escribimos en el registro LCDC el contenido de A</span>
&nbsp;
    <span class="kw1">ret</span>                     <span class="co1">; volvemos</span>
&nbsp;
<span class="co1">; rutina de retardo</span>
retardo<span class="sy1">:</span>
    ld      de<span class="sy1">,</span> <span class="nu0">2000</span>        <span class="co1">; numero de veces a ejecutar el bucle</span>
<span class="sy1">.</span>delay<span class="sy1">:</span>
    <span class="kw1">dec</span>     de              <span class="co1">; decrementamos</span>
    ld      a<span class="sy1">,</span> d            <span class="co1">; vemos si es cero</span>
    <span class="kw1">or</span>      e
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>fin_delay
    <span class="kw1">nop</span>
    jr      <span class="sy1">.</span>delay
<span class="sy1">.</span>fin_delay<span class="sy1">:</span>
    <span class="kw1">ret</span>
&nbsp;
<span class="co1">; Datos de nuestros tiles</span>
Tiles<span class="sy1">:</span>
    <span class="kw5">DB</span>  <span class="sy2">$</span>AA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">44</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span>AA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">11</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>
    <span class="kw5">DB</span>  <span class="sy2">$</span>AA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">44</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span>AA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">11</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>
    <span class="kw5">DB</span>  <span class="sy2">$</span>3E<span class="sy1">,</span> <span class="sy2">$</span>3E<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">7F</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span>6B<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">7F</span>
    <span class="kw5">DB</span>  <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">63</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">7F</span><span class="sy1">,</span> <span class="sy2">$</span>3E<span class="sy1">,</span> <span class="sy2">$</span>3E<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>
EndTiles<span class="sy1">:</span></pre>
</dd></dl>

<p>
El resultado:
</p>

<p>
<a href="lib/exe/detail2901.html?id=tutorial_de_ensamblador&amp;media=bgb00003.png" class="media" title="bgb00003.png"><img src="lib/exe/bgb00003a830.png_%3b?media=bgb00003.png" class="media" alt="" /></a>
</p>

</div>

<h1 class="sectionedit18" id="hola_joypad">Hola JoyPad</h1>
<div class="level1">

<p>
Bien, vamos a crear un ejemplo para leer el Pad y los botones. 
Si vamos a los estupendos PanDocs y su sección sobre el pad, (<a href="../external.html?link=http://gbdev.gg8.se/wiki/articles/Joypad_Input" class="urlextern" title="http://gbdev.gg8.se/wiki/articles/Joypad_Input" rel="nofollow">http://gbdev.gg8.se/wiki/articles/Joypad_Input</a>), vemos que tenemos un registro mapeado en memoria, en $FF00, que vamos a llamar rP1 (de Player 1), que podemos leer para conocer el estado del pad y los botones. Bien, supongo que para ahorrar pines en la CPU de la gameboy, los diseñadores decidieron implementar un diseño tipo matriz para los botones de la GameBoy, con lo que el pad direccional (4 botones), y los botones A, B, Select, y Start, comparten las lineas de entrada. ¿Entonces cómo podemos saber cual está pulsado?. Pues como vemos en los PanDocs, hay dos bits en ese registro, que nos permiten “activar” o el pad o los botones, y entonces leer de ellos. Vamos a ver el registro:
</p>
<pre class="code"> Bit 7 - Sin uso
 Bit 6 - Sin uso
 Bit 5 - P15 Selecciona los botones        (0=Selecciona)
 Bit 4 - P14 Selecciona el PAD direccional (0=Selecciona)
 Bit 3 - P13 Abajo o Start                 (0=Pulsado) (Sólo lectura)
 Bit 2 - P12 Arriba o Select               (0=Pulsado) (Sólo lectura)
 Bit 1 - P11 Izquierda o B                 (0=Pulsado) (Sólo lectura)
 Bit 0 - P10 Derecha o A                   (0=Pulsado) (Sólo lectura)</pre>

<p>
Entonces, ¿cómo vamos a hacer para leer todos los botones? Bien, sencillo, vamos a crear una rutina que lo que hará es:
</p>
<ul>
<li class="level1"><div class="li"> Activar el pad y desactivar los botones</div>
</li>
<li class="level1"><div class="li"> Leer los cuatro ultimos bits del registro del pad en A (con lo que tenemos en A el estado del PAD direccional)</div>
</li>
<li class="level1"><div class="li"> Poner a cero los 4 bits superiores de A (sólo nos importan los 4 bajos)</div>
</li>
<li class="level1"><div class="li"> Intercambiar los 4 bits bajos de A por los altos (para que los bajos nos queden libres de nuevo y el PAD direccional quede guardado en los altos)</div>
</li>
<li class="level1"><div class="li"> Mover A a otro registro temporal (B por ejemplo)</div>
</li>
<li class="level1"><div class="li"> Activar los botones y desactivar el PAD</div>
</li>
<li class="level1"><div class="li"> Leer los cuatro últimos bits del registro del pad en A (con lo que tenemos en A el estado de los botones)</div>
</li>
<li class="level1"><div class="li"> Poner a cero los 4 bits superiores de A (sólo nos importan los bajos)</div>
</li>
<li class="level1"><div class="li"> Hacer un OR con el registro temporal (B), para asi, tener en A el estado de todos los botones (el pad en los 4 bits altos, y los botones en los 4 bajos)</div>
</li>
<li class="level1"><div class="li"> Obtener el complemento de A, lo que cambia los 0&#039;s por 1&#039;s y los 1&#039;s por ceros, asi tendremos unos en los botones pulsados, en vez de al revés</div>
</li>
<li class="level1"><div class="li"> Guardar A en una variable en memoria.</div>
</li>
</ul>

<p>
Luego comprobaremos esa variable para saber que botones están pulsados (los bits que estén a 0) y moveremos el sprite según los botones. También vamos a alternar entre las dos posibles paletas de sprites, cuando se pulse A.
</p>

<p>
Una cosa a tener en cuenta, es el “bouncing”. Los contactos eléctricos de los pulsadores de cada botón, pueden sufrir del efecto conocido como “bouncing” esto es, a nivel microscópico cuando pulsamos un botón, los contactos rebotan produciendo pequeños saltos en la señal, con lo que por un pequeño espacio de tiempo, la señal no es real, y puedes leer que un botón no está pulsado, cuando si lo está, o que el botón está pulsado cuando acabas de soltarlo. Los aparatos modernos, suelen llevar circuiteria que controla este bouncing, pero la GameBoy no. La solución es sencilla, realizar unas cuantas lecturas seguidas, para intentar minimizar este efecto.
</p>

<p>
Además he añadido código para limpiar la memoria de atributos de sprites, para poner los 40 sprites, todo a cero, asi, los sprites no usados, quedarán fuera de la pantalla. Quizá en los emuladores no pase nada, pero en la GameBoy real, que he probado, un par de sprites con “basura” aparecian por el medio de la pantalla. Nunca se sabe lo que pueden contener los chips de RAM al iniciar (estática y demás), asi que recordad, inicializar siempre.
</p>

<p>
Pues vamos con el programa:
</p>
<dl class="code">
<dt><a href="holajoypade60c.asm?do=export_code&amp;id=tutorial_de_ensamblador&amp;codeblock=31" title="Descargar trozo de código fuente" class="mediafile mf_asm">holajoypad.asm</a></dt>
<dd><pre class="code asm"><span class="co1">; Hola joypad</span>
<span class="co1">; David Pello 2010</span>
<span class="co1">; ladecadence.net</span>
<span class="co1">; Para el tutorial en: </span>
<span class="co1">; http://wiki.ladecadence.net/doku.php?id=tutorial_de_ensamblador</span>
&nbsp;
INCLUDE <span class="st0">&quot;gbhw.inc&quot;</span>          <span class="co1">; importamos el archivo de definiciones</span>
&nbsp;
<span class="co1">; definimos unas constantes para trabajar con nuestro sprite</span>
_SPR0_Y     <span class="kw5">EQU</span>     _OAMRAM <span class="co1">; la Y del sprite 0, es el inicio de la mem de sprites</span>
_SPR0_X     <span class="kw5">EQU</span>     _OAMRAM<span class="sy1">+</span><span class="nu0">1</span>
_SPR0_NUM   <span class="kw5">EQU</span>     _OAMRAM<span class="sy1">+</span><span class="nu0">2</span>
_SPR0_ATT   <span class="kw5">EQU</span>     _OAMRAM<span class="sy1">+</span><span class="nu0">3</span>
&nbsp;
<span class="co1">; variable donde guardar el estado del pad</span>
_PAD        <span class="kw5">EQU</span>     _RAM <span class="co1">; al inicio de la ram interna</span>
&nbsp;
<span class="co1">; El programa comienza aqui:</span>
<span class="kw5">SECTION</span> <span class="st0">&quot;start&quot;</span><span class="sy1">,</span>ROM0<span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">0100</span><span class="br0">&#93;</span>
    <span class="kw1">nop</span>
    <span class="kw1">jp</span>      inicio
&nbsp;
<span class="co1">; Cabecera de la ROM (Macro definido en gbhw.inc)</span>
<span class="co1">; define una rom sin mapper, de 32K y sin RAM, lo más básico</span>
<span class="co1">; (como por ejemplo la del tetris)</span>
    ROM_HEADER  ROM_NOMBC<span class="sy1">,</span> ROM_SIZE_32KBYTE<span class="sy1">,</span> RAM_SIZE_0KBYTE
&nbsp;
<span class="co1">; aqui empieza nuestro programa</span>
inicio<span class="sy1">:</span>
    <span class="kw1">nop</span>
    <span class="kw4">di</span>                      <span class="co1">; deshabilita las interrupciones</span>
    ld      <span class="kw4">sp</span><span class="sy1">,</span> <span class="sy2">$</span>ffff       <span class="co1">; apuntamos la pila al tope de la ram</span>
&nbsp;
inicializacion<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="nu0">%11100100</span>    <span class="co1">; Colores de paleta desde el mas oscuro al</span>
                            <span class="co1">; más claro, 11 10 01 00</span>
    ld      <span class="br0">&#91;</span>rBGP<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; escribimos esto en el registro de paleta de fondo</span>
    ld      <span class="br0">&#91;</span>rOBP0<span class="br0">&#93;</span><span class="sy1">,</span> a      <span class="co1">; y en la paleta 0 de sprites</span>
&nbsp;
    <span class="co1">; creamos otra paleta para la paleta 2 de sprites, inversa a la normal</span>
    ld      a<span class="sy1">,</span> <span class="nu0">%00011011</span>
    ld      <span class="br0">&#91;</span>rOBP1<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
&nbsp;
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>            <span class="co1">; escribimos 0 en los registros de scroll X e Y</span>
    ld      <span class="br0">&#91;</span>rSCX<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; con lo que posicionamos la pantalla visible</span>
    ld      <span class="br0">&#91;</span>rSCY<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; al inicio (arriba a la izq) del fondo.</span>
&nbsp;
    <span class="kw1">call</span>    apaga_LCD       <span class="co1">; llamamos a la rutina que apaga el LCD</span>
&nbsp;
    <span class="co1">; cargamos los tiles en la memoria de tiles</span>
&nbsp;
    ld      hl<span class="sy1">,</span> Tiles       <span class="co1">; cargamos en HL la dirección de nuestro tile</span>
    ld      de<span class="sy1">,</span> _VRAM       <span class="co1">; en DE dirección de la memoria de video</span>
    ld      b<span class="sy1">,</span> <span class="nu0">32</span>           <span class="co1">; b = 32, numero de bytes a copiar (2 tiles)</span>
&nbsp;
<span class="sy1">.</span>bucle_carga<span class="sy1">:</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>hl<span class="br0">&#93;</span>          <span class="co1">; cargamos en A el dato apuntado por HL</span>
    ld      <span class="br0">&#91;</span>de<span class="br0">&#93;</span><span class="sy1">,</span> a         <span class="co1">; y lo metemos en la dirección apuntada en DE</span>
    <span class="kw1">dec</span>     b               <span class="co1">; decrementamos b, b=b-1</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>fin_bucle_carga <span class="co1">; si b = 0, terminamos, no queda nada por copiar</span>
    <span class="kw1">inc</span>     hl              <span class="co1">; incrementamos la dirección a leer de</span>
    <span class="kw1">inc</span>     de              <span class="co1">; incrementamos la dirección a escribir en</span>
    jr      <span class="sy1">.</span>bucle_carga    <span class="co1">; seguimos</span>
<span class="sy1">.</span>fin_bucle_carga<span class="sy1">:</span>
&nbsp;
    <span class="co1">; ahora limpiamos la pantalla (llenamos todo el mapa de fondo), con el tile 0</span>
&nbsp;
    ld      hl<span class="sy1">,</span> _SCRN0
    ld      de<span class="sy1">,</span> <span class="nu0">32</span><span class="sy1">*</span><span class="nu0">32</span>       <span class="co1">; numero de tiles en el mapa de fondo</span>
<span class="sy1">.</span>bucle_limpieza_fondo<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>            <span class="co1">; el tile 0 es nuestro tile vacio</span>
    ld      <span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="kw1">dec</span>     de
    <span class="co1">; ahora tengo que comprobar si de es cero, para ver si tengo que </span>
    <span class="co1">; terminar de copiar. dec de no modifica ningún flag, asi que no puedo</span>
    <span class="co1">; comprobar el flag zero directamente, pero para que de sea cero, d y e </span>
    <span class="co1">; tienen que ser cero los dos, asi que puedo hacer un or entre ellos, </span>
    <span class="co1">; y si el resultado es cero, ambos son cero.</span>
    ld      a<span class="sy1">,</span> d            <span class="co1">; cargamos d en a</span>
    <span class="kw1">or</span>      e               <span class="co1">; y hacemos un or con e</span>
    <span class="kw1">jp</span>      z<span class="sy1">,</span> <span class="sy1">.</span>fin_bucle_limpieza_fondo    <span class="co1">; si d OR e es cero, de es cero. </span>
                                            <span class="co1">; Terminamos.</span>
    <span class="kw1">inc</span>     hl              <span class="co1">; incrementamos la dirección a escribir en</span>
    <span class="kw1">jp</span>      <span class="sy1">.</span>bucle_limpieza_fondo
<span class="sy1">.</span>fin_bucle_limpieza_fondo
&nbsp;
    <span class="co1">; bien, tenemos todo el mapa de tiles lleno con el tile 0</span>
    <span class="co1">; ahora limpiamos la memoria de sprites</span>
&nbsp;
    ld      hl<span class="sy1">,</span> _OAMRAM     <span class="co1">; memoria de atributos de sprites</span>
    ld      de<span class="sy1">,</span> <span class="nu0">40</span><span class="sy1">*</span><span class="nu0">4</span>        <span class="co1">; 40 sprites x 4 bytes cada uno</span>
<span class="sy1">.</span>bucle_limpieza_sprites
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>            <span class="co1">; lo vamos a poner todo a cero, asi los sprites</span>
    ld      <span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> a         <span class="co1">; sin uso, quedarán fuera de pantalla</span>
    <span class="kw1">dec</span>     de
    <span class="co1">; lo mismo que en bucle anterior</span>
    ld      a<span class="sy1">,</span> d            <span class="co1">; cargamos d en a</span>
    <span class="kw1">or</span>      e               <span class="co1">; y hacemos un or con e</span>
    <span class="kw1">jp</span>      z<span class="sy1">,</span> <span class="sy1">.</span>fin_bucle_limpieza_sprites  <span class="co1">; si d OR e es cero, de es cero.</span>
    <span class="kw1">inc</span>     hl              <span class="co1">; incrementamos la dirección a escribir en</span>
    <span class="kw1">jp</span>      <span class="sy1">.</span>bucle_limpieza_sprites
<span class="sy1">.</span>fin_bucle_limpieza_sprites
&nbsp;
    <span class="co1">; ahora vamos a crear el sprite.</span>
&nbsp;
    ld      a<span class="sy1">,</span> <span class="nu0">74</span>
    ld      <span class="br0">&#91;</span>_SPR0_Y<span class="br0">&#93;</span><span class="sy1">,</span> a    <span class="co1">; posición Y del sprite     </span>
    ld      a<span class="sy1">,</span> <span class="nu0">90</span>
    ld      <span class="br0">&#91;</span>_SPR0_X<span class="br0">&#93;</span><span class="sy1">,</span> a    <span class="co1">; posición X del sprite</span>
    ld      a<span class="sy1">,</span> <span class="nu0">1</span>
    ld      <span class="br0">&#91;</span>_SPR0_NUM<span class="br0">&#93;</span><span class="sy1">,</span> a  <span class="co1">; número de tile en la tabla de tiles que usaremos</span>
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>
    ld      <span class="br0">&#91;</span>_SPR0_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a  <span class="co1">; atributos especiales, de momento nada.</span>
&nbsp;
    <span class="co1">; configuramos y activamos el display</span>
    ld      a<span class="sy1">,</span> LCDCF_ON|LCDCF_BG8000|LCDCF_BG9800|LCDCF_BGON|LCDCF_OBJ8|LCDCF_OBJON
    ld      <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
<span class="co1">; bucle principal</span>
movimiento<span class="sy1">:</span>
    <span class="co1">; leemos el pad</span>
    <span class="kw1">call</span>    lee_pad
    <span class="co1">; lo primero, esperamos por el VBlank, ya que no podemos modificar</span>
    <span class="co1">; la VRAM fuera de él, o pasarán cosas raras</span>
<span class="sy1">.</span>wait<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rLY<span class="br0">&#93;</span>
    cp      <span class="nu0">145</span>
    jr      nz<span class="sy1">,</span> <span class="sy1">.</span>wait
&nbsp;
    <span class="co1">; Ahora movemos el sprite dependiendo de los botones</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span>       <span class="co1">; cargamos el estado del pad</span>
    <span class="kw1">and</span>     <span class="nu0">%00010000</span>       <span class="co1">; derecha</span>
    <span class="kw1">call</span>    nz<span class="sy1">,</span> mueve_derecha   <span class="co1">; si el resultado no es cero, habia un 1 ahi</span>
                                <span class="co1">; entonces llamamos a la subrutina</span>
&nbsp;
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="nu0">%00100000</span>       <span class="co1">; izquierda</span>
    <span class="kw1">call</span>    nz<span class="sy1">,</span> mueve_izquierda
&nbsp;
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="nu0">%01000000</span>       <span class="co1">; arriba</span>
    <span class="kw1">call</span>    nz<span class="sy1">,</span> mueve_arriba
&nbsp;
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="nu0">%10000000</span>       <span class="co1">; abajo</span>
    <span class="kw1">call</span>    nz<span class="sy1">,</span> mueve_abajo
&nbsp;
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="nu0">%00000001</span>       <span class="co1">; Boton A</span>
    <span class="kw1">call</span>    nz<span class="sy1">,</span> cambia_paleta
&nbsp;
    <span class="co1">; un pequeño retardo</span>
    <span class="kw1">call</span> retardo
    <span class="co1">; volvemos a empezar</span>
    jr      movimiento
&nbsp;
&nbsp;
<span class="co1">; Rutinas de movimiento</span>
mueve_derecha<span class="sy1">:</span>
    ld      a<span class="sy1">,</span>  <span class="br0">&#91;</span>_SPR0_X<span class="br0">&#93;</span>   <span class="co1">; obtenemos la posición actual</span>
    cp      <span class="nu0">160</span>             <span class="co1">; estamos en la esquina?</span>
    <span class="kw1">ret</span>     z               <span class="co1">; si estamos en la esquina, volvemos</span>
&nbsp;
    <span class="kw1">inc</span>     a               <span class="co1">; avanzamos</span>
    ld      <span class="br0">&#91;</span>_SPR0_X<span class="br0">&#93;</span><span class="sy1">,</span> a    <span class="co1">; guardamos la posicion</span>
&nbsp;
    <span class="kw1">ret</span>                     <span class="co1">; volvemos</span>
&nbsp;
mueve_izquierda<span class="sy1">:</span>
    ld      a<span class="sy1">,</span>  <span class="br0">&#91;</span>_SPR0_X<span class="br0">&#93;</span>   <span class="co1">; obtenemos la posición actual</span>
    cp      <span class="nu0">8</span>               <span class="co1">; estamos en la esquina?</span>
    <span class="kw1">ret</span>     z               <span class="co1">; si estamos en la esquina, volvemos</span>
&nbsp;
    <span class="kw1">dec</span>     a               <span class="co1">; retrocedemos</span>
    ld      <span class="br0">&#91;</span>_SPR0_X<span class="br0">&#93;</span><span class="sy1">,</span> a    <span class="co1">; guardamos la posicion</span>
&nbsp;
    <span class="kw1">ret</span>
&nbsp;
mueve_arriba<span class="sy1">:</span>
    ld      a<span class="sy1">,</span>  <span class="br0">&#91;</span>_SPR0_Y<span class="br0">&#93;</span>   <span class="co1">; obtenemos la posición actual</span>
    cp      <span class="nu0">16</span>              <span class="co1">; estamos en la esquina?</span>
    <span class="kw1">ret</span>     z               <span class="co1">; si estamos en la esquina, volvemos</span>
&nbsp;
    <span class="kw1">dec</span>     a               <span class="co1">; retrocedemos</span>
    ld      <span class="br0">&#91;</span>_SPR0_Y<span class="br0">&#93;</span><span class="sy1">,</span> a    <span class="co1">; guardamos la posicion</span>
&nbsp;
    <span class="kw1">ret</span>
&nbsp;
mueve_abajo<span class="sy1">:</span>
    ld      a<span class="sy1">,</span>  <span class="br0">&#91;</span>_SPR0_Y<span class="br0">&#93;</span>   <span class="co1">; obtenemos la posición actual</span>
    cp      <span class="nu0">152</span>             <span class="co1">; estamos en la esquina?</span>
    <span class="kw1">ret</span>     z               <span class="co1">; si estamos en la esquina, volvemos</span>
&nbsp;
    <span class="kw1">inc</span>     a               <span class="co1">; avanzamos</span>
    ld      <span class="br0">&#91;</span>_SPR0_Y<span class="br0">&#93;</span><span class="sy1">,</span> a    <span class="co1">; guardamos la posicion</span>
&nbsp;
    <span class="kw1">ret</span>
&nbsp;
cambia_paleta<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_SPR0_ATT<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="nu0">%00010000</span>       <span class="co1">; en el bit 4, está el numero de paleta</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>paleta0     <span class="co1">; si es cero, estaba seleccionada la paleta 0   </span>
&nbsp;
    <span class="co1">; si no, estaba seleccionada la paleta 1</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_SPR0_ATT<span class="br0">&#93;</span>
    res     <span class="nu0">4</span><span class="sy1">,</span> a            <span class="co1">; ponemos a cero el bit 4, seleccionando la paleta 0</span>
    ld      <span class="br0">&#91;</span>_SPR0_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a  <span class="co1">; guardamos los atributos</span>
&nbsp;
    <span class="kw1">call</span>    retardo         <span class="co1">; el cambio es muy rapido, vamos a esperar un poco</span>
    <span class="kw1">ret</span>                     <span class="co1">; volvemos</span>
<span class="sy1">.</span>paleta0<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_SPR0_ATT<span class="br0">&#93;</span>
    set     <span class="nu0">4</span><span class="sy1">,</span> a            <span class="co1">; ponemos a uno el bit 4, seleccionando la paleta 1</span>
    ld      <span class="br0">&#91;</span>_SPR0_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a  <span class="co1">; guardamos los atributos</span>
&nbsp;
    <span class="kw1">call</span>    retardo
    <span class="kw1">ret</span>                     <span class="co1">; volvemos</span>
&nbsp;
<span class="co1">; Rutina de lectura del pad</span>
lee_pad<span class="sy1">:</span>
    <span class="co1">; vamos a leer la cruzeta:</span>
    ld      a<span class="sy1">,</span> <span class="nu0">%00100000</span>    <span class="co1">; bit 4 a 0, bit 5 a 1 (cruzeta activada, botones no)</span>
    ld      <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; ahora leemos el estado de la cruzeta, para evitar el bouncing</span>
    <span class="co1">; hacemos varias lecturas</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
&nbsp;
    <span class="kw1">and</span>     <span class="sy2">$</span><span class="nu0">0F</span>             <span class="co1">; solo nos importan los 4 bits de abajo.</span>
    swap    a               <span class="co1">; intercambiamos parte baja y alta.</span>
    ld      b<span class="sy1">,</span> a            <span class="co1">; guardamos el estado de la cruzeta en b</span>
&nbsp;
    <span class="co1">; vamos a por los botones</span>
    ld      a<span class="sy1">,</span> <span class="nu0">%00010000</span>    <span class="co1">; bit 4 a 1, bit 5 a 0 (botones activados, cruzeta no)</span>
    ld      <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; leemos varias veces para evitar el bouncing</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
&nbsp;
    <span class="co1">; tenemos en A, el estado de los botones</span>
    <span class="kw1">and</span>     <span class="sy2">$</span><span class="nu0">0F</span>             <span class="co1">; solo nos importan los 4 bits de abajo.</span>
    <span class="kw1">or</span>      b               <span class="co1">; hacemos un or con b, para &quot;meter&quot; en la parte</span>
                            <span class="co1">; superior de A, el estado de la cruzeta.</span>
&nbsp;
    <span class="co1">; ahora tenemos en A, el estado de todo, hacemos el complemento y</span>
    <span class="co1">; lo guardamos en la variable</span>
    cpl
    ld      <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="co1">; volvemos</span>
    <span class="kw1">ret</span>
&nbsp;
<span class="co1">; Rutina de apagado del LCD</span>
apaga_LCD<span class="sy1">:</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>
    rlca                    <span class="co1">; Pone el bit alto de LCDC en el flag de acarreo</span>
    <span class="kw1">ret</span>     nc              <span class="co1">; La pantalla ya está apagada, volver.</span>
&nbsp;
    <span class="co1">; esperamos al VBlank, ya que no podemos apagar la pantalla</span>
    <span class="co1">; en otro momento</span>
&nbsp;
<span class="sy1">.</span>espera_VBlank
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rLY<span class="br0">&#93;</span>
    cp      <span class="nu0">145</span>
    jr      nz<span class="sy1">,</span> <span class="sy1">.</span>espera_VBlank
&nbsp;
    <span class="co1">; estamos en VBlank, apagamos el LCD</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>       <span class="co1">; en A, el contenido del LCDC</span>
    res     <span class="nu0">7</span><span class="sy1">,</span>a             <span class="co1">; ponemos a cero el bit 7 (activado del LCD)</span>
    ld      <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span>a       <span class="co1">; escribimos en el registro LCDC el contenido de A</span>
&nbsp;
    <span class="kw1">ret</span>                     <span class="co1">; volvemos</span>
&nbsp;
<span class="co1">; rutina de retardo</span>
retardo<span class="sy1">:</span>
    ld      de<span class="sy1">,</span> <span class="nu0">2000</span>        <span class="co1">; numero de veces a ejecutar el bucle</span>
<span class="sy1">.</span>delay<span class="sy1">:</span>
    <span class="kw1">dec</span>     de              <span class="co1">; decrementamos</span>
    ld      a<span class="sy1">,</span> d            <span class="co1">; vemos si es cero</span>
    <span class="kw1">or</span>      e
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>fin_delay
    <span class="kw1">nop</span>
    jr      <span class="sy1">.</span>delay
<span class="sy1">.</span>fin_delay<span class="sy1">:</span>
    <span class="kw1">ret</span>
&nbsp;
<span class="co1">; Datos de nuestros tiles</span>
Tiles<span class="sy1">:</span>
    <span class="kw5">DB</span>  <span class="sy2">$</span>AA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">44</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span>AA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">11</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>
    <span class="kw5">DB</span>  <span class="sy2">$</span>AA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">44</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span>AA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">11</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>
    <span class="kw5">DB</span>  <span class="sy2">$</span>3E<span class="sy1">,</span> <span class="sy2">$</span>3E<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">7F</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span>6B<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">7F</span>
    <span class="kw5">DB</span>  <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">63</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">7F</span><span class="sy1">,</span> <span class="sy2">$</span>3E<span class="sy1">,</span> <span class="sy2">$</span>3E<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>
EndTiles<span class="sy1">:</span></pre>
</dd></dl>

</div>

<h1 class="sectionedit19" id="hola_ventana">Hola Ventana</h1>
<div class="level1">

<p>
Ahora en el siguiente ejemplo vamos a hacer uso de la ventana, a modo de las típicas pantallas de “start” con datos que aparecen en algunos juegos. Juegos como el Zelda usan esta técnica. Simplemente, cargamos el otro mapa de tiles (recordad que habia dos mapas, uno en $9800-$9BFF, y otro en $9C00-$9FFF), con los tiles que queremos mostrar en la ventana, y le decimos a la ventana, que use este mapa para la ventana al inciciar el <em>rLCDC</em>.
Pero además, para este ejemplo he añadido bastantes cosas. Para empezar he creado un mapa de fondo con varios tiles como si fuera una pantalla de un juego, y nos podremos mover a través de lo ancho del mapa usando los registros de scroll. Asi, cuando el sprite llegue a cierta posición no le dejaremos avanzar más, pero moveremos el scroll para que parezca que sigue avanzando más allá de la pantalla.
Además voy a usar un sprite de 16&times;16. ¿Cómo? Pues sencillo, usando 4 sprites de 8&times;8 juntos y moviéndolos a la vez cuando sea necesario. Además haré uso de los atributos de los sprites haciéndoles un espejado dependiendo si se mueven a izquierda o derecha, asi puedo usar los mismos tiles para ambas direcciones.
Otro truco que he usado es ir cambiando entre tres juegos de sprites para el personaje cuando se está moviendo. Así da la impresión de que se mueven sus piernas. Las subrutinas responsables son <em>num_spr_mario</em>, y <em>camina_mario</em>. Además la rutina <em>sin_pulsaciones</em> vuelve al sprite del personaje quieto cuando no se pulsa nada.
En el código, podeis ver que he añadido por ejemplo las subrutinas <em>CopiaMemoria</em> y <em>RellenaMemoria</em>. Como estaba haciendo varias copias para rellenar los tiles en memoria, los mapas, limpiar los sprites, etc, pues las he dejado como subrutinas que esperan los datos en ciertos registros, asi podemos reutilizarlas.
También he dejado los sprites en archivos aparte, asi puedo hacer modificaciones más fácilmente. Al final, veis que uso los includes entre dos etiquetas para delimitar los datos dentro de cada archivo.
</p>

<p>
Y nada, todo esto junto, a continuación:
</p>
<dl class="code">
<dt><a href="holaventana2c8b.asm?do=export_code&amp;id=tutorial_de_ensamblador&amp;codeblock=32" title="Descargar trozo de código fuente" class="mediafile mf_asm">holaventana.asm</a></dt>
<dd><pre class="code asm"><span class="co1">; Hola ventana</span>
<span class="co1">; David Pello 2010</span>
<span class="co1">; ladecadence.net</span>
<span class="co1">; Para el tutorial en: </span>
<span class="co1">; http://wiki.ladecadence.net/doku.php?id=tutorial_de_ensamblador</span>
&nbsp;
INCLUDE <span class="st0">&quot;gbhw.inc&quot;</span>			<span class="co1">; importamos el archivo de definiciones</span>
&nbsp;
<span class="co1">; definimos unas constantes para trabajar con nuestros sprites</span>
_SPR0_Y		<span class="kw5">EQU</span>		_OAMRAM	<span class="co1">; la Y del sprite 0, es el inicio de la mem de sprites</span>
_SPR0_X		<span class="kw5">EQU</span>		_OAMRAM<span class="sy1">+</span><span class="nu0">1</span>
_SPR0_NUM	<span class="kw5">EQU</span>		_OAMRAM<span class="sy1">+</span><span class="nu0">2</span>
_SPR0_ATT	<span class="kw5">EQU</span>		_OAMRAM<span class="sy1">+</span><span class="nu0">3</span>
&nbsp;
_SPR1_Y     	<span class="kw5">EQU</span>     	_OAMRAM<span class="sy1">+</span><span class="nu0">4</span>
_SPR1_X     	<span class="kw5">EQU</span>     	_OAMRAM<span class="sy1">+</span><span class="nu0">5</span>
_SPR1_NUM   	<span class="kw5">EQU</span>     	_OAMRAM<span class="sy1">+</span><span class="nu0">6</span>
_SPR1_ATT   	<span class="kw5">EQU</span>     	_OAMRAM<span class="sy1">+</span><span class="nu0">7</span>
&nbsp;
_SPR2_Y     	<span class="kw5">EQU</span>     	_OAMRAM<span class="sy1">+</span><span class="nu0">8</span>
_SPR2_X     	<span class="kw5">EQU</span>     	_OAMRAM<span class="sy1">+</span><span class="nu0">9</span>
_SPR2_NUM   	<span class="kw5">EQU</span>     	_OAMRAM<span class="sy1">+</span><span class="nu0">10</span>
_SPR2_ATT   	<span class="kw5">EQU</span>     	_OAMRAM<span class="sy1">+</span><span class="nu0">11</span>
&nbsp;
_SPR3_Y     	<span class="kw5">EQU</span>     	_OAMRAM<span class="sy1">+</span><span class="nu0">12</span>
_SPR3_X     	<span class="kw5">EQU</span>     	_OAMRAM<span class="sy1">+</span><span class="nu0">13</span>
_SPR3_NUM   	<span class="kw5">EQU</span>     	_OAMRAM<span class="sy1">+</span><span class="nu0">14</span>
_SPR3_ATT   	<span class="kw5">EQU</span>     	_OAMRAM<span class="sy1">+</span><span class="nu0">15</span>
&nbsp;
<span class="co1">; VARIABLES</span>
<span class="co1">; variable donde guardar el estado del pad</span>
_PAD			<span class="kw5">EQU</span>		_RAM 	<span class="co1">; al inicio de la ram interna</span>
<span class="co1">; variables de control de los sprites</span>
_POS_MAR_2		<span class="kw5">EQU</span>		_RAM<span class="sy1">+</span><span class="nu0">1</span>	<span class="co1">; posición donde colocar los segundos sprites</span>
_SPR_MAR_SUM		<span class="kw5">EQU</span>		_RAM<span class="sy1">+</span><span class="nu0">2</span>	<span class="co1">; numero a sumar a los sprites para alternarlos</span>
&nbsp;
<span class="co1">; El programa comienza aqui:</span>
<span class="kw5">SECTION</span> <span class="st0">&quot;start&quot;</span><span class="sy1">,</span>ROM0<span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">0100</span><span class="br0">&#93;</span>
    <span class="kw1">nop</span>
    <span class="kw1">jp</span>  	inicio
&nbsp;
<span class="co1">; Cabecera de la ROM (Macro definido en gbhw.inc)</span>
<span class="co1">; define una rom sin mapper, de 32K y sin RAM, lo más básico</span>
<span class="co1">; (como por ejemplo la del tetris)</span>
	ROM_HEADER  ROM_NOMBC<span class="sy1">,</span> ROM_SIZE_32KBYTE<span class="sy1">,</span> RAM_SIZE_0KBYTE
&nbsp;
<span class="co1">; aqui empieza nuestro programa</span>
inicio<span class="sy1">:</span>
	<span class="kw1">nop</span>
	<span class="kw4">di</span>					<span class="co1">; deshabilita las interrupciones</span>
	ld		<span class="kw4">sp</span><span class="sy1">,</span> <span class="sy2">$</span>ffff		<span class="co1">; apuntamos la pila al tope de la ram</span>
&nbsp;
inicializacion<span class="sy1">:</span>
&nbsp;
	<span class="co1">; iniciamos las variables</span>
	ld		hl<span class="sy1">,</span> _POS_MAR_2		<span class="co1">; sprites mirando a la dcha.</span>
	ld		<span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> <span class="sy1">-</span><span class="nu0">8</span>
&nbsp;
	ld		hl<span class="sy1">,</span> _SPR_MAR_SUM	<span class="co1">; empezamos con el 0</span>
	ld		<span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> <span class="nu0">0</span>
&nbsp;
	<span class="co1">; paletas</span>
	ld		a<span class="sy1">,</span> <span class="nu0">%11100100</span>		<span class="co1">; Colores de paleta desde el mas oscuro al</span>
						<span class="co1">; más claro, 11 10 01 00</span>
	ld		<span class="br0">&#91;</span>rBGP<span class="br0">&#93;</span><span class="sy1">,</span> a		<span class="co1">; escribimos esto en el registro de paleta de fondo</span>
	ld		<span class="br0">&#91;</span>rOBP0<span class="br0">&#93;</span><span class="sy1">,</span> a		<span class="co1">; y en la paleta 0 de sprites</span>
&nbsp;
	<span class="co1">; creamos otra paleta para la paleta 2 de sprites, para mario</span>
	ld		a<span class="sy1">,</span> <span class="nu0">%11010000</span>
	ld		<span class="br0">&#91;</span>rOBP1<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
	<span class="co1">; scroll</span>
	ld		a<span class="sy1">,</span> <span class="nu0">0</span>			<span class="co1">; escribimos 0 en los registros de scroll X e Y</span>
	ld		<span class="br0">&#91;</span>rSCX<span class="br0">&#93;</span><span class="sy1">,</span> a		<span class="co1">; con lo que posicionamos la pantalla visible</span>
	ld		<span class="br0">&#91;</span>rSCY<span class="br0">&#93;</span><span class="sy1">,</span> a		<span class="co1">; al inicio (arriba a la izq) del fondo.</span>
&nbsp;
	<span class="co1">; video</span>
	<span class="kw1">call</span>		apaga_LCD		<span class="co1">; llamamos a la rutina que apaga el LCD</span>
&nbsp;
	<span class="co1">; cargamos los tiles en la memoria de tiles</span>
&nbsp;
	ld		hl<span class="sy1">,</span> Tiles		<span class="co1">; cargamos en HL la dirección de nuestro tile</span>
	ld		de<span class="sy1">,</span> _VRAM		<span class="co1">; en DE dirección de la memoria de video</span>
	ld		bc<span class="sy1">,</span> FinTiles<span class="sy1">-</span>Tiles	<span class="co1">; número de bytes a copiar</span>
&nbsp;
	<span class="kw1">call</span>		CopiaMemoria
&nbsp;
	<span class="co1">; cargamos el mapa</span>
	ld		hl<span class="sy1">,</span> Mapa
	ld		de<span class="sy1">,</span> _SCRN0		<span class="co1">; mapa 0</span>
	ld		bc<span class="sy1">,</span> <span class="nu0">32</span><span class="sy1">*</span><span class="nu0">32</span>
	<span class="kw1">call</span>		CopiaMemoria
&nbsp;
	<span class="co1">; cargamos el mapa para la ventana</span>
	ld		hl<span class="sy1">,</span> Ventana
	ld		de<span class="sy1">,</span> _SCRN1		<span class="co1">; mapa 1</span>
	ld		bc<span class="sy1">,</span> <span class="nu0">32</span><span class="sy1">*</span><span class="nu0">32</span>
	<span class="kw1">call</span>		CopiaMemoria
&nbsp;
	<span class="co1">; bien, tenemos todo el mapa de tiles cargado</span>
	<span class="co1">; ahora limpiamos la memoria de sprites</span>
	ld		de<span class="sy1">,</span> _OAMRAM		<span class="co1">; memoria de atributos de sprites</span>
	ld		bc<span class="sy1">,</span> <span class="nu0">40</span><span class="sy1">*</span><span class="nu0">4</span>		<span class="co1">; 40 sprites x 4 bytes cada uno</span>
    	ld      	l<span class="sy1">,</span> <span class="nu0">0</span>            	<span class="co1">; lo vamos a poner todo a cero, asi los sprites</span>
	<span class="kw1">call</span>		RellenaMemoria		<span class="co1">; no usados quedan fuera de pantalla</span>
&nbsp;
	<span class="co1">; ahora vamos a crear los sprites.</span>
	ld		a<span class="sy1">,</span> <span class="nu0">136</span>
	ld		<span class="br0">&#91;</span>_SPR0_Y<span class="br0">&#93;</span><span class="sy1">,</span> a		<span class="co1">; posición Y del sprite		</span>
	ld		a<span class="sy1">,</span> <span class="nu0">80</span>
	ld		<span class="br0">&#91;</span>_SPR0_X<span class="br0">&#93;</span><span class="sy1">,</span> a		<span class="co1">; posición X del sprite</span>
	ld		a<span class="sy1">,</span> <span class="nu0">0</span>
	ld		<span class="br0">&#91;</span>_SPR0_NUM<span class="br0">&#93;</span><span class="sy1">,</span> a		<span class="co1">; número de tile en la tabla de tiles que usaremos</span>
	ld		a<span class="sy1">,</span> <span class="nu0">16</span> | <span class="nu0">32</span>
	ld 		<span class="br0">&#91;</span>_SPR0_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a		<span class="co1">; atributos especiales, paleta 1</span>
&nbsp;
    	ld      	a<span class="sy1">,</span> <span class="nu0">136</span><span class="sy1">+</span><span class="nu0">8</span>
    	ld      	<span class="br0">&#91;</span>_SPR1_Y<span class="br0">&#93;</span><span class="sy1">,</span> a    	<span class="co1">; posición Y del sprite     </span>
    	ld      	a<span class="sy1">,</span> <span class="nu0">80</span>
    	ld      	<span class="br0">&#91;</span>_SPR1_X<span class="br0">&#93;</span><span class="sy1">,</span> a    	<span class="co1">; posición X del sprite</span>
    	ld      	a<span class="sy1">,</span> <span class="nu0">1</span>
    	ld      	<span class="br0">&#91;</span>_SPR1_NUM<span class="br0">&#93;</span><span class="sy1">,</span> a  	<span class="co1">; número de tile en la tabla de tiles que usaremos</span>
   	ld     	 	a<span class="sy1">,</span> <span class="nu0">16</span> | <span class="nu0">32</span>
    	ld      	<span class="br0">&#91;</span>_SPR1_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a  	<span class="co1">; atributos especiales, paleta 1</span>
&nbsp;
    	ld      	a<span class="sy1">,</span> <span class="nu0">136</span>
    	ld      	<span class="br0">&#91;</span>_SPR2_Y<span class="br0">&#93;</span><span class="sy1">,</span> a    	<span class="co1">; posición Y del sprite     </span>
	ld		a<span class="sy1">,</span> <span class="br0">&#91;</span>_POS_MAR_2<span class="br0">&#93;</span>
	<span class="kw1">add</span>		<span class="nu0">80</span>
    	ld      	<span class="br0">&#91;</span>_SPR2_X<span class="br0">&#93;</span><span class="sy1">,</span> a    	<span class="co1">; posición X del sprite</span>
    	ld      	a<span class="sy1">,</span> <span class="nu0">2</span>
    	ld      	<span class="br0">&#91;</span>_SPR2_NUM<span class="br0">&#93;</span><span class="sy1">,</span> a  	<span class="co1">; número de tile en la tabla de tiles que usaremos</span>
    	ld      	a<span class="sy1">,</span> <span class="nu0">16</span> | <span class="nu0">32</span>
    	ld      	<span class="br0">&#91;</span>_SPR2_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a  	<span class="co1">; atributos especiales, paleta 1</span>
&nbsp;
    	ld      	a<span class="sy1">,</span> <span class="nu0">136</span><span class="sy1">+</span><span class="nu0">8</span>
    	ld      	<span class="br0">&#91;</span>_SPR3_Y<span class="br0">&#93;</span><span class="sy1">,</span> a    	<span class="co1">; posición Y del sprite     </span>
    	ld      	a<span class="sy1">,</span> <span class="br0">&#91;</span>_POS_MAR_2<span class="br0">&#93;</span>
	<span class="kw1">add</span>		a<span class="sy1">,</span> <span class="nu0">80</span>
    	ld      	<span class="br0">&#91;</span>_SPR3_X<span class="br0">&#93;</span><span class="sy1">,</span> a    	<span class="co1">; posición X del sprite</span>
    	ld     	 	a<span class="sy1">,</span> <span class="nu0">3</span>
    	ld      	<span class="br0">&#91;</span>_SPR3_NUM<span class="br0">&#93;</span><span class="sy1">,</span> a  	<span class="co1">; número de tile en la tabla de tiles que usaremos</span>
    	ld      	a<span class="sy1">,</span> <span class="nu0">16</span> | <span class="nu0">32</span>
    	ld      	<span class="br0">&#91;</span>_SPR3_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a  	<span class="co1">; atributos especiales, paleta 1</span>
&nbsp;
&nbsp;
	<span class="co1">; configuramos y activamos el display</span>
	ld  		a<span class="sy1">,</span> LCDCF_ON|LCDCF_BG8000|LCDCF_BG9800|LCDCF_BGON|LCDCF_OBJ8|LCDCF_OBJON|LCDCF_WIN9C00
	ld  		<span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
<span class="co1">; bucle principal</span>
movimiento<span class="sy1">:</span>
	<span class="co1">; leemos el pad</span>
	<span class="kw1">call</span>	lee_pad
	<span class="co1">; lo primero, esperamos por el VBlank, ya que no podemos modificar</span>
	<span class="co1">; la VRAM fuera de él, o pasarán cosas raras</span>
<span class="sy1">.</span>wait<span class="sy1">:</span>
    	ld      	a<span class="sy1">,</span> <span class="br0">&#91;</span>rLY<span class="br0">&#93;</span>
    	cp      	<span class="nu0">145</span>
    	jr      	nz<span class="sy1">,</span> <span class="sy1">.</span>wait
&nbsp;
	<span class="co1">; Ahora movemos el sprite dependiendo de los botones</span>
	ld 		a<span class="sy1">,</span> <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span>		<span class="co1">; cargamos el estado del pad</span>
	<span class="kw1">and</span>		<span class="nu0">%00010000</span>		<span class="co1">; derecha</span>
	<span class="kw1">call</span>		nz<span class="sy1">,</span> mueve_derecha	<span class="co1">; si el resultado no es cero, habia un 1 ahi</span>
						<span class="co1">; entonces llamamos a la subrutina</span>
&nbsp;
	ld		a<span class="sy1">,</span> <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span>
	<span class="kw1">and</span>    		<span class="nu0">%00100000</span>		<span class="co1">; izquierda</span>
	<span class="kw1">call</span>		nz<span class="sy1">,</span> mueve_izquierda
&nbsp;
	ld		a<span class="sy1">,</span> <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span>
	<span class="kw1">and</span>		<span class="nu0">%01000000</span>		<span class="co1">; arriba</span>
	<span class="co1">;call		nz, mueve_arriba</span>
&nbsp;
	ld		a<span class="sy1">,</span> <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span>
	<span class="kw1">and</span>		<span class="nu0">%10000000</span>		<span class="co1">; abajo</span>
	<span class="co1">;call		nz, mueve_abajo</span>
&nbsp;
	ld		a<span class="sy1">,</span> <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span>
	<span class="kw1">and</span>		<span class="nu0">%00001000</span>		<span class="co1">; Boton START</span>
	<span class="kw1">call</span>		nz<span class="sy1">,</span> muestra_ventana
&nbsp;
	ld		a<span class="sy1">,</span> <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span>
	<span class="kw1">and</span>		<span class="nu0">%11111111</span>
	<span class="kw1">call</span>		z<span class="sy1">,</span> sin_pulsaciones
&nbsp;
	<span class="co1">; un pequeño retardo</span>
	ld		bc<span class="sy1">,</span> <span class="nu0">2000</span>
	<span class="kw1">call</span> 		retardo
	<span class="co1">; volvemos a empezar</span>
	jr 		movimiento
&nbsp;
&nbsp;
<span class="co1">; Rutinas de movimiento</span>
mueve_derecha<span class="sy1">:</span>
	ld		a<span class="sy1">,</span>  <span class="br0">&#91;</span>_SPR0_X<span class="br0">&#93;</span>		<span class="co1">; obtenemos la posición actual</span>
	cp		<span class="nu0">120</span>			<span class="co1">; estamos en la esquina?</span>
	<span class="kw1">jp</span>		nz<span class="sy1">,</span> <span class="sy1">.</span>ad			<span class="co1">; si no estamos en la esquina, avanzamos</span>
&nbsp;
	ld		a<span class="sy1">,</span> <span class="br0">&#91;</span>rSCX<span class="br0">&#93;</span>		<span class="co1">; si estamos al borde, movemos el scroll</span>
	<span class="kw1">inc</span>		a
	ld		<span class="br0">&#91;</span>rSCX<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
	<span class="co1">; modificamos los sprites</span>
	<span class="kw1">call</span>		num_spr_mario
	<span class="kw1">call</span>		camina_mario
&nbsp;
	<span class="kw1">ret</span>
<span class="sy1">.</span>ad<span class="sy1">:</span>
	<span class="co1">; los segundos sprites deben estar detras de los primeros</span>
	<span class="kw1">push</span>	af
	ld		a<span class="sy1">,</span> <span class="sy1">-</span><span class="nu0">8</span>
	ld		<span class="br0">&#91;</span>_POS_MAR_2<span class="br0">&#93;</span><span class="sy1">,</span> a
	<span class="kw1">pop</span>		af
	<span class="co1">; movimiento</span>
	<span class="kw1">inc</span>		a			<span class="co1">; avanzamos</span>
	ld		<span class="br0">&#91;</span>_SPR0_X<span class="br0">&#93;</span><span class="sy1">,</span> a		<span class="co1">; guardamos la posicion</span>
	ld		<span class="br0">&#91;</span>_SPR1_X<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
	ld		hl<span class="sy1">,</span> _POS_MAR_2		<span class="co1">; desplazamiento a los primeros</span>
	<span class="kw1">add</span>		a<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>			<span class="co1">; sumamos</span>
	ld		<span class="br0">&#91;</span>_SPR2_X<span class="br0">&#93;</span><span class="sy1">,</span> a		<span class="co1">; guardamos</span>
	ld		<span class="br0">&#91;</span>_SPR3_X<span class="br0">&#93;</span><span class="sy1">,</span> a
	<span class="co1">; derecha, por lo tanto, los sprites deben estar reflejados horizontalmente</span>
	ld		a<span class="sy1">,</span> <span class="br0">&#91;</span>_SPR0_ATT<span class="br0">&#93;</span>
	set		<span class="nu0">5</span><span class="sy1">,</span> a
	ld		<span class="br0">&#91;</span>_SPR0_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a
	ld      	<span class="br0">&#91;</span>_SPR1_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a
	ld      	<span class="br0">&#91;</span>_SPR2_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a
	ld      	<span class="br0">&#91;</span>_SPR3_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
	<span class="co1">; modificamos los prites</span>
	<span class="kw1">call</span>		num_spr_mario
	<span class="kw1">call</span>		camina_mario
&nbsp;
	<span class="kw1">ret</span>					<span class="co1">; volvemos</span>
&nbsp;
mueve_izquierda<span class="sy1">:</span>
    	ld      	a<span class="sy1">,</span>  <span class="br0">&#91;</span>_SPR0_X<span class="br0">&#93;</span>   	<span class="co1">; obtenemos la posición actual</span>
    	cp      	<span class="nu0">16</span>              	<span class="co1">; estamos en la esquina?</span>
    	<span class="kw1">jp</span>     		nz<span class="sy1">,</span> <span class="sy1">.</span>ai         	<span class="co1">; si no estamos en la esquina, avanzamos</span>
&nbsp;
	ld		a<span class="sy1">,</span> <span class="br0">&#91;</span>rSCX<span class="br0">&#93;</span>		<span class="co1">; si estamos, scroll</span>
	<span class="kw1">dec</span>		a
	ld		<span class="br0">&#91;</span>rSCX<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
	<span class="co1">; modificamos los sprites</span>
	<span class="kw1">call</span>		num_spr_mario
	<span class="kw1">call</span>		camina_mario
&nbsp;
	<span class="kw1">ret</span>
&nbsp;
<span class="sy1">.</span>ai<span class="sy1">:</span>
	<span class="co1">; los segundos sprites deben estar delante de los primeros</span>
	<span class="kw1">push</span>		af
    	ld      	a<span class="sy1">,</span> <span class="nu0">8</span>
    	ld      	<span class="br0">&#91;</span>_POS_MAR_2<span class="br0">&#93;</span><span class="sy1">,</span> a
	<span class="kw1">pop</span>		af
	<span class="co1">; movimiento</span>
    	<span class="kw1">dec</span>     	a               	<span class="co1">; retrocedemos</span>
    	ld     		<span class="br0">&#91;</span>_SPR0_X<span class="br0">&#93;</span><span class="sy1">,</span> a    	<span class="co1">; guardamos la posicion</span>
	ld      	<span class="br0">&#91;</span>_SPR1_X<span class="br0">&#93;</span><span class="sy1">,</span> a 	
&nbsp;
    	ld      	hl<span class="sy1">,</span> _POS_MAR_2    	<span class="co1">; desplazamiento a los primeros</span>
    	<span class="kw1">add</span>     	a<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>         	<span class="co1">; sumamos</span>
    	ld      	<span class="br0">&#91;</span>_SPR2_X<span class="br0">&#93;</span><span class="sy1">,</span> a    	<span class="co1">; guardamos</span>
    	ld      	<span class="br0">&#91;</span>_SPR3_X<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; izquierda, por lo tanto, los sprites deben estar reflejados horizontalmente</span>
    	ld      	a<span class="sy1">,</span> <span class="br0">&#91;</span>_SPR0_ATT<span class="br0">&#93;</span>
    	res     	<span class="nu0">5</span><span class="sy1">,</span> a
    	ld      	<span class="br0">&#91;</span>_SPR0_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a
    	ld      	<span class="br0">&#91;</span>_SPR1_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a
    	ld      	<span class="br0">&#91;</span>_SPR2_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a
    	ld      	<span class="br0">&#91;</span>_SPR3_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
	<span class="co1">; modificamos los sprites</span>
	<span class="kw1">call</span>		num_spr_mario
	<span class="kw1">call</span>		camina_mario
&nbsp;
    	<span class="kw1">ret</span>                     		<span class="co1">; volvemos</span>
&nbsp;
&nbsp;
mueve_arriba<span class="sy1">:</span>
    	ld      	a<span class="sy1">,</span>  <span class="br0">&#91;</span>_SPR0_Y<span class="br0">&#93;</span>   	<span class="co1">; obtenemos la posición actual</span>
    	cp      	<span class="nu0">16</span>              	<span class="co1">; estamos en la esquina?</span>
    	<span class="kw1">ret</span>     	z               	<span class="co1">; si estamos en la esquina, volvemos</span>
&nbsp;
    	<span class="kw1">dec</span>     	a               	<span class="co1">; retrocedemos</span>
    	ld      	<span class="br0">&#91;</span>_SPR0_Y<span class="br0">&#93;</span><span class="sy1">,</span> a    	<span class="co1">; guardamos la posicion</span>
&nbsp;
    	<span class="kw1">ret</span> 
&nbsp;
mueve_abajo<span class="sy1">:</span>
    	ld      	a<span class="sy1">,</span>  <span class="br0">&#91;</span>_SPR0_Y<span class="br0">&#93;</span>   	<span class="co1">; obtenemos la posición actual</span>
    	cp      	<span class="nu0">152</span>             	<span class="co1">; estamos en la esquina?</span>
    	<span class="kw1">ret</span>     	z               	<span class="co1">; si estamos en la esquina, volvemos</span>
&nbsp;
    	<span class="kw1">inc</span>     	a               	<span class="co1">; avanzamos</span>
    	ld      	<span class="br0">&#91;</span>_SPR0_Y<span class="br0">&#93;</span><span class="sy1">,</span> a    	<span class="co1">; guardamos la posicion</span>
&nbsp;
    	<span class="kw1">ret</span> 
&nbsp;
muestra_ventana<span class="sy1">:</span>
	ld		a<span class="sy1">,</span> <span class="nu0">8</span>
	ld		<span class="br0">&#91;</span>rWX<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
	ld		a<span class="sy1">,</span> <span class="nu0">144</span>
	ld		<span class="br0">&#91;</span>rWY<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
	<span class="co1">;activamos la ventana y desactivamos los sprites</span>
	ld		a<span class="sy1">,</span> <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>
	<span class="kw1">or</span>		LCDCF_WINON
	res		<span class="nu0">1</span><span class="sy1">,</span> a
	ld		<span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
	<span class="co1">; animacion</span>
	ld		a<span class="sy1">,</span> <span class="nu0">144</span>
<span class="sy1">.</span>anim_most_vent<span class="sy1">:</span>
	<span class="kw1">push</span>		af
	ld		bc<span class="sy1">,</span> <span class="nu0">1000</span>
	<span class="kw1">call</span>		retardo
	<span class="kw1">pop</span>		af
	<span class="kw1">dec</span>		a
	ld      	<span class="br0">&#91;</span>rWY<span class="br0">&#93;</span><span class="sy1">,</span> a
	jr		nz<span class="sy1">,</span> <span class="sy1">.</span>anim_most_vent
&nbsp;
	<span class="co1">; esperamos a que pulsen select para salir</span>
<span class="sy1">.</span>espera_salir<span class="sy1">:</span>
	<span class="kw1">call</span>		lee_pad
	<span class="kw1">and</span>     	<span class="nu0">%00001000</span>       		<span class="co1">; Boton START</span>
	jr		z<span class="sy1">,</span> <span class="sy1">.</span>espera_salir<span class="co1">;	</span>
&nbsp;
&nbsp;
<span class="sy1">.</span>anim_ocul_vent<span class="sy1">:</span>
    	<span class="kw1">push</span>    	af
    	ld      	bc<span class="sy1">,</span> <span class="nu0">1000</span>
    	<span class="kw1">call</span>    	retardo
    	<span class="kw1">pop</span>     	af
    	<span class="kw1">inc</span>     	a
    	ld      	<span class="br0">&#91;</span>rWY<span class="br0">&#93;</span><span class="sy1">,</span> a
	cp		<span class="nu0">144</span>
    	jr     		nz<span class="sy1">,</span> <span class="sy1">.</span>anim_ocul_vent
&nbsp;
	<span class="co1">;desactivamos la ventana y activamos los sprites</span>
    	ld      	a<span class="sy1">,</span> <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>
    	res		<span class="nu0">5</span><span class="sy1">,</span> a
	<span class="kw1">or</span>		LCDCF_OBJON
    	ld      	<span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
	<span class="kw1">ret</span>						<span class="co1">; volvemos</span>
&nbsp;
&nbsp;
<span class="co1">; si no se pulsa nada, se viene aqui para modificar el sprite por el mario</span>
<span class="co1">; estático</span>
sin_pulsaciones<span class="sy1">:</span>
	ld      	hl<span class="sy1">,</span> _SPR_MAR_SUM<span class="co1">; empezamos con el 0</span>
    	ld      	<span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> <span class="nu0">0</span>
&nbsp;
	ld		a<span class="sy1">,</span> <span class="nu0">0</span>
	ld		<span class="br0">&#91;</span>_SPR0_NUM<span class="br0">&#93;</span><span class="sy1">,</span> a
	<span class="kw1">inc</span>		a
	ld      	<span class="br0">&#91;</span>_SPR1_NUM<span class="br0">&#93;</span><span class="sy1">,</span> a
	<span class="kw1">inc</span>		a
	ld      	<span class="br0">&#91;</span>_SPR2_NUM<span class="br0">&#93;</span><span class="sy1">,</span> a
	<span class="kw1">inc</span>		a
	ld      	<span class="br0">&#91;</span>_SPR3_NUM<span class="br0">&#93;</span><span class="sy1">,</span> a
	<span class="kw1">ret</span>
&nbsp;
<span class="co1">; modifica la variable para cambiar los sprites de mario caminando</span>
num_spr_mario<span class="sy1">:</span>
	ld		a<span class="sy1">,</span> <span class="br0">&#91;</span>_SPR_MAR_SUM<span class="br0">&#93;</span>
	<span class="kw1">add</span>		<span class="nu0">4</span>				<span class="co1">; sumamos 4</span>
	ld		<span class="br0">&#91;</span>_SPR_MAR_SUM<span class="br0">&#93;</span><span class="sy1">,</span> a		<span class="co1">; lo guardamos</span>
	cp		<span class="nu0">12</span>				<span class="co1">; menor que 12?</span>
	<span class="kw1">ret</span>		nz				<span class="co1">; volvemos</span>
&nbsp;
	ld		a<span class="sy1">,</span> <span class="nu0">4</span>				<span class="co1">; 12? entonces volvemos al 4</span>
	ld      	<span class="br0">&#91;</span>_SPR_MAR_SUM<span class="br0">&#93;</span><span class="sy1">,</span> a
	<span class="kw1">ret</span>
&nbsp;
camina_mario<span class="sy1">:</span>
	ld		a<span class="sy1">,</span> <span class="br0">&#91;</span>_SPR_MAR_SUM<span class="br0">&#93;</span>
	ld      	<span class="br0">&#91;</span>_SPR0_NUM<span class="br0">&#93;</span><span class="sy1">,</span> a
	<span class="kw1">inc</span>     	a
    	ld      	<span class="br0">&#91;</span>_SPR1_NUM<span class="br0">&#93;</span><span class="sy1">,</span> a
    	<span class="kw1">inc</span>    		a
    	ld      	<span class="br0">&#91;</span>_SPR2_NUM<span class="br0">&#93;</span><span class="sy1">,</span> a
    	<span class="kw1">inc</span>     	a
    	ld      	<span class="br0">&#91;</span>_SPR3_NUM<span class="br0">&#93;</span><span class="sy1">,</span> a
    	<span class="kw1">ret</span>
&nbsp;
&nbsp;
<span class="co1">; Rutina de lectura del pad</span>
lee_pad<span class="sy1">:</span>
	<span class="co1">; vamos a leer la cruzeta:</span>
	ld		a<span class="sy1">,</span> <span class="nu0">%00100000</span>	<span class="co1">; bit 4 a 0, bit 5 a 1 (cruzeta activada, botones no)</span>
	ld		<span class="br0">&#91;</span>rP1<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
	<span class="co1">; ahora leemos el estado de la cruzeta, para evitar el bouncing</span>
	<span class="co1">; hacemos varias lecturas</span>
	ld		a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
	ld      	a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
	ld      	a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
	ld      	a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
&nbsp;
	<span class="kw1">and</span>		<span class="sy2">$</span><span class="nu0">0F</span>			<span class="co1">; solo nos importan los 4 bits de abajo.</span>
	swap		a			<span class="co1">; intercambiamos parte baja y alta.</span>
	ld		b<span class="sy1">,</span> a			<span class="co1">; guardamos el estado de la cruzeta en b</span>
&nbsp;
	<span class="co1">; vamos a por los botones</span>
    	ld      	a<span class="sy1">,</span> <span class="nu0">%00010000</span>    	<span class="co1">; bit 4 a 1, bit 5 a 0 (botones activados, cruzeta no)</span>
    	ld      	<span class="br0">&#91;</span>rP1<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
	<span class="co1">; leemos varias veces para evitar el bouncing</span>
    	ld      	a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    	ld      	a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    	ld      	a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    	ld      	a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
&nbsp;
	<span class="co1">; tenemos en A, el estado de los botones</span>
    	<span class="kw1">and</span>     	<span class="sy2">$</span><span class="nu0">0F</span>             	<span class="co1">; solo nos importan los 4 bits de abajo.</span>
	<span class="kw1">or</span>		b			<span class="co1">; hacemos un or con b, para &quot;meter&quot; en la parte</span>
						<span class="co1">; superior de A, el estado de la cruzeta.</span>
&nbsp;
	<span class="co1">; ahora tenemos en A, el estado de todo, hacemos el complemento y</span>
	<span class="co1">; lo guardamos en la variable</span>
	cpl
	ld 		<span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span><span class="sy1">,</span> a
	<span class="co1">; volvemos</span>
	<span class="kw1">ret</span>
&nbsp;
<span class="co1">; Rutina de apagado del LCD</span>
apaga_LCD<span class="sy1">:</span>
	ld		a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>
	rlca	                	<span class="co1">; Pone el bit alto de LCDC en el flag de acarreo</span>
	<span class="kw1">ret</span>		nc              <span class="co1">; La pantalla ya está apagada, volver.</span>
&nbsp;
	<span class="co1">; esperamos al VBlank, ya que no podemos apagar la pantalla</span>
	<span class="co1">; en otro momento</span>
&nbsp;
<span class="sy1">.</span>espera_VBlank
	ld		a<span class="sy1">,</span> <span class="br0">&#91;</span>rLY<span class="br0">&#93;</span>
	cp		<span class="nu0">145</span>
	jr		nz<span class="sy1">,</span> <span class="sy1">.</span>espera_VBlank
&nbsp;
	<span class="co1">; estamos en VBlank, apagamos el LCD</span>
	ld		a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>		<span class="co1">; en A, el contenido del LCDC</span>
	res		<span class="nu0">7</span><span class="sy1">,</span>a			<span class="co1">; ponemos a cero el bit 7 (activado del LCD)</span>
	ld		<span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span>a		<span class="co1">; escribimos en el registro LCDC el contenido de A</span>
&nbsp;
	<span class="kw1">ret</span>					<span class="co1">; volvemos</span>
&nbsp;
<span class="co1">; rutina de retardo</span>
<span class="co1">; parámetros</span>
<span class="co1">; bc - numero de iteraciones</span>
retardo<span class="sy1">:</span>
<span class="sy1">.</span>delay<span class="sy1">:</span>
	<span class="kw1">dec</span>		bc			<span class="co1">; decrementamos</span>
	ld		a<span class="sy1">,</span> b			<span class="co1">; vemos si es cero</span>
	<span class="kw1">or</span>		c
	jr		z<span class="sy1">,</span> <span class="sy1">.</span>fin_delay
	<span class="kw1">nop</span>
	jr		<span class="sy1">.</span>delay
<span class="sy1">.</span>fin_delay<span class="sy1">:</span>
	<span class="kw1">ret</span>
&nbsp;
<span class="co1">; rutina de copia a memoria</span>
<span class="co1">; copia un numero de bytes de una direccion a otra</span>
<span class="co1">; espera los parámetros:</span>
<span class="co1">; hl - dirección de datos a copiar</span>
<span class="co1">; de - dirección de destino</span>
<span class="co1">; bc - numero de datos a copiar</span>
<span class="co1">; destruye el contenido de A</span>
CopiaMemoria<span class="sy1">:</span>
	ld		a<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>		<span class="co1">; cargamos el dato en A</span>
	ld		<span class="br0">&#91;</span>de<span class="br0">&#93;</span><span class="sy1">,</span> a		<span class="co1">; copiamos el dato al destino</span>
	<span class="kw1">dec</span>		bc		<span class="co1">; uno menos por copiar</span>
	<span class="co1">; comprobamos si bc es cero</span>
	ld		a<span class="sy1">,</span> c
	<span class="kw1">or</span>		b
	<span class="kw1">ret</span>		z		<span class="co1">; si es cero, volvemos</span>
	<span class="co1">; si no, seguimos</span>
	<span class="kw1">inc</span>		hl
	<span class="kw1">inc</span>		de
	jr		CopiaMemoria
&nbsp;
&nbsp;
<span class="co1">; rutina de relleno de memoria</span>
<span class="co1">; rellena un numero de bytes de memoria con un dato</span>
<span class="co1">; espera los parámetros:</span>
<span class="co1">; de - direccion de destino</span>
<span class="co1">; bc - número de datos a rellenar</span>
<span class="co1">; l - dato a rellenar</span>
RellenaMemoria<span class="sy1">:</span>
	ld		a<span class="sy1">,</span> l
	ld		<span class="br0">&#91;</span>de<span class="br0">&#93;</span><span class="sy1">,</span> a			<span class="co1">; mete el dato en el destino</span>
	<span class="kw1">dec</span>		bc			<span class="co1">; uno menos a rellenar</span>
&nbsp;
	ld		a<span class="sy1">,</span> c		
	<span class="kw1">or</span>		b			<span class="co1">; comprobamos si bc es cero</span>
	<span class="kw1">ret</span>		z			<span class="co1">; si es cero volvemos</span>
	<span class="kw1">inc</span>		de			<span class="co1">; si no, seguimos</span>
	jr		RellenaMemoria
&nbsp;
&nbsp;
Tiles<span class="sy1">:</span>
INCLUDE <span class="st0">&quot;mario_sprites.z80&quot;</span>
FinTiles<span class="sy1">:</span>
&nbsp;
Mapa<span class="sy1">:</span>
INCLUDE <span class="st0">&quot;mapa_mario.z80&quot;</span>
FinMapa<span class="sy1">:</span>
&nbsp;
Ventana<span class="sy1">:</span>
INCLUDE	<span class="st0">&quot;ventana.z80&quot;</span>
FinVentana<span class="sy1">:</span></pre>
</dd></dl>

<p>
Y los datos,
</p>

<p>
mario_sprites.z80:
</p>
<dl class="code">
<dt><a href="mario_spritesf532.z80?do=export_code&amp;id=tutorial_de_ensamblador&amp;codeblock=33" title="Descargar trozo de código fuente" class="mediafile mf_z80">mario_sprites.z80</a></dt>
<dd><pre class="code asm"><span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">14</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">7F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">7F</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">14</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span>1E<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">31</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">2F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">3F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">3F</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">10</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">3F</span><span class="sy1">,</span><span class="sy2">$</span>2A<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">1F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">07</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">07</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">09</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>E0<span class="sy1">,</span><span class="sy2">$</span>E0<span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">10</span>
<span class="kw5">DB</span> <span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">30</span><span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">68</span><span class="sy1">,</span><span class="sy2">$</span>F8<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">88</span><span class="sy1">,</span><span class="sy2">$</span>F8
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">70</span><span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span>F8<span class="sy1">,</span><span class="sy2">$</span>C8<span class="sy1">,</span><span class="sy2">$</span>F8<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">68</span><span class="sy1">,</span><span class="sy2">$</span>B8<span class="sy1">,</span><span class="sy2">$</span>D8
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">98</span><span class="sy1">,</span><span class="sy2">$</span>F8<span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">10</span><span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span>F0
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">14</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">7F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">7F</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">14</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span>1E<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">31</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">2F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">3F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">3F</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">10</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span><span class="sy1">,</span><span class="sy2">$</span>1E<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span>1E<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">1F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">11</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1F</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>E0<span class="sy1">,</span><span class="sy2">$</span>E0<span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">10</span>
<span class="kw5">DB</span> <span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">30</span><span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">68</span><span class="sy1">,</span><span class="sy2">$</span>F8<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">88</span><span class="sy1">,</span><span class="sy2">$</span>F8
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">70</span><span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">90</span><span class="sy1">,</span><span class="sy2">$</span>F8<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">48</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">74</span><span class="sy1">,</span><span class="sy2">$</span>FC
<span class="kw5">DB</span> <span class="sy2">$</span>F4<span class="sy1">,</span><span class="sy2">$</span>FC<span class="sy1">,</span><span class="sy2">$</span>F4<span class="sy1">,</span><span class="sy2">$</span>FC<span class="sy1">,</span><span class="sy2">$</span>0C<span class="sy1">,</span><span class="sy2">$</span>0C<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">14</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">7F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">7F</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">14</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span>1E<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">31</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">2F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">3F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">3F</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">10</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">6F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">6F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">5F</span><span class="sy1">,</span><span class="sy2">$</span>7A<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">5F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">75</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">5F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">7F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">7F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">7F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>E0<span class="sy1">,</span><span class="sy2">$</span>E0<span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">10</span>
<span class="kw5">DB</span> <span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">30</span><span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">68</span><span class="sy1">,</span><span class="sy2">$</span>F8<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">88</span><span class="sy1">,</span><span class="sy2">$</span>F8
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">70</span><span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span>F8<span class="sy1">,</span><span class="sy2">$</span>C8<span class="sy1">,</span><span class="sy2">$</span>F8<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">68</span><span class="sy1">,</span><span class="sy2">$</span>B8<span class="sy1">,</span><span class="sy2">$</span>D8
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">98</span><span class="sy1">,</span><span class="sy2">$</span>F8<span class="sy1">,</span><span class="sy2">$</span>E8<span class="sy1">,</span><span class="sy2">$</span>F8<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">90</span><span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span>E0<span class="sy1">,</span><span class="sy2">$</span>E0
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span>
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span>
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span>
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">88</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span>
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">20</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">02</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">80</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">22</span>
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>C3<span class="sy1">,</span><span class="sy2">$</span>3C<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">81</span><span class="sy1">,</span><span class="sy2">$</span>7E<span class="sy1">,</span><span class="sy2">$</span>B9<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">46</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">81</span><span class="sy1">,</span><span class="sy2">$</span>7E<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">81</span><span class="sy1">,</span><span class="sy2">$</span>7E<span class="sy1">,</span><span class="sy2">$</span>9D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">62</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">81</span><span class="sy1">,</span><span class="sy2">$</span>7E
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FE<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">01</span><span class="sy1">,</span><span class="sy2">$</span>F8<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">07</span><span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span>
<span class="kw5">DB</span> <span class="sy2">$</span>E0<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1F</span><span class="sy1">,</span><span class="sy2">$</span>C0<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">3F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">80</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">7F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FF
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FF
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FF
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1F</span><span class="sy1">,</span><span class="sy2">$</span>E0<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span><span class="sy1">,</span><span class="sy2">$</span>F0<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">07</span><span class="sy1">,</span><span class="sy2">$</span>F8
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">03</span><span class="sy1">,</span><span class="sy2">$</span>FC<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">01</span><span class="sy1">,</span><span class="sy2">$</span>FE<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">01</span><span class="sy1">,</span><span class="sy2">$</span>FE<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">01</span><span class="sy1">,</span><span class="sy2">$</span>FE
<span class="kw5">DB</span> <span class="sy2">$</span>F8<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">97</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>6E<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>7D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">7F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">7F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>BB<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>C4<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">33</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>CD<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FE<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FE<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span>
<span class="kw5">DB</span> <span class="sy2">$</span>FA<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>F6<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FD<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">03</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span>
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>E0<span class="sy1">,</span><span class="sy2">$</span>E0
<span class="kw5">DB</span> <span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span>
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">07</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">07</span>
<span class="kw5">DB</span> <span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7
<span class="kw5">DB</span> <span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7
<span class="kw5">DB</span> <span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7
<span class="kw5">DB</span> <span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7<span class="sy1">,</span><span class="sy2">$</span>F7
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">07</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">07</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF
<span class="kw5">DB</span> <span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF
<span class="kw5">DB</span> <span class="sy2">$</span>E0<span class="sy1">,</span><span class="sy2">$</span>E0<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF
<span class="kw5">DB</span> <span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF
<span class="kw5">DB</span> <span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>BD<span class="sy1">,</span><span class="sy2">$</span>BD<span class="sy1">,</span><span class="sy2">$</span>BD<span class="sy1">,</span><span class="sy2">$</span>BD<span class="sy1">,</span><span class="sy2">$</span>DB<span class="sy1">,</span><span class="sy2">$</span>DB
<span class="kw5">DB</span> <span class="sy2">$</span>DB<span class="sy1">,</span><span class="sy2">$</span>DB<span class="sy1">,</span><span class="sy2">$</span>E7<span class="sy1">,</span><span class="sy2">$</span>E7<span class="sy1">,</span><span class="sy2">$</span>E7<span class="sy1">,</span><span class="sy2">$</span>E7<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">83</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">83</span><span class="sy1">,</span><span class="sy2">$</span>BF<span class="sy1">,</span><span class="sy2">$</span>BF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">8F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">8F</span>
<span class="kw5">DB</span> <span class="sy2">$</span>BF<span class="sy1">,</span><span class="sy2">$</span>BF<span class="sy1">,</span><span class="sy2">$</span>BF<span class="sy1">,</span><span class="sy2">$</span>BF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">83</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">83</span><span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>9D<span class="sy1">,</span><span class="sy2">$</span>9D<span class="sy1">,</span><span class="sy2">$</span>AD<span class="sy1">,</span><span class="sy2">$</span>AD<span class="sy1">,</span><span class="sy2">$</span>AD<span class="sy1">,</span><span class="sy2">$</span>AD
<span class="kw5">DB</span> <span class="sy2">$</span>B5<span class="sy1">,</span><span class="sy2">$</span>B5<span class="sy1">,</span><span class="sy2">$</span>B5<span class="sy1">,</span><span class="sy2">$</span>B5<span class="sy1">,</span><span class="sy2">$</span>B9<span class="sy1">,</span><span class="sy2">$</span>B9<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">83</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">83</span><span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF
<span class="kw5">DB</span> <span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>EF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF
<span class="kw5">DB</span> <span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>E7<span class="sy1">,</span><span class="sy2">$</span>E7<span class="sy1">,</span><span class="sy2">$</span>DB<span class="sy1">,</span><span class="sy2">$</span>DB<span class="sy1">,</span><span class="sy2">$</span>DB<span class="sy1">,</span><span class="sy2">$</span>DB
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">81</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">81</span><span class="sy1">,</span><span class="sy2">$</span>BD<span class="sy1">,</span><span class="sy2">$</span>BD<span class="sy1">,</span><span class="sy2">$</span>BD<span class="sy1">,</span><span class="sy2">$</span>BD<span class="sy1">,</span><span class="sy2">$</span>FF<span class="sy1">,</span><span class="sy2">$</span>FF</pre>
</dd></dl>

<p>
mapa_mario.z80
</p>
<dl class="code">
<dt><a href="mapa_mariof95f.z80?do=export_code&amp;id=tutorial_de_ensamblador&amp;codeblock=34" title="Descargar trozo de código fuente" class="mediafile mf_z80">mapa_mario.z80</a></dt>
<dd><pre class="code asm"><span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">13</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">14</span><span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">13</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">14</span><span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">13</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">14</span><span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">13</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">14</span>
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">13</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">14</span><span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span><span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">10</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">11</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">11</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">12</span><span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span><span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">10</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">11</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">12</span>
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span><span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">0F</span><span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">10</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">11</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">11</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">12</span><span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E
<span class="kw5">DB</span> <span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E
<span class="kw5">DB</span> <span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E
<span class="kw5">DB</span> <span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0E<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D
<span class="kw5">DB</span> <span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D<span class="sy1">,</span><span class="sy2">$</span>0D</pre>
</dd></dl>

<p>
y ventana.z80
</p>
<dl class="code">
<dt><a href="ventana143b.z80?do=export_code&amp;id=tutorial_de_ensamblador&amp;codeblock=35" title="Descargar trozo de código fuente" class="mediafile mf_z80">ventana.z80</a></dt>
<dd><pre class="code asm"><span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">16</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">18</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">16</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">17</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">17</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">18</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1E<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1F</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">20</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">21</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">22</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">20</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">22</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1C<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span>1A<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1D<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">19</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span>1C<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">1B</span><span class="sy1">,</span><span class="sy2">$</span>1A<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span>
<span class="kw5">DB</span> <span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span><span class="sy1">,</span><span class="sy2">$</span><span class="nu0">15</span></pre>
</dd></dl>

<p>
El resultado:
</p>

<p>
<a href="lib/exe/hola-ventana5723.gb_%3b?media=hola-ventana.gb" class="media mediafile mf_gb" title="hola-ventana.gb (32 KB)">hola-ventana.gb</a>
</p>

<p>
<a href="lib/exe/detailb602.html?id=tutorial_de_ensamblador&amp;media=bgb00004.png" class="media" title="bgb00004.png"><img src="lib/exe/bgb00004b4cf.png_%3b?media=bgb00004.png" class="media" alt="" /></a> <a href="lib/exe/detail79fd.html?id=tutorial_de_ensamblador&amp;media=bgb00005.png" class="media" title="bgb00005.png"><img src="lib/exe/bgb00005fbd2.png_%3b?media=bgb00005.png" class="media" alt="" /></a>
</p>

<p>
Para generar los gráficos de este ejemplo. he usado el GBTD (Gameboy Tile Designer) y el GBMB (Gameboy Map Builder), dos estupendas herramientas que nos permiten diseñar tiles y mapas de forma visual, y luego generar los datos listos para ser importados en nuestros programas asm de RGBDS, C de GBDK, etc. Además funcionan perfectamente en Wine, por si quereis usarlos desde Linux (yo mismo los uso asi).
Podeis descargarlos de:
</p>

<p>
<a href="../external.html?link=http://www.devrs.com/gb/hmgd/gbtd.html" class="urlextern" title="http://www.devrs.com/gb/hmgd/gbtd.html" rel="nofollow">http://www.devrs.com/gb/hmgd/gbtd.html</a>
</p>

<p>
<a href="../external.html?link=http://www.devrs.com/gb/hmgd/gbmb.html" class="urlextern" title="http://www.devrs.com/gb/hmgd/gbmb.html" rel="nofollow">http://www.devrs.com/gb/hmgd/gbmb.html</a>
</p>

<p>
El GBTD, es muy sencillo de usar, vais seleccionando tiles a la derecha, y los vais dibujando en la rejilla, con algunas herramientas típicas como pincel, cubo de relleno, etc, y otras no tan típicas como desplazamientos, etc. Además podeis seleccionar modos más grnades (por ej 16&times;16), que al ponerlo luego de nuevo en modo 8&times;8, vereis como se alinean los tiles en memoria, para usarlos. Una vez diseñado vuestro juego de tiles, lo grabais, y le dais a “Export To” en el menu “File”. Ahi es sencillo, poneis un nombre de archivo, el tipo “RGBDS Assembly File”, un nombre de Etiqueta (Label), y una sección, y en From y To, poneis los rangos de sprites a exportar, si habeis dibujado 10 sprites, pues poneis del 0 al 9, y activais la checkbox de “Export Tiles as one unit”.
Le dais a exportar, y ya teneis vuestro fichero .z80 con los datosa de los tiles. Yo normalmente limpio todo el fichero y sólo dejo los DB con los datos, ya que los suelo incluir entre mis propias etiquetas y demás, y a veces las definiciones de bancos y extras que añade el GBTD no hacen más que estorbar.
</p>

<p>
Luego el GBMB, es también muy sencillo de usar. Lo primero al abrirlo es ir a “Map Properties” en el menú “File”, y ahi seleccionar el alto y ancho del mapa, para estos ejemplos, yo siempre uso 32&times;32. El tema es que aunque podria crear un mapa de por ejemplo, 20&times;18 para la parte visible de la pantalla, a la hora de cargarlo en memoria, tendria que ir haciendo los “saltos”, quiero decir, tendria que llenar 20 bytes de la memoria de mapa, luego saltarme 12 (para completar los 32, llenar otros 20, saltarme 12, etc. Esto no es difícil, pero de momento en los demos no necesitamos ahorrar memoria, y asi podemos usar las subrutinas que ya hemos definido.
Luego hay que seleccionar un archivo de tiles creado con el GBTD. Le dais a Browse y seleccionais el que habeis creado. Le dais a “OK” y ahora tendreis vuestro mapa editable, y a la derecha la lista de tiles que habeis creado. Pues nada, ahora es cuestión de ir creando el mapa, rellenándolo con los tiles que teneis disponibles. Una vez que tengais el mapa listo, vamos a “Export To” del menu “File”. Como anteriormente, seleccionais un nommbre de archivo, tipo “RGBDS Assembly File”, un nombre de etiqueta, una sección (0 por ej), y entonces vais a la segunda pestaña la de “Location Format”. Ahi definiremos como se guarda en memoria el mapa. Primero en el cuadro grande, seleccionais la primera propiedad (sale con un 1), y seleccionais ”[Tile Number], y la poneis de 8 bits. Luego a la derecha, seleccionais, “Map Layout”: “Rows”, “Plane count”: “1 plane, 8 bits” y el resto como está, “Tiles are continues” y Offset 0.
Le dais a exportar y ya teneis los datos listos. Como en el archivo de tiles, es mejor limpiar y dejar sólo los DB&#039;s correspondientes.
</p>

</div>

<h1 class="sectionedit20" id="hola_timer">Hola Timer</h1>
<div class="level1">

<p>
Para este ejemplo, vamos a usar el Timer interno de la GameBoy, que nos ayudará a controlar el tiempo de manera precisa. Además haciendo uso de las interrupciones, no tendremos que preocuparnos de llevar nosotros el control, dejaremos que cada vez que se produzca una interrupción del timer, una subrutina se preocupe de controlar el tiempo.
</p>

<p>
El timer consta de 3 registros. rTAC, rTMA y rTIMA. 
</p>

<p>
rTAC, es el registro de control del timer, nos permite activarlo o desactivarlo, y también ajustar la frecuencia de funcionamiento. El bit 2 de este registro, activa o desactiva el timer (1=activado), y los bits 0 y 1, nos permiten ajustar su frecuencia, según la siguiente tabla:
</p>
<pre class="code">    00:   4096 Hz    (~4194 Hz SGB)
    01: 262144 Hz  (~268400 Hz SGB)
    10:  65536 Hz   (~67110 Hz SGB)
    11:  16384 Hz   (~16780 Hz SGB)</pre>

<p>
Vamos a usar la frecuencia de 4096Hz, con lo que tendremos que el timer se activa cada 1/4096 = 0,0002414 segundos.
</p>

<p>
Cada vez que el timer se activa, incrementa el contenido del registro rTIMA en una unidad. rTIMA es un registro de 8 bits, asi que puede contar de 0 a 255. Cuando el registro rTIMA se desborda (pasa de 255 a 0 de nuevo), se genera una interrupción del timer, que si está activada, la CPU pasará el control del programa a la subrutina de manejo de interrupción del timer en la dirección $0050.
</p>

<p>
El tercer registro, es rTMA, y es el valor inicial que se carga en rTIMA después de un desbordamiento, asi cuando rTIMA llegue a 255, al desbordarse, genera la interrupción, y entonces empieza a contar de nuevo desde el valor contenido en rTMA, esto nos permite ajustar cada cuanto tiempo se genera la interrupción más facilmente.
</p>

<p>
Asi, para este programa, un cronómetro, lo ideal sería poder contar de 1 en 1 segundos. Entonces, si tenemos que la frecuencia es 4096Hz, sabemos que rTIMA se incrementa cada 1/4096 = 0,0002414 segundos. Ahora si ponemos el valor de inicio de rTIMA en 51, tenemos, (1/4096)*(255-51) = (1/4096) * 204 = 0,049 s.
Entonces sabemos que se generará una interrupción cada aproximadamente 0.05 segundos. Si ahora en la rutina de interrupción, le hacemos contar las veces que se le llama, y esperar hasta que se la llame 20 veces, tenemos 0.05 * 20 =  1 Segundo.
</p>

<p>
Además para este programa, vamos a usar otra interrupción, la interrupción de vBlank, que se genera siempre que el LCD entre en el periodo de intervalo vertical. Llamando desde ahi, a la rutina de dibujado, estaremos siempre seguros de que el dibujado se producirá mientras estemos en vBlank <img src="lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />
</p>

<p>
Os dejo con el código, podeis poner en marcha o para el cronómetro con el botón A, y resetearlo a cero con B:
</p>
<dl class="code">
<dt><a href="holatimer77dd.asm?do=export_code&amp;id=tutorial_de_ensamblador&amp;codeblock=37" title="Descargar trozo de código fuente" class="mediafile mf_asm">holatimer.asm</a></dt>
<dd><pre class="code asm"><span class="co1">; Hola Timer</span>
<span class="co1">; David Pello 2010</span>
<span class="co1">; ladecadence.net</span>
<span class="co1">; Para el tutorial en: </span>
<span class="co1">; http://wiki.ladecadence.net/doku.php?id=tutorial_de_ensamblador</span>
&nbsp;
INCLUDE <span class="st0">&quot;gbhw.inc&quot;</span>          <span class="co1">; importamos el archivo de definiciones</span>
&nbsp;
<span class="co1">; Variables</span>
_CONTROL_TIEMPO     <span class="kw5">EQU</span>     _RAM    <span class="co1">; controla los milisegundos</span>
_ACTIVADO           <span class="kw5">EQU</span>     _RAM<span class="sy1">+</span><span class="nu0">1</span>  <span class="co1">; cronómetro activado o no</span>
_SEGUNDOS           <span class="kw5">EQU</span>     _RAM<span class="sy1">+</span><span class="nu0">2</span>
_MINUTOS            <span class="kw5">EQU</span>     _RAM<span class="sy1">+</span><span class="nu0">3</span>
_HORAS              <span class="kw5">EQU</span>     _RAM<span class="sy1">+</span><span class="nu0">4</span>
_PAD                <span class="kw5">EQU</span>     _RAM<span class="sy1">+</span><span class="nu0">5</span>
&nbsp;
<span class="co1">; Constantes</span>
_POS_CRONOM         <span class="kw5">EQU</span>     _SCRN0<span class="sy1">+</span><span class="nu0">32</span><span class="sy1">*</span><span class="nu0">4</span><span class="sy1">+</span><span class="nu0">6</span>   <span class="co1">; posición en pantalla</span>
&nbsp;
<span class="co1">; interrupción de vBlank</span>
<span class="kw5">SECTION</span> <span class="st0">&quot;Vblank&quot;</span><span class="sy1">,</span>ROM0<span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">0040</span><span class="br0">&#93;</span>
    <span class="kw1">call</span> DibujaCronometro
    reti
&nbsp;
<span class="co1">; interrupción de desbordamiento del timer</span>
<span class="kw5">SECTION</span> <span class="st0">&quot;Timer_Overflow&quot;</span><span class="sy1">,</span>ROM0<span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">0050</span><span class="br0">&#93;</span>
    <span class="co1">; cuando hay una interrupción del timer, llamamos a esta subrutina</span>
    <span class="kw1">call</span>    ControlTimer
    reti
&nbsp;
<span class="co1">; El programa comienza aqui:</span>
<span class="kw5">SECTION</span> <span class="st0">&quot;start&quot;</span><span class="sy1">,</span>ROM0<span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">0100</span><span class="br0">&#93;</span>
    <span class="kw1">nop</span>
    <span class="kw1">jp</span>      inicio
&nbsp;
<span class="co1">; Cabecera de la ROM (Macro definido en gbhw.inc)</span>
<span class="co1">; define una rom sin mapper, de 32K y sin RAM, lo más básico</span>
<span class="co1">; (como por ejemplo la del tetris)</span>
    ROM_HEADER  ROM_NOMBC<span class="sy1">,</span> ROM_SIZE_32KBYTE<span class="sy1">,</span> RAM_SIZE_0KBYTE
&nbsp;
<span class="co1">; aqui empieza nuestro programa</span>
inicio<span class="sy1">:</span>
    <span class="kw1">nop</span>
    <span class="kw4">di</span>                      <span class="co1">; deshabilita las interrupciones</span>
    ld      <span class="kw4">sp</span><span class="sy1">,</span> <span class="sy2">$</span>ffff       <span class="co1">; apuntamos la pila al tope de la ram</span>
&nbsp;
inicializacion<span class="sy1">:</span>
&nbsp;
    <span class="co1">; iniciamos el timer</span>
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>
    ld      <span class="br0">&#91;</span>rTAC<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; timer apagado, divider a 00 (4096 Hz)</span>
&nbsp;
    ld      a<span class="sy1">,</span> <span class="nu0">51</span>
    ld      <span class="br0">&#91;</span>rTMA<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; cuando TIMA se desborde, este es </span>
                            <span class="co1">; su valor de reinicio, (1/4096)*(255-51) = 0.049 s</span>
    ld      <span class="br0">&#91;</span>rTIMA<span class="br0">&#93;</span><span class="sy1">,</span> a      <span class="co1">; valor inicial del timer.</span>
&nbsp;
    <span class="co1">; iniciamos las variables</span>
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>
    ld      <span class="br0">&#91;</span>_CONTROL_TIEMPO<span class="br0">&#93;</span><span class="sy1">,</span> a
    ld      <span class="br0">&#91;</span>_ACTIVADO<span class="br0">&#93;</span><span class="sy1">,</span> a
    ld      <span class="br0">&#91;</span>_SEGUNDOS<span class="br0">&#93;</span><span class="sy1">,</span> a
    ld      <span class="br0">&#91;</span>_MINUTOS<span class="br0">&#93;</span><span class="sy1">,</span> a
    ld      <span class="br0">&#91;</span>_HORAS<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; paletas</span>
    ld      a<span class="sy1">,</span> <span class="nu0">%11100100</span>    <span class="co1">; Colores de paleta desde el mas oscuro al</span>
                            <span class="co1">; más claro, 11 10 01 00</span>
    ld      <span class="br0">&#91;</span>rBGP<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; escribimos esto en el registro de paleta de fondo</span>
    ld      <span class="br0">&#91;</span>rOBP0<span class="br0">&#93;</span><span class="sy1">,</span> a      <span class="co1">; y en la paleta 0 de sprites</span>
&nbsp;
    <span class="co1">; scroll</span>
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>            <span class="co1">; escribimos 0 en los registros de scroll X e Y</span>
    ld      <span class="br0">&#91;</span>rSCX<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; con lo que posicionamos la pantalla visible</span>
    ld      <span class="br0">&#91;</span>rSCY<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; al inicio (arriba a la izq) del fondo.</span>
&nbsp;
    <span class="co1">; video</span>
    <span class="kw1">call</span>    apaga_LCD       <span class="co1">; llamamos a la rutina que apaga el LCD</span>
&nbsp;
    <span class="co1">; cargamos los tiles en la memoria de tiles</span>
&nbsp;
    ld      hl<span class="sy1">,</span> Tiles       <span class="co1">; cargamos en HL la dirección de nuestro tile</span>
    ld      de<span class="sy1">,</span> _VRAM       <span class="co1">; en DE dirección de la memoria de video</span>
    ld      bc<span class="sy1">,</span> FinTiles<span class="sy1">-</span>Tiles  <span class="co1">; número de bytes a copiar</span>
&nbsp;
    <span class="kw1">call</span>    CopiaMemoria
&nbsp;
    <span class="co1">; limpiamos el mapa</span>
    ld      de<span class="sy1">,</span> _SCRN0      <span class="co1">; mapa 0</span>
    ld      bc<span class="sy1">,</span> <span class="nu0">32</span><span class="sy1">*</span><span class="nu0">32</span>
    ld      l<span class="sy1">,</span> <span class="nu0">11</span>           <span class="co1">; tile vacio</span>
    <span class="kw1">call</span>    RellenaMemoria
&nbsp;
    <span class="co1">; bien, tenemos todo el mapa de tiles cargado</span>
    <span class="co1">; ahora limpiamos la memoria de sprites</span>
    ld      de<span class="sy1">,</span> _OAMRAM     <span class="co1">; memoria de atributos de sprites</span>
    ld      bc<span class="sy1">,</span> <span class="nu0">40</span><span class="sy1">*</span><span class="nu0">4</span>        <span class="co1">; 40 sprites x 4 bytes cada uno</span>
    ld      l<span class="sy1">,</span> <span class="nu0">0</span>            <span class="co1">; lo vamos a poner todo a cero, asi los sprites</span>
    <span class="kw1">call</span>    RellenaMemoria  <span class="co1">; no usados quedan fuera de pantalla</span>
&nbsp;
    <span class="co1">; dibujamos el cronómetro</span>
    <span class="kw1">call</span>    DibujaCronometro
&nbsp;
    <span class="co1">; configuramos y activamos el display</span>
    ld      a<span class="sy1">,</span> LCDCF_ON|LCDCF_BG8000|LCDCF_BG9800|LCDCF_BGON|LCDCF_OBJ8
    ld      <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
<span class="co1">; bucle principal</span>
control<span class="sy1">:</span>
    <span class="co1">; leemos el pad</span>
    <span class="kw1">call</span>    lee_pad
&nbsp;
    <span class="co1">; Ahora activamos o desactivamos el cronometro</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="nu0">%00000001</span>       <span class="co1">; Boton A</span>
    <span class="kw1">call</span>    nz<span class="sy1">,</span> Activa
&nbsp;
    <span class="co1">; Resetear</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="nu0">%00000010</span>       <span class="co1">; Boton B</span>
    <span class="kw1">call</span>    nz<span class="sy1">,</span> Resetea
&nbsp;
    ld      bc<span class="sy1">,</span> <span class="nu0">15000</span>
    <span class="kw1">call</span>    retardo
    <span class="co1">; volvemos a empezar</span>
    jr      control
&nbsp;
&nbsp;
<span class="co1">; Rutina de control del cronometro</span>
Activa<span class="sy1">:</span>
&nbsp;
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_ACTIVADO<span class="br0">&#93;</span>
    cp      <span class="nu0">1</span>
    <span class="kw1">jp</span>      z<span class="sy1">,</span> <span class="sy1">.</span>desactiva       <span class="co1">; si esta activado, desactivamos</span>
    <span class="co1">; si no, activamos</span>
    ld      a<span class="sy1">,</span> <span class="nu0">1</span>
    ld      <span class="br0">&#91;</span>_ACTIVADO<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    ld      a<span class="sy1">,</span> <span class="nu0">%00000100</span>    <span class="co1">; timer activado</span>
    ld      <span class="br0">&#91;</span>rTAC<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    ld      a<span class="sy1">,</span>  <span class="nu0">%00000101</span>   <span class="co1">; interrupciones del timer y vBlank</span>
    ld      <span class="br0">&#91;</span>rIE<span class="br0">&#93;</span><span class="sy1">,</span> a
    ei                      <span class="co1">; activamos las interrupciones</span>
    <span class="kw1">ret</span>                     <span class="co1">; volvemos</span>
<span class="sy1">.</span>desactiva
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>
    ld      <span class="br0">&#91;</span>_ACTIVADO<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    ld      a<span class="sy1">,</span> <span class="nu0">%00000000</span>    <span class="co1">; timer desactivado</span>
    ld      <span class="br0">&#91;</span>rTAC<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    ld      a<span class="sy1">,</span>  <span class="nu0">%00000101</span>   <span class="co1">; interrupciones del timer y vBlank</span>
    ld      <span class="br0">&#91;</span>rIE<span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="kw4">di</span>                      <span class="co1">; desactivamos las interrupciones</span>
&nbsp;
    <span class="kw1">ret</span>
&nbsp;
<span class="co1">; Resetea el cronometro</span>
Resetea<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>
    ld      <span class="br0">&#91;</span>_SEGUNDOS<span class="br0">&#93;</span><span class="sy1">,</span> a
    ld      <span class="br0">&#91;</span>_MINUTOS<span class="br0">&#93;</span><span class="sy1">,</span> a
    ld      <span class="br0">&#91;</span>_HORAS<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    ld      a<span class="sy1">,</span> <span class="nu0">51</span>           <span class="co1">; valor inicial del timer</span>
    ld      <span class="br0">&#91;</span>rTIMA<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; miramos si está activado</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_ACTIVADO<span class="br0">&#93;</span>
    <span class="kw1">ret</span>     z
    <span class="co1">; si no lo está, redibujamos</span>
    <span class="kw1">call</span> EsperaVBlank
    <span class="kw1">call</span> DibujaCronometro
&nbsp;
    <span class="kw1">ret</span>
&nbsp;
DibujaCronometro<span class="sy1">:</span>
    <span class="co1">; decenas de horas</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_HORAS<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="sy2">$</span>F0
    swap    a
    ld      <span class="br0">&#91;</span>_POS_CRONOM<span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="co1">; horas</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_HORAS<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="sy2">$</span><span class="nu0">0F</span>
    ld      <span class="br0">&#91;</span>_POS_CRONOM<span class="sy1">+</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="co1">; :</span>
    ld      a<span class="sy1">,</span> <span class="nu0">10</span>
    ld      <span class="br0">&#91;</span>_POS_CRONOM<span class="sy1">+</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="co1">; decenas de minutos</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_MINUTOS<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="sy2">$</span>F0
    swap    a
    ld      <span class="br0">&#91;</span>_POS_CRONOM<span class="sy1">+</span><span class="nu0">3</span><span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="co1">; minutos</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_MINUTOS<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="sy2">$</span><span class="nu0">0F</span>
    ld      <span class="br0">&#91;</span>_POS_CRONOM<span class="sy1">+</span><span class="nu0">4</span><span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="co1">; :</span>
    ld      a<span class="sy1">,</span> <span class="nu0">10</span>
    ld      <span class="br0">&#91;</span>_POS_CRONOM<span class="sy1">+</span><span class="nu0">5</span><span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="co1">; decenas de segundos</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_SEGUNDOS<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="sy2">$</span>F0
    swap    a
    ld      <span class="br0">&#91;</span>_POS_CRONOM<span class="sy1">+</span><span class="nu0">6</span><span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="co1">; segundos</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_SEGUNDOS<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="sy2">$</span><span class="nu0">0F</span>
    ld      <span class="br0">&#91;</span>_POS_CRONOM<span class="sy1">+</span><span class="nu0">7</span><span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="kw1">ret</span>
&nbsp;
<span class="co1">; Controla el tiempo</span>
ControlTimer<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_CONTROL_TIEMPO<span class="br0">&#93;</span>
    cp      <span class="nu0">20</span>                      <span class="co1">; cada 20 interrupciones, pasa 1 seg</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>incrementa
    <span class="kw1">inc</span>     a                       <span class="co1">; si no, incrementamos y volvemos</span>
    ld      <span class="br0">&#91;</span>_CONTROL_TIEMPO<span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="kw1">ret</span>
<span class="sy1">.</span>incrementa
    <span class="co1">; reseteamos el contador</span>
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>
    ld      <span class="br0">&#91;</span>_CONTROL_TIEMPO<span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="co1">; incrementamos los segundos</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_SEGUNDOS<span class="br0">&#93;</span>
    <span class="kw1">inc</span>     a
    <span class="kw1">daa</span>
    cp      <span class="nu0">96</span>              <span class="co1">; han pasado 60 segundos? (96 porque usamos BCD)</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>minutos     <span class="co1">; si, a controlar los minutos</span>
&nbsp;
    ld      <span class="br0">&#91;</span>_SEGUNDOS<span class="br0">&#93;</span><span class="sy1">,</span> a  <span class="co1">; no, guardamos y volvemos</span>
    <span class="kw1">ret</span>
<span class="sy1">.</span>minutos
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>
    ld      <span class="br0">&#91;</span>_SEGUNDOS<span class="br0">&#93;</span><span class="sy1">,</span> a  <span class="co1">; incrementar el minuto, segundos a 0</span>
&nbsp;
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_MINUTOS<span class="br0">&#93;</span>
    <span class="kw1">inc</span>     a
    <span class="kw1">daa</span>
    cp      <span class="nu0">96</span>              <span class="co1">; han pasado 60 minutos?</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>horas       <span class="co1">; si, a controlar las horas</span>
&nbsp;
    ld      <span class="br0">&#91;</span>_MINUTOS<span class="br0">&#93;</span><span class="sy1">,</span> a   <span class="co1">; no, guardamos y volvemos</span>
    <span class="kw1">ret</span>
<span class="sy1">.</span>horas
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>
    ld      <span class="br0">&#91;</span>_MINUTOS<span class="br0">&#93;</span><span class="sy1">,</span> a  <span class="co1">; incrementar el minuto, segundos a 0</span>
&nbsp;
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_HORAS<span class="br0">&#93;</span>
    <span class="kw1">inc</span>     a
    <span class="kw1">daa</span>
    cp      <span class="nu0">36</span>              <span class="co1">; han pasado 24 horas? (36 equivale a 24 en BCD)</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>reset       <span class="co1">; si, a volver a empezar</span>
&nbsp;
    ld      <span class="br0">&#91;</span>_HORAS<span class="br0">&#93;</span><span class="sy1">,</span> a   <span class="co1">; no, guardamos y volvemos</span>
    <span class="kw1">ret</span>
<span class="sy1">.</span>reset
    <span class="kw1">call</span>    Resetea
&nbsp;
    <span class="kw1">ret</span>
&nbsp;
<span class="co1">; Rutina de lectura del pad</span>
lee_pad<span class="sy1">:</span>
    <span class="co1">; a cero</span>
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>
    ld      <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; vamos a leer la cruzeta:</span>
    ld      a<span class="sy1">,</span> <span class="nu0">%00100000</span>    <span class="co1">; bit 4 a 0, bit 5 a 1 (cruzeta activada, botones no)</span>
    ld      <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; ahora leemos el estado de la cruzeta, para evitar el bouncing</span>
    <span class="co1">; hacemos varias lecturas</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
&nbsp;
    <span class="kw1">and</span>     <span class="sy2">$</span><span class="nu0">0F</span>             <span class="co1">; solo nos importan los 4 bits de abajo.</span>
    swap    a               <span class="co1">; intercambiamos parte baja y alta.</span>
    ld      b<span class="sy1">,</span> a            <span class="co1">; guardamos el estado de la cruzeta en b</span>
    <span class="co1">; vamos a por los botones</span>
    ld      a<span class="sy1">,</span> <span class="nu0">%00010000</span>    <span class="co1">; bit 4 a 1, bit 5 a 0 (botones activados, cruzeta no)</span>
    ld      <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; leemos varias veces para evitar el bouncing</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
&nbsp;
    <span class="co1">; tenemos en A, el estado de los botones</span>
    <span class="kw1">and</span>     <span class="sy2">$</span><span class="nu0">0F</span>             <span class="co1">; solo nos importan los 4 bits de abajo.</span>
    <span class="kw1">or</span>      b               <span class="co1">; hacemos un or con b, para &quot;meter&quot; en la parte</span>
                            <span class="co1">; superior de A, el estado de la cruzeta.</span>
&nbsp;
    <span class="co1">; ahora tenemos en A, el estado de todo, hacemos el complemento y</span>
    <span class="co1">; lo guardamos en la variable</span>
    cpl
    ld      <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; reseteamos el pad</span>
    ld      a<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">30</span>
    ld      <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; volvemos</span>
    <span class="kw1">ret</span>
&nbsp;
<span class="co1">; Rutina de apagado del LCD</span>
apaga_LCD<span class="sy1">:</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>
    rlca                    <span class="co1">; Pone el bit alto de LCDC en el flag de acarreo</span>
    <span class="kw1">ret</span>     nc              <span class="co1">; La pantalla ya está apagada, volver.</span>
&nbsp;
    <span class="co1">; esperamos al VBlank, ya que no podemos apagar la pantalla</span>
    <span class="co1">; en otro momento</span>
    <span class="kw1">call</span>    EsperaVBlank
&nbsp;
    <span class="co1">; estamos en VBlank, apagamos el LCD</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>       <span class="co1">; en A, el contenido del LCDC</span>
    res     <span class="nu0">7</span><span class="sy1">,</span>a             <span class="co1">; ponemos a cero el bit 7 (activado del LCD)</span>
    ld      <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span>a       <span class="co1">; escribimos en el registro LCDC el contenido de A</span>
&nbsp;
    <span class="kw1">ret</span>                     <span class="co1">; volvemos</span>
EsperaVBlank<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rLY<span class="br0">&#93;</span>
    cp      <span class="nu0">145</span>
    jr      nz<span class="sy1">,</span> EsperaVBlank
    <span class="kw1">ret</span>
&nbsp;
&nbsp;
<span class="co1">; rutina de retardo</span>
<span class="co1">; parámetros</span>
<span class="co1">; bc - numero de iteraciones</span>
retardo<span class="sy1">:</span>
<span class="sy1">.</span>delay<span class="sy1">:</span>
    <span class="kw1">dec</span>     bc              <span class="co1">; decrementamos</span>
    ld      a<span class="sy1">,</span> b            <span class="co1">; vemos si es cero</span>
    <span class="kw1">or</span>      c
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>fin_delay
    <span class="kw1">nop</span>
    jr      <span class="sy1">.</span>delay
<span class="sy1">.</span>fin_delay<span class="sy1">:</span>
    <span class="kw1">ret</span>
&nbsp;
<span class="co1">; rutina de copia a memoria</span>
<span class="co1">; copia un numero de bytes de una direccion a otra</span>
<span class="co1">; espera los parámetros:</span>
<span class="co1">; hl - dirección de datos a copiar</span>
<span class="co1">; de - dirección de destino</span>
<span class="co1">; bc - numero de datos a copiar</span>
<span class="co1">; destruye el contenido de A</span>
CopiaMemoria<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>     <span class="co1">; cargamos el dato en A</span>
    ld      <span class="br0">&#91;</span>de<span class="br0">&#93;</span><span class="sy1">,</span> a     <span class="co1">; copiamos el dato al destino</span>
    <span class="kw1">dec</span>     bc          <span class="co1">; uno menos por copiar</span>
    <span class="co1">; comprobamos si bc es cero</span>
    ld      a<span class="sy1">,</span> c
    <span class="kw1">or</span>      b
    <span class="kw1">ret</span>     z           <span class="co1">; si es cero, volvemos</span>
    <span class="co1">; si no, seguimos</span>
    <span class="kw1">inc</span>     hl
    <span class="kw1">inc</span>     de
    jr      CopiaMemoria
&nbsp;
&nbsp;
<span class="co1">; rutina de relleno de memoria</span>
<span class="co1">; rellena un numero de bytes de memoria con un dato</span>
<span class="co1">; espera los parámetros:</span>
<span class="co1">; de - direccion de destino</span>
<span class="co1">; bc - número de datos a rellenar</span>
<span class="co1">; l - dato a rellenar</span>
RellenaMemoria<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> l
    ld      <span class="br0">&#91;</span>de<span class="br0">&#93;</span><span class="sy1">,</span> a     <span class="co1">; mete el dato en el destino</span>
    <span class="kw1">dec</span>     bc          <span class="co1">; uno menos a rellenar</span>
&nbsp;
    ld      a<span class="sy1">,</span> c
    <span class="kw1">or</span>      b           <span class="co1">; comprobamos si bc es cero</span>
    <span class="kw1">ret</span>     z           <span class="co1">; si es cero volvemos</span>
    <span class="kw1">inc</span>     de          <span class="co1">; si no, seguimos</span>
    jr      RellenaMemoria
&nbsp;
&nbsp;
Tiles<span class="sy1">:</span>
<span class="co1">; números de 0 al 9, formato de tiles del RGBDS</span>
<span class="co1">; 0</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00333300</span>
<span class="kw5">DW</span>  `<span class="nu0">03000330</span>
<span class="kw5">DW</span>  `<span class="nu0">03003030</span>
<span class="kw5">DW</span>  `<span class="nu0">03030030</span>
<span class="kw5">DW</span>  `<span class="nu0">03300030</span>
<span class="kw5">DW</span>  `<span class="nu0">00333300</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="co1">; 1</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00003000</span>
<span class="kw5">DW</span>  `<span class="nu0">00033000</span>
<span class="kw5">DW</span>  `<span class="nu0">00003000</span>
<span class="kw5">DW</span>  `<span class="nu0">00003000</span>
<span class="kw5">DW</span>  `<span class="nu0">00003000</span>
<span class="kw5">DW</span>  `<span class="nu0">00333300</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="co1">; 2</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00333300</span>
<span class="kw5">DW</span>  `<span class="nu0">03000030</span>
<span class="kw5">DW</span>  `<span class="nu0">00003300</span>
<span class="kw5">DW</span>  `<span class="nu0">00030000</span>
<span class="kw5">DW</span>  `<span class="nu0">00300000</span>
<span class="kw5">DW</span>  `<span class="nu0">03333330</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="co1">; 3</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00333300</span>
<span class="kw5">DW</span>  `<span class="nu0">03000030</span>
<span class="kw5">DW</span>  `<span class="nu0">00003300</span>
<span class="kw5">DW</span>  `<span class="nu0">00000030</span>
<span class="kw5">DW</span>  `<span class="nu0">03000030</span>
<span class="kw5">DW</span>  `<span class="nu0">00333300</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="co1">; 4</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00000300</span>
<span class="kw5">DW</span>  `<span class="nu0">00003300</span>
<span class="kw5">DW</span>  `<span class="nu0">00030300</span>
<span class="kw5">DW</span>  `<span class="nu0">00333300</span>
<span class="kw5">DW</span>  `<span class="nu0">00000300</span>
<span class="kw5">DW</span>  `<span class="nu0">00000300</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="co1">; 5</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">03333330</span>
<span class="kw5">DW</span>  `<span class="nu0">03000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00333300</span>
<span class="kw5">DW</span>  `<span class="nu0">00000030</span>
<span class="kw5">DW</span>  `<span class="nu0">03000030</span>
<span class="kw5">DW</span>  `<span class="nu0">00333300</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="co1">; 6</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00003000</span>
<span class="kw5">DW</span>  `<span class="nu0">00030000</span>
<span class="kw5">DW</span>  `<span class="nu0">00300000</span>
<span class="kw5">DW</span>  `<span class="nu0">03333300</span>
<span class="kw5">DW</span>  `<span class="nu0">03000030</span>
<span class="kw5">DW</span>  `<span class="nu0">00333300</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="co1">; 7</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">03333330</span>
<span class="kw5">DW</span>  `<span class="nu0">00000300</span>
<span class="kw5">DW</span>  `<span class="nu0">00003000</span>
<span class="kw5">DW</span>  `<span class="nu0">00030000</span>
<span class="kw5">DW</span>  `<span class="nu0">00300000</span>
<span class="kw5">DW</span>  `<span class="nu0">00300000</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="co1">; 8</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00333300</span>
<span class="kw5">DW</span>  `<span class="nu0">03000030</span>
<span class="kw5">DW</span>  `<span class="nu0">00333300</span>
<span class="kw5">DW</span>  `<span class="nu0">03000030</span>
<span class="kw5">DW</span>  `<span class="nu0">03000030</span>
<span class="kw5">DW</span>  `<span class="nu0">00333300</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
&nbsp;
<span class="co1">; 9</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00333300</span>
<span class="kw5">DW</span>  `<span class="nu0">03000030</span>
<span class="kw5">DW</span>  `<span class="nu0">03000030</span>
<span class="kw5">DW</span>  `<span class="nu0">00333300</span>
<span class="kw5">DW</span>  `<span class="nu0">00003000</span>
<span class="kw5">DW</span>  `<span class="nu0">00330000</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
&nbsp;
<span class="co1">; :</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00033000</span>
<span class="kw5">DW</span>  `<span class="nu0">00033000</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00033000</span>
<span class="kw5">DW</span>  `<span class="nu0">00033000</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
&nbsp;
<span class="co1">; tile vacio</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
<span class="kw5">DW</span>  `<span class="nu0">00000000</span>
&nbsp;
FinTiles<span class="sy1">:</span></pre>
</dd></dl>

<p>
ROM: <a href="lib/exe/hola-timer3808.gb_%3b?media=hola-timer.gb" class="media mediafile mf_gb" title="hola-timer.gb (32 KB)">hola-timer.gb</a>
</p>

<p>
Resultado:
</p>

<p>
<a href="lib/exe/detail1a24.html?id=tutorial_de_ensamblador&amp;media=cronometro.png" class="media" title="cronometro.png"><img src="lib/exe/cronometro3632.png_%3b?media=cronometro.png" class="media" alt="" /></a>
</p>

</div>

<h3 class="sectionedit21" id="explicacion1">Explicación</h3>
<div class="level3">

<p>
Me han comentado que estaría bien que explicara un par de funciones, asi que vamos a ello:
</p>

<p>
Primero voy a explicar ControlTimer, porque nos ayudará a explicar mejor la otra.
</p>
<pre class="code asm"><span class="co1">; Controla el tiempo</span>
ControlTimer<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_CONTROL_TIEMPO<span class="br0">&#93;</span>
    cp      <span class="nu0">20</span>                      <span class="co1">; cada 20 interrupciones, pasa 1 seg</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>incrementa
    <span class="kw1">inc</span>     a                       <span class="co1">; si no, incrementamos y volvemos</span>
    ld      <span class="br0">&#91;</span>_CONTROL_TIEMPO<span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="kw1">ret</span></pre>

<p>
Como explico más arriba, tenemos que con el timer a 4096Hz y con el timer con valor inicial 51, se llama a la interrupción del timer cada aprox 0.05 segundos, asi que para contar de 1 en 1 segundos para el cronómetro, lo que hacemos aqui es contar las veces que se llama a esta subrutina, si se la ha llamado 20 veces, han pasado 0.05 * 20 = 1 segundo, asi que vamos a modificar el tiempo, si no, incrementamos el contador y volvemos.
</p>
<pre class="code asm"><span class="sy1">.</span>incrementa
    <span class="co1">; reseteamos el contador</span>
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>
    ld      <span class="br0">&#91;</span>_CONTROL_TIEMPO<span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="co1">; incrementamos los segundos</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_SEGUNDOS<span class="br0">&#93;</span>
    <span class="kw1">inc</span>     a
    <span class="kw1">daa</span>
    cp      <span class="nu0">96</span>              <span class="co1">; han pasado 60 segundos? (96 porque usamos BCD)</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>minutos     <span class="co1">; si, a controlar los minutos</span>
&nbsp;
    ld      <span class="br0">&#91;</span>_SEGUNDOS<span class="br0">&#93;</span><span class="sy1">,</span> a  <span class="co1">; no, guardamos y volvemos</span>
    <span class="kw1">ret</span></pre>

<p>
Bien, ahora vamos a incrementar el tiempo ya que ha pasado 1 segundo, primero reseteamos el contador de veces que se llama a la función, porque como han pasado 20, tenemos que volver a contar desde cero.
</p>

<p>
Luego vamos a aumentar los segundos. Cargamos en A los segundos, y le sumamos uno, entonces tenemos que ver si el resultado es mayor que 60, porque si es asi, tenemos que poner los segundos a cero, y sumar un minuto. Pero veis que uso daa. daa es una instrucción, que lo que hace es convertir el contenido de A a BCD (Binary Coded Decimal), si conoceis BCD, los numeros binarios en lugar de guardarse tal cual, se guardan en un byte de manera que cada 4 bits representan un numero del 0 al 9, y no del 0 al 15 como podria ser en base 2 normal. Esto es muy útil porque aunque con un byte sólo podemos guardar de 0 a 99, en cada medio byte tengo unidades y decenas respectivamente del número de segundos/minutos/horas, y esto nos será muy útil para luego dibujarlos. Asi que convierto el contenido de A en BCD y lo comparo con 60 (que en BCD es 0110 (6) y 0000 (0), 01100000 y eso es 96 representado en binario normal, que es lo que entiende el procesador al comparar, que el contenido en binario sea igual, por eso comparo con 96), si tenemos mas de 60 segundos, salto a aumentar los minutos, si no, guardo el resultado en los segundos, y vuelvo.
</p>
<pre class="code asm"><span class="sy1">.</span>minutos
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>
    ld      <span class="br0">&#91;</span>_SEGUNDOS<span class="br0">&#93;</span><span class="sy1">,</span> a  <span class="co1">; incrementar el minuto, segundos a 0</span>
&nbsp;
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_MINUTOS<span class="br0">&#93;</span>
    <span class="kw1">inc</span>     a
    <span class="kw1">daa</span>
    cp      <span class="nu0">96</span>              <span class="co1">; han pasado 60 minutos?</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>horas       <span class="co1">; si, a controlar las horas</span>
&nbsp;
    ld      <span class="br0">&#91;</span>_MINUTOS<span class="br0">&#93;</span><span class="sy1">,</span> a   <span class="co1">; no, guardamos y volvemos</span>
    <span class="kw1">ret</span>
<span class="sy1">.</span>horas
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>
    ld      <span class="br0">&#91;</span>_MINUTOS<span class="br0">&#93;</span><span class="sy1">,</span> a  <span class="co1">; incrementar el minuto, segundos a 0</span>
&nbsp;
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_HORAS<span class="br0">&#93;</span>
    <span class="kw1">inc</span>     a
    <span class="kw1">daa</span>
    cp      <span class="nu0">36</span>              <span class="co1">; han pasado 24 horas? (36 equivale a 24 en BCD)</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>reset       <span class="co1">; si, a volver a empezar</span>
&nbsp;
    ld      <span class="br0">&#91;</span>_HORAS<span class="br0">&#93;</span><span class="sy1">,</span> a   <span class="co1">; no, guardamos y volvemos</span>
    <span class="kw1">ret</span>
<span class="sy1">.</span>reset
    <span class="kw1">call</span>    Resetea
&nbsp;
    <span class="kw1">ret</span></pre>

<p>
Y aqui es casi lo mismo para los minutos y las horas. Para los minutos, lo primero que hago es poner los segundos a cero (59–&gt;0) y luego incremento los minutos y hago lo mismo que con los segundos, comprobar si han pasado 60 y en caso afrimativo ir a aumentar las horas, y si no volver. Y con las horas igual, sólo que si llegan a pasar 24 horas, reseteo, pongo todo a cero, y ale, a volver a empezar.
</p>

<p>
Y ahora explico la rutina que dibuja el cronómetro, que es muy sencilla.
Al inicio he definido una constante llamada _POS_CRONOM, tal que: _SCRN0+32*4+6. ¿Que significa eso? _SCRN0 era la dirección en memoria del mapa de fondo, donde se guarda que tile pintar en cada posición de los 32*32 tiles de fondo. Si a eso le sumo 32*4, obtengo, 32 bytes más adelante * 4 = La cuarta linea, y si le sumo 6, pues la cuarta linea de la pantalla, más 6 posiciones, el punto donde empezaré a dibujar el cronómetro.
Y a partir de aqui es muy sencillo. Tengo que empezar a dibujar por las decenas de horas, luego las horas, luego los dos puntos, luego decenas de minutos… etc. Pues viendo el principio de la rutina:
</p>
<pre class="code asm">    <span class="co1">; decenas de horas</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_HORAS<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="sy2">$</span>F0
    swap    a
    ld      <span class="br0">&#91;</span>_POS_CRONOM<span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="co1">; horas</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_HORAS<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="sy2">$</span><span class="nu0">0F</span>
    ld      <span class="br0">&#91;</span>_POS_CRONOM<span class="sy1">+</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="co1">; :</span>
    ld      a<span class="sy1">,</span> <span class="nu0">10</span>
    ld      <span class="br0">&#91;</span>_POS_CRONOM<span class="sy1">+</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="sy1">,</span> a</pre>

<p>
Cargo en el registro A, el contenido de la variable horas, como está guardada en BCD, sé que en el medio byte superior tengo las decenas de horas y en el inferior las unidades. Asi que para dibujar las decenas, hago un and de su contenido con $F0, que es %11110000, asi que esto borra el contenido de la media parte baja, dejando igual la media parte alta, y entonces haciendo swap, cambio la media parte alta por la media baja, con lo que ahora tengo en A, sólo el número de decenas de horas. Entonces simplemente cargo ese número en la posición _POS_CRONOM, que me meterá ese número en esa posición del mapa de pantalla. Sabemos que la gameboy, dibuja el fondo cogiendo los tiles de la lista de tiles segun el número que le digamos, entonces meterá en esa posición de fondo el tile número igual al número de decenas de horas. Como nuestros tiles del 0 al 9 son precisamente los dibujos de los números del 0 al 9, la gameboy dibujará en esa posición el número correspondiente a las decenas de horas.
Luego para las unidades de horas, hacemos algo similar, pero lo que hacemos es el and contrario, con $0F, porque sólo nos interesa quedarnos con la parte baja (las unidades) y entonces no necesitamos el swap y dibujamos directamente el tile correspondiente al número, pero ahora en_POS_CRONOM+1, porque queremos dibujarlo una posición más a la derecha.
Luego dibujamos los dos puntos (tile 10), y hacemos lo mismo para decenas de minuto, unidades de minuto, etc, simplemente añadiendo posiciones a la dirección inicial para dibujar el resto de números.
</p>

<p>
Y hasta aqui este ejemplo. Siguiente, bancos.
</p>

</div>

<h1 class="sectionedit22" id="hola_bancos">Hola Bancos</h1>
<div class="level1">

<p>
Como habia comentado, la Gameboy sólo puede manejar directamente un espacio de direcciones de 64K, y en ellos tiene que manejar la memoria ram, la memoria de video, los registros de entrada/salida, etc, por lo que para los datos del cartucho, solamente tenemos disponibles 32K, organizados en dos bloques de 16K, uno de $0000 a $3FFF y otro de $4000 a $7FFF.
</p>

<p>
Entonces, cuando necesitamos más memoria para nuestros programas, tenemos que usar los conocidos mappers. Un mapper es un chip que reside en el cartucho, y que escucha determinados “comandos” que le podemos mandar, para dejarnos dispobible más memoria en los cartuchos a nuestra petición. Esto se consigue mediante banking. Vamos a asumir, que el primer bloque de 16K el de $0000 a $3FFF, es un bloque fijo, que siempre está disponible al inicio de la memoria del cartucho en esa dirección. Pero en el segundo bloque, de $4000 a $7FFF, podemos mapear otras zonas de la memoria del cartucho, denominados bancos. En la GameBoy, estos bancos son siempre de 16K. Entonces por ejemplo: Si tenemos un cartucho con una memoria de 64K, lo dividimos en 4 bloques de 16K, y tenemos, que el bloque 0 de $0000 a $3FFF en la memoria del cartucho, siempre estará disponible en la memoria de la gameboy de $0000 a $3FFF, pero los otros 3 bloques, el 1, 2 y 3, podremos intercambiarlos en el rango de memoria de la gameboy de $4000 a $7FFF, asi pudiendo acceder en ese bloque a los tres bancos superiores de memoria del cartucho, uno por uno cuando los necesitemos.
</p>

<p>
Para hacerlo, como dije, necesitamos un mapper. A lo largo de la existencia de la GameBoy, se desarrollaron varioas de estos chips según iban creciendo las necesidades. Los mappers más conocidos son el MBC1, el MBC2, el MBC3 y el MBC5 que apareció ya con la GameBoy Color. Lo bueno es que la mayoría de estos mappers son muy parecidos entre si, sólo que cada vez permiten más memoria, pero el acceso básico suele ser compatible. Además estos mappers, introducian una característica muy importante. El permitirnos el uso de memoria RAM externa en el cartucho, normalmente protegida por una pila para que no pierda su contenido al apagar la consola, con lo que tenemos guardado de partidas o datos importantes.
</p>

<p>
Entonces vamos con el ejemplo. Lo primero que notareis es que he modificado la cabecera del cartucho, diciendo que ahora tenemos un cartucho con mapper MBC1, memoria ram externa y pila, que el cartucho tiene 64K de ROM y 8K de RAM. Necesitamos definir la cabecera de manera correcta en estos aspectos, aunque la GameBoy real los ignora y nos permite hacer cosas, normalmente los emuladores le hacen caso y solo permiten usar los bancos y el guardado si estos datos son correctos.
</p>

<p>
Meto todo el código posible en el banco cero, al iniciar mi programa con la dirección inicial como siempre, el enlazador me lo colocará todo en el banco 0 a no ser que le diga lo contrario.
</p>

<p>
Luego al final de programa, podeis ver que defino dos bancos y las directivas de como definirlos. Como os comenté los bancos superiores al 0, siempre tendrñan que ser mapeados en el segundo bloque de direcciones de $4000 a $7FFF, por eso les pongo esa dirección de inicio, pero además le digo al RGBDS que en la realidad me coloque esos datos en el banco X en la rom generada.
Asi en la memoria ROM del cartucho, realmente el banco 0 estará de $0000 a $3FFF, el banco 1 de $4000 a $7FFF, el banco 2 de $8000 a $BFFF, etc, pero cuando usemos el mapper para acceder a esos bancos, los “colocará” en la memoria de la gameboy de $4000 a $7FFF.
</p>

<p>
Asi el programa arranca y como es normal, por defecto al iniciar la consola, el mapper coloca el banco 1 a continuación del 0, con lo que si imprimimos el mensaje contenido en $4000, nos dice que está en el banco 1. Ahora pulsando A o B, podemos enviar los comandos al mapper que le indican cambiar el banco, asi si ahora imprimimos el mensaje en $4000, podemos estar imprimiendo el contenido del inicio del banco 1 o 2, por lo que el mensaje cambia.
Ademñas, si pulsamos Select, nos guarda el número del banco actual en la memoria externa, asi cuando encendais la GameBoy (o el emulador) de nuevo, vereis que “recuerda” el ultimo número de banco que teniais seleccionado cuando le disteis a “grabar” con Select.
</p>

<p>
Seleccionar un banco con el MBC1 es sencillo, simplemente escribimos el número de banco que queremos seleccionar, en la dirección de memoria $2000. Como es tontería escribir en esa dirección, porque en teoria estamos escribiendo en la ROM del cartucho, cosa imposible ya que es de sólo lectura, el mapper escucha este intento de escritura y selecciona un banco u otro en función de ese número que intentemos escribir. Muy sencillo.
</p>

<p>
Luego para la memoria, hay una diferencia, y es que tenemos que activarla. Se hace esto para evitar posibles accesos innecesarios a la memoria, o posibles fallos de alimentación(las pilas) que podrian ocasionar pérdida de datos, asi que cuando queramos acceder a la memoria externa, la activamos, leemos o escribimos, y desactivamos. Esto se consigue “escribiendo” un $0A en $0000 para activar la memoria externa, y un $00 en $0000 para desactivarla, y luego simplemente leemos o escribimos datos de $A000 a $BFFF. También tenemos bancos de RAM si necesitamos más, y funcionan igual que los bancos de ROM pero en bloques de 8K, usando la dirección $4000 para seleccionarlos (escribiendo ahi el número de banco que queremos).
</p>

<p>
Además he añadido alguna cosilla a este ejemplo, como las rutinas para imprimir cadenas de texto, o una fuente completa con los caracteres ascii desde el 32 (espacio) hasta el 127. Lo he hecho muy sencillo, uso el segundo bloque de memoria de tiles, de $8800 a $97FF que como sabemos usa números de -128 a 127, asi que el cero está en $9000. Si colo el espacio (ascii 32), 32 tiles arriba (cada tile tiene 2 bytes por linea, y 8 lineas, 32*2*8), asi que en $9200, puedo usar texto normal en mis datos para escribir en el fondo, ya que el número de carácter ascii, coincidirá con el número de tile a dibujar. Lo veis en las etiquetas con texto que uso, que escribo el texto tal cual entre comillas. El RGBDS se encarga de convertir estos caracteres en sus valores ascii para meterlos como si metiera bytes con DB a mano. Las cadenas las acabo en 0 (usando la coma como para añadir un byte mas), para que las rutinas de impresión, sepan donde terminar de imprimir.
</p>

<p>
Para generar la fuente, he creado un programilla en java, que toma una imagen de 768&times;8 pixels (96 tiles de 8&times;8) en escala de grises, y nos genera los datos de los tiles en formato del RGBDS. Lo publicaré enseguida.
</p>

<p>
Os dejo el código del ejemplo:
</p>
<dl class="code">
<dt><a href="holabancosb934.asm?do=export_code&amp;id=tutorial_de_ensamblador&amp;codeblock=42" title="Descargar trozo de código fuente" class="mediafile mf_asm">holabancos.asm</a></dt>
<dd><pre class="code asm"><span class="co1">; Hola Bancos</span>
<span class="co1">; David Pello 2010</span>
<span class="co1">; ladecadence.net</span>
<span class="co1">; Para el tutorial en: </span>
<span class="co1">; http://wiki.ladecadence.net/doku.php?id=tutorial_de_ensamblador</span>
&nbsp;
INCLUDE <span class="st0">&quot;gbhw.inc&quot;</span>          <span class="co1">; importamos el archivo de definiciones</span>
&nbsp;
<span class="co1">; Constantes</span>
_TILES_FUENTE       <span class="kw5">EQU</span>     <span class="sy2">$</span><span class="nu0">9200</span>       <span class="co1">; la segunda tabla de tiles va de $8800</span>
                                        <span class="co1">; a $97FF y los tiles van numerados</span>
                                        <span class="co1">; de -128 a 127, con lo que el tile 0</span>
                                        <span class="co1">; está en $9000. Si le sumo 32 tiles</span>
                                        <span class="co1">; (32*2bytes*8lineas) y coloco ahi</span>
                                        <span class="co1">; el primer caracter (espacio), me</span>
                                        <span class="co1">; coinciden con el codigo ASCII</span>
                                        <span class="co1">; y puedo usar cadenas de texto tal cual</span>
<span class="co1">; Variables</span>
_BANCO              <span class="kw5">EQU</span>     _RAM        <span class="co1">; guardaremos el banco actual</span>
_PAD                <span class="kw5">EQU</span>     _RAM<span class="sy1">+</span><span class="nu0">1</span>      <span class="co1">; estado del pad</span>
&nbsp;
<span class="co1">; interrupción de vBlank</span>
<span class="kw5">SECTION</span> <span class="st0">&quot;Vblank&quot;</span><span class="sy1">,</span>ROM0<span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">0040</span><span class="br0">&#93;</span>
    reti     <span class="co1">; no hacemos nada, volvemos</span>
&nbsp;
<span class="co1">; El programa comienza aqui:</span>
<span class="kw5">SECTION</span> <span class="st0">&quot;start&quot;</span><span class="sy1">,</span>ROM0<span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">0100</span><span class="br0">&#93;</span>
    <span class="kw1">nop</span>
    <span class="kw1">jp</span>      inicio
&nbsp;
<span class="co1">; Cabecera de la ROM (Macro definido en gbhw.inc)</span>
<span class="co1">; define una rom con mapper MBC1, de 64K y con RAM</span>
    ROM_HEADER  ROM_MBC1_RAM_BAT<span class="sy1">,</span> ROM_SIZE_64KBYTE<span class="sy1">,</span> RAM_SIZE_8KBYTE
&nbsp;
<span class="co1">; aqui empieza nuestro programa</span>
inicio<span class="sy1">:</span>
    <span class="kw1">nop</span>
    <span class="kw4">di</span>                      <span class="co1">; deshabilita las interrupciones</span>
    ld      <span class="kw4">sp</span><span class="sy1">,</span> <span class="sy2">$</span>ffff       <span class="co1">; apuntamos la pila al tope de la ram</span>
&nbsp;
inicializacion<span class="sy1">:</span>
&nbsp;
    <span class="co1">; iniciamos las variables</span>
    ld      a<span class="sy1">,</span> <span class="nu0">1</span>
    ld      <span class="br0">&#91;</span>_BANCO<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; paletas</span>
    ld      a<span class="sy1">,</span> <span class="nu0">%11100100</span>    <span class="co1">; Colores de paleta desde el mas oscuro al</span>
                            <span class="co1">; más claro, 11 10 01 00</span>
    ld      <span class="br0">&#91;</span>rBGP<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; escribimos esto en el registro de paleta de fondo</span>
    ld      <span class="br0">&#91;</span>rOBP0<span class="br0">&#93;</span><span class="sy1">,</span> a      <span class="co1">; y en la paleta 0 de sprites</span>
&nbsp;
    <span class="co1">; scroll</span>
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>            <span class="co1">; escribimos 0 en los registros de scroll X e Y</span>
    ld      <span class="br0">&#91;</span>rSCX<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; con lo que posicionamos la pantalla visible</span>
    ld      <span class="br0">&#91;</span>rSCY<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; al inicio (arriba a la izq) del fondo.</span>
&nbsp;
    <span class="co1">; video</span>
    <span class="kw1">call</span>    apaga_LCD       <span class="co1">; llamamos a la rutina que apaga el LCD</span>
&nbsp;
    <span class="co1">; cargamos los tiles en la segunda tabla de la memoria de tiles</span>
    ld      hl<span class="sy1">,</span> Fuente1     <span class="co1">; cargamos en HL la dirección de nuestro tile</span>
    ld      de<span class="sy1">,</span> _TILES_FUENTE       <span class="co1">; en DE dirección de la tabla</span>
    ld      bc<span class="sy1">,</span> EndFuente1<span class="sy1">-</span>Fuente1  <span class="co1">; número de bytes a copiar</span>
&nbsp;
    <span class="kw1">call</span>    CopiaMemoria
&nbsp;
    <span class="co1">; limpiamos el mapa</span>
    ld      de<span class="sy1">,</span> _SCRN0      <span class="co1">; mapa 0</span>
    ld      bc<span class="sy1">,</span> <span class="nu0">32</span><span class="sy1">*</span><span class="nu0">32</span>
    ld      l<span class="sy1">,</span> <span class="nu0">0</span>            <span class="co1">; tile vacio (espacio)</span>
    <span class="kw1">call</span>    RellenaMemoria
&nbsp;
    <span class="co1">; bien, tenemos todo el mapa de tiles cargado</span>
    <span class="co1">; ahora limpiamos la memoria de sprites</span>
    ld      de<span class="sy1">,</span> _OAMRAM     <span class="co1">; memoria de atributos de sprites</span>
    ld      bc<span class="sy1">,</span> <span class="nu0">40</span><span class="sy1">*</span><span class="nu0">4</span>        <span class="co1">; 40 sprites x 4 bytes cada uno</span>
    ld      l<span class="sy1">,</span> <span class="nu0">0</span>            <span class="co1">; lo vamos a poner todo a cero, asi los sprites</span>
    <span class="kw1">call</span>    RellenaMemoria  <span class="co1">; no usados quedan fuera de pantalla</span>
&nbsp;
    ld      b<span class="sy1">,</span> <span class="nu0">1</span>
    ld      c<span class="sy1">,</span> <span class="nu0">1</span>
    ld      hl<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">4000</span>
    <span class="kw1">call</span>    ImprimeCadena
&nbsp;
    ld      b<span class="sy1">,</span> <span class="nu0">1</span>
    ld      c<span class="sy1">,</span> <span class="nu0">16</span>
    ld      hl<span class="sy1">,</span> Info
    <span class="kw1">call</span>    ImprimeCadena
&nbsp;
    <span class="co1">; vamos a leer el dato guardado</span>
    ld      a<span class="sy1">,</span> <span class="sy2">$</span>0A
    ld      <span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">0000</span><span class="br0">&#93;</span><span class="sy1">,</span> a      <span class="co1">; activamos la RAM externa</span>
&nbsp;
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span><span class="sy2">$</span>A000<span class="br0">&#93;</span>      <span class="co1">; cargamos en a el dato</span>
    ld      b<span class="sy1">,</span> a            <span class="co1">; lo guardamos</span>
&nbsp;
    ld      a<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>
    ld      <span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">0000</span><span class="br0">&#93;</span><span class="sy1">,</span> a      <span class="co1">; desactivamos la RAM externa</span>
&nbsp;
    <span class="co1">; lo imprimimos </span>
    ld      l<span class="sy1">,</span> b
    ld      b<span class="sy1">,</span> <span class="nu0">18</span>
    ld      c<span class="sy1">,</span> <span class="nu0">16</span>
    <span class="kw1">call</span>    ImprimeNumero
&nbsp;
    <span class="co1">; configuramos y activamos el display</span>
    ld      a<span class="sy1">,</span> LCDCF_ON|LCDCF_BG8800|LCDCF_BG9800|LCDCF_BGON|LCDCF_OBJ8
    ld      <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
<span class="co1">; bucle principal</span>
control<span class="sy1">:</span>
    <span class="co1">; leemos el pad</span>
    <span class="kw1">call</span>    lee_pad
&nbsp;
    <span class="co1">; Ahora cambiamos al banco 1</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="nu0">%00000001</span>       <span class="co1">; Boton A</span>
    <span class="kw1">call</span>    nz<span class="sy1">,</span> Banco1
&nbsp;
    <span class="co1">; O al banco 2</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="nu0">%00000010</span>       <span class="co1">; Boton B</span>
    <span class="kw1">call</span>    nz<span class="sy1">,</span> Banco2
&nbsp;
    <span class="co1">; Guarda en la RAM externa</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span>
    <span class="kw1">and</span>     <span class="nu0">%000000100</span>       <span class="co1">; Boton Select</span>
    <span class="kw1">call</span>    nz<span class="sy1">,</span> Guarda
&nbsp;
&nbsp;
    ld      bc<span class="sy1">,</span> <span class="nu0">15000</span>
    <span class="kw1">call</span>    Retardo
    <span class="co1">; volvemos a empezar</span>
    jr      control
&nbsp;
&nbsp;
<span class="co1">; Cambia al banco 1 y muestra el mensaje</span>
Banco1<span class="sy1">:</span>
    <span class="co1">; escribimos el banco que queremos en la dirección de selección de bancos</span>
    ld      hl<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">2000</span>
    ld      <span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> <span class="nu0">01</span>        <span class="co1">; banco 1</span>
&nbsp;
    <span class="co1">; guardamos en la variable</span>
    ld      a<span class="sy1">,</span> <span class="nu0">01</span>
    ld      <span class="br0">&#91;</span>_BANCO<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; mostramos el mensaje que reside al inicio del banco superior</span>
    <span class="kw1">call</span>    EsperaVBlank
    ld      b<span class="sy1">,</span> <span class="nu0">1</span>
    ld      c<span class="sy1">,</span> <span class="nu0">1</span>
    ld      hl<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">4000</span>
    <span class="kw1">call</span>    ImprimeCadena
&nbsp;
    <span class="co1">; hemos cambiado, borrar el mensaje de guardado si lo hay</span>
    ld      b<span class="sy1">,</span> <span class="nu0">1</span>
    ld      c<span class="sy1">,</span> <span class="nu0">12</span>
    ld      hl<span class="sy1">,</span> Limpia
    <span class="kw1">call</span>    ImprimeCadena
&nbsp;
&nbsp;
    <span class="kw1">ret</span>
&nbsp;
<span class="co1">; Cambia al banco 2 y muestra el mensaje</span>
Banco2<span class="sy1">:</span>
    <span class="co1">; lo mismo pero seleccionamos el banco 2</span>
    ld      hl<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">2000</span>
    ld      <span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> <span class="nu0">02</span>
&nbsp;
    ld      a<span class="sy1">,</span> <span class="nu0">02</span>
    ld      <span class="br0">&#91;</span>_BANCO<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="kw1">call</span>    EsperaVBlank
    ld      b<span class="sy1">,</span> <span class="nu0">1</span>
    ld      c<span class="sy1">,</span> <span class="nu0">1</span>
    ld      hl<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">4000</span>
    <span class="kw1">call</span>    ImprimeCadena
&nbsp;
    <span class="co1">; hemos cambiado, borrar el mensaje de guardado si lo hay</span>
    ld      b<span class="sy1">,</span> <span class="nu0">1</span>
    ld      c<span class="sy1">,</span> <span class="nu0">12</span>
    ld      hl<span class="sy1">,</span> Limpia
    <span class="kw1">call</span>    ImprimeCadena
&nbsp;
    <span class="kw1">ret</span>
&nbsp;
<span class="co1">; Guarda el número de banco actual en la memoria del cartucho</span>
Guarda<span class="sy1">:</span>
    <span class="co1">; primero activamos la SRAM externa</span>
    ld      a<span class="sy1">,</span> <span class="sy2">$</span>0A          <span class="co1">; $0A, activar</span>
    ld      <span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">0000</span><span class="br0">&#93;</span><span class="sy1">,</span> a      <span class="co1">; </span>
&nbsp;
    <span class="co1">;escribimos el dato en el primer byte de la ram externa</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_BANCO<span class="br0">&#93;</span>
    ld      <span class="br0">&#91;</span><span class="sy2">$</span>A000<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; desactivamos la SRAM</span>
    ld      a<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>          <span class="co1">; $00, desactivar</span>
    ld      <span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">0000</span><span class="br0">&#93;</span><span class="sy1">,</span> a      <span class="co1">; </span>
&nbsp;
    <span class="co1">; lo imprimimos</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_BANCO<span class="br0">&#93;</span>
    ld      l<span class="sy1">,</span>  a
    ld      b<span class="sy1">,</span> <span class="nu0">18</span>
    ld      c<span class="sy1">,</span> <span class="nu0">16</span>
    <span class="kw1">call</span>    ImprimeNumero
&nbsp;
    <span class="co1">; mostramos mensaje</span>
    ld      b<span class="sy1">,</span> <span class="nu0">1</span>
    ld      c<span class="sy1">,</span> <span class="nu0">12</span>
    ld      hl<span class="sy1">,</span> Guardado
    <span class="kw1">call</span>    ImprimeCadena
&nbsp;
    <span class="kw1">ret</span>
&nbsp;
&nbsp;
&nbsp;
<span class="co1">; Imprime una cadena de texto en el fondo (cadena acabada en 0)</span>
<span class="co1">; Parámetros:</span>
<span class="co1">; b - coordenada x</span>
<span class="co1">; c - coordenada y</span>
<span class="co1">; hl - dirección de la cadena</span>
ImprimeCadena<span class="sy1">:</span>
    <span class="kw1">push</span>    hl          <span class="co1">; guardamos hl pa luego</span>
    <span class="co1">; vamos a usar hl ahora para los cálculos del destino</span>
    ld      hl<span class="sy1">,</span> _SCRN0
    <span class="co1">; vamos a la posición y</span>
    ld      a<span class="sy1">,</span> c
    cp      <span class="nu0">0</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>fin_y   <span class="co1">; si es cero, vamos a por las x</span>
<span class="sy1">.</span>avz_y<span class="sy1">:</span>
    ld      de<span class="sy1">,</span> <span class="nu0">32</span>
    <span class="kw1">add</span>     hl<span class="sy1">,</span> de      <span class="co1">; avanzamos en las Y por lo tanto 32 tiles</span>
    <span class="kw1">dec</span>     a
    jr      nz<span class="sy1">,</span> <span class="sy1">.</span>avz_y
<span class="sy1">.</span>fin_y<span class="sy1">:</span>
<span class="co1">; vamos a por las x</span>
    ld      a<span class="sy1">,</span> b
    cp      <span class="nu0">0</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>fin_x   <span class="co1">; si es cero, terminamos</span>
<span class="sy1">.</span>avz_x<span class="sy1">:</span>
    <span class="kw1">inc</span>     hl
    <span class="kw1">dec</span>     a
    jr      nz<span class="sy1">,</span> <span class="sy1">.</span>avz_x
<span class="sy1">.</span>fin_x<span class="sy1">:</span>
    <span class="kw1">push</span>    hl
    <span class="kw1">pop</span>     de          <span class="co1">; de = hl</span>
<span class="co1">; bien, tenemos en 'de' la posición de memoria donde escribir la cadena</span>
<span class="co1">; vamos a ello</span>
    <span class="kw1">pop</span>     hl          <span class="co1">; rescatamos hl de la pila</span>
<span class="sy1">.</span>imprime<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>     <span class="co1">; cargamos un carácter</span>
    cp      <span class="nu0">0</span>
    <span class="kw1">ret</span>     z           <span class="co1">; si es cero, volvemos</span>
    ld      <span class="br0">&#91;</span>de<span class="br0">&#93;</span><span class="sy1">,</span> a     <span class="co1">; si no, imprimimos</span>
    <span class="kw1">inc</span>     de          <span class="co1">; siguiente </span>
    <span class="kw1">inc</span>     hl
    jr      <span class="sy1">.</span>imprime
    <span class="kw1">ret</span>
&nbsp;
<span class="co1">; Imprime un numero (unidad)</span>
<span class="co1">; Parámetros</span>
<span class="co1">; b - posicion x</span>
<span class="co1">; c - posición y</span>
<span class="co1">; l - numero a imprimir (0-9)</span>
ImprimeNumero<span class="sy1">:</span>
    <span class="kw1">push</span>    hl          <span class="co1">; guardamos hl pa luego</span>
    <span class="co1">; vamos a usar hl ahora para los cálculos del destino</span>
    ld      hl<span class="sy1">,</span> _SCRN0
    <span class="co1">; vamos a la posición y</span>
    ld      a<span class="sy1">,</span> c
    cp      <span class="nu0">0</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>fin_y   <span class="co1">; si es cero, vamos a por las x</span>
<span class="sy1">.</span>avz_y<span class="sy1">:</span>
    ld      de<span class="sy1">,</span> <span class="nu0">32</span>
    <span class="kw1">add</span>     hl<span class="sy1">,</span> de      <span class="co1">; avanzamos en las Y por lo tanto 32 tiles</span>
    <span class="kw1">dec</span>     a
    jr      nz<span class="sy1">,</span> <span class="sy1">.</span>avz_y
<span class="sy1">.</span>fin_y<span class="sy1">:</span>
<span class="co1">; vamos a por las x</span>
    ld      a<span class="sy1">,</span> b
    cp      <span class="nu0">0</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>fin_x   <span class="co1">; si es cero, terminamos</span>
<span class="sy1">.</span>avz_x<span class="sy1">:</span>
    <span class="kw1">inc</span>     hl
    <span class="kw1">dec</span>     a
    jr      nz<span class="sy1">,</span> <span class="sy1">.</span>avz_x
<span class="sy1">.</span>fin_x<span class="sy1">:</span>
    <span class="kw1">push</span>    hl
    <span class="kw1">pop</span>     de          <span class="co1">; de = hl</span>
<span class="co1">; bien, tenemos en 'de' la posición de memoria donde escribir el numero</span>
<span class="co1">; vamos a ello</span>
    <span class="kw1">pop</span>     hl          <span class="co1">; rescatamos el número</span>
    ld      a<span class="sy1">,</span> l
    <span class="kw1">and</span>     <span class="sy2">$</span><span class="nu0">0F</span>         <span class="co1">; solo nos interesa la parte baja</span>
&nbsp;
    <span class="kw1">add</span>     a<span class="sy1">,</span> <span class="nu0">48</span>       <span class="co1">; el primer caracter es 32 el espacio, el cero está a +16</span>
    ld      <span class="br0">&#91;</span>de<span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="kw1">ret</span>
&nbsp;
<span class="co1">; Rutina de lectura del pad</span>
lee_pad<span class="sy1">:</span>
    <span class="co1">; a cero</span>
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>
    ld      <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; vamos a leer la cruzeta:</span>
    ld      a<span class="sy1">,</span> <span class="nu0">%00100000</span>    <span class="co1">; bit 4 a 0, bit 5 a 1 (cruzeta activada, botones no)</span>
    ld      <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; ahora leemos el estado de la cruzeta, para evitar el bouncing</span>
    <span class="co1">; hacemos varias lecturas</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
&nbsp;
    <span class="kw1">and</span>     <span class="sy2">$</span><span class="nu0">0F</span>             <span class="co1">; solo nos importan los 4 bits de abajo.</span>
    swap    a               <span class="co1">; intercambiamos parte baja y alta.</span>
    ld      b<span class="sy1">,</span> a            <span class="co1">; guardamos el estado de la cruzeta en b</span>
&nbsp;
    <span class="co1">; vamos a por los botones</span>
    ld      a<span class="sy1">,</span> <span class="nu0">%00010000</span>    <span class="co1">; bit 4 a 1, bit 5 a 0 (botones activados, cruzeta no)</span>
    ld      <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; leemos varias veces para evitar el bouncing</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span>
&nbsp;
    <span class="co1">; tenemos en A, el estado de los botones</span>
    <span class="kw1">and</span>     <span class="sy2">$</span><span class="nu0">0F</span>             <span class="co1">; solo nos importan los 4 bits de abajo.</span>
    <span class="kw1">or</span>      b               <span class="co1">; hacemos un or con b, para &quot;meter&quot; en la parte</span>
                            <span class="co1">; superior de A, el estado de la cruzeta.</span>
&nbsp;
    <span class="co1">; ahora tenemos en A, el estado de todo, hacemos el complemento y</span>
    <span class="co1">; lo guardamos en la variable</span>
    cpl
    ld      <span class="br0">&#91;</span>_PAD<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; reseteamos el pad</span>
    ld      a<span class="sy1">,</span><span class="sy2">$</span><span class="nu0">30</span>
    ld      <span class="br0">&#91;</span>rP1<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; volvemos</span>
    <span class="kw1">ret</span>
&nbsp;
<span class="co1">; Rutina de apagado del LCD</span>
apaga_LCD<span class="sy1">:</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>
    rlca                    <span class="co1">; Pone el bit alto de LCDC en el flag de acarreo</span>
    <span class="kw1">ret</span>     nc              <span class="co1">; La pantalla ya está apagada, volver.</span>
&nbsp;
    <span class="co1">; esperamos al VBlank, ya que no podemos apagar la pantalla</span>
    <span class="co1">; en otro momento</span>
    <span class="kw1">call</span>    EsperaVBlank
&nbsp;
    <span class="co1">; estamos en VBlank, apagamos el LCD</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>       <span class="co1">; en A, el contenido del LCDC</span>
    res     <span class="nu0">7</span><span class="sy1">,</span>a             <span class="co1">; ponemos a cero el bit 7 (activado del LCD)</span>
    ld      <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span>a       <span class="co1">; escribimos en el registro LCDC el contenido de A</span>
&nbsp;
    <span class="kw1">ret</span>                     <span class="co1">; volvemos</span>
&nbsp;
EsperaVBlank<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rLY<span class="br0">&#93;</span>
    cp      <span class="nu0">145</span>
    jr      nz<span class="sy1">,</span> EsperaVBlank
    <span class="kw1">ret</span>
&nbsp;
&nbsp;
<span class="co1">; rutina de retardo</span>
<span class="co1">; parámetros</span>
<span class="co1">; bc - numero de iteraciones</span>
Retardo<span class="sy1">:</span>
<span class="sy1">.</span>delay<span class="sy1">:</span>
    <span class="kw1">dec</span>     bc              <span class="co1">; decrementamos</span>
    ld      a<span class="sy1">,</span> b            <span class="co1">; vemos si es cero</span>
    <span class="kw1">or</span>      c
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>fin_delay
    <span class="kw1">nop</span>
    jr      <span class="sy1">.</span>delay
<span class="sy1">.</span>fin_delay<span class="sy1">:</span>
    <span class="kw1">ret</span>
&nbsp;
<span class="co1">; rutina de copia a memoria</span>
<span class="co1">; copia un numero de bytes de una direccion a otra</span>
<span class="co1">; espera los parámetros:</span>
<span class="co1">; hl - dirección de datos a copiar</span>
<span class="co1">; de - dirección de destino</span>
<span class="co1">; bc - numero de datos a copiar</span>
<span class="co1">; destruye el contenido de A</span>
CopiaMemoria<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>     <span class="co1">; cargamos el dato en A</span>
    ld      <span class="br0">&#91;</span>de<span class="br0">&#93;</span><span class="sy1">,</span> a     <span class="co1">; copiamos el dato al destino</span>
    <span class="kw1">dec</span>     bc          <span class="co1">; uno menos por copiar</span>
    <span class="co1">; comprobamos si bc es cero</span>
    ld      a<span class="sy1">,</span> c
    <span class="kw1">or</span>      b
    <span class="kw1">ret</span>     z           <span class="co1">; si es cero, volvemos</span>
    <span class="co1">; si no, seguimos</span>
    <span class="kw1">inc</span>     hl
    <span class="kw1">inc</span>     de
    jr      CopiaMemoria
&nbsp;
&nbsp;
<span class="co1">; rutina de relleno de memoria</span>
<span class="co1">; rellena un numero de bytes de memoria con un dato</span>
<span class="co1">; espera los parámetros:</span>
<span class="co1">; de - direccion de destino</span>
<span class="co1">; bc - número de datos a rellenar</span>
<span class="co1">; l - dato a rellenar</span>
RellenaMemoria<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> l
    ld      <span class="br0">&#91;</span>de<span class="br0">&#93;</span><span class="sy1">,</span> a     <span class="co1">; mete el dato en el destino</span>
    <span class="kw1">dec</span>     bc          <span class="co1">; uno menos a rellenar</span>
&nbsp;
    ld      a<span class="sy1">,</span> c
    <span class="kw1">or</span>      b           <span class="co1">; comprobamos si bc es cero</span>
    <span class="kw1">ret</span>     z           <span class="co1">; si es cero volvemos</span>
    <span class="kw1">inc</span>     de          <span class="co1">; si no, seguimos</span>
    jr      RellenaMemoria
&nbsp;
&nbsp;
Limpia<span class="sy1">:</span>
    <span class="kw5">DB</span> <span class="st0">&quot;                     &quot;</span><span class="sy1">,</span><span class="nu0">0</span>
Info<span class="sy1">:</span>
    <span class="kw5">DB</span> <span class="st0">&quot;Banco guardado: &quot;</span><span class="sy1">,</span> <span class="nu0">0</span>
Guardado<span class="sy1">:</span>
    <span class="kw5">DB</span> <span class="st0">&quot;Guardado correcto&quot;</span><span class="sy1">,</span> <span class="nu0">0</span>
&nbsp;
<span class="co1">; Fuente</span>
<span class="co1">; ========================================================================</span>
INCLUDE <span class="st0">&quot;fuente1.agb&quot;</span>
&nbsp;
<span class="co1">; Datos del primer Banco</span>
<span class="co1">; ========================================================================</span>
<span class="kw5">SECTION</span> <span class="st0">&quot;Banco1&quot;</span><span class="sy1">,</span><span class="kw5">CODE</span><span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">4000</span><span class="br0">&#93;</span><span class="sy1">,</span>BANK<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span>
    <span class="kw5">DB</span> <span class="st0">&quot;Soy el banco 1&quot;</span><span class="sy1">,</span><span class="nu0">0</span>
&nbsp;
<span class="co1">; Datos del segundo Banco</span>
<span class="co1">; ========================================================================</span>
<span class="kw5">SECTION</span> <span class="st0">&quot;Banco2&quot;</span><span class="sy1">,</span><span class="kw5">CODE</span><span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">4000</span><span class="br0">&#93;</span><span class="sy1">,</span>BANK<span class="br0">&#91;</span><span class="nu0">2</span><span class="br0">&#93;</span>
    <span class="kw5">DB</span> <span class="st0">&quot;Soy el banco 2&quot;</span><span class="sy1">,</span><span class="nu0">0</span></pre>
</dd></dl>

<p>
Y el archivo con la fuente: <a href="lib/exe/fuente1d05f.agb_%3b?media=fuente1.agb" class="media mediafile mf_agb" title="fuente1.agb (9.9 KB)">fuente1.agb</a>
</p>

<p>
La captura obligada:
</p>

<p>
<a href="../external.html?link=http://wiki.ladecadence.net/lib/exe/detail.php?id=tutorial_de_ensamblador&amp;media=bancos.png" class="media" title="bancos.png"><img src="../external.html?link=http://wiki.ladecadence.net/lib/exe/fetch.php?media=bancos.png" class="media" alt="" /></a>
</p>

</div>

<h1 class="sectionedit23" id="hola_sonido">Hola Sonido</h1>
<div class="level1">

<p>
El sonido de la GameBoy es un tema complejo si vienes de programar en un sistema moderno donde simplemente reproduces sonido digital, mezclando fácilmente música y efectos.
La GameBoy por el contrario, tiene un hardware de sonido bastante sencillo, formado por cuatro canales independientes y diferentes entre si. Podemos controlar estos canales a nuestro antojo, que la GameBoy se encargará de mezclarlos. Estos cuatro canales se manejan escribiendo valores en registros mapeados en memoria (cómo no), y cada canal cuenta con varios registros para cada uno de sus parámetros, asi que el tema lleva un rato explicarlo. Vamos a conocer los canales y luego veremos como se programan.
</p>
<ul>
<li class="level1"><div class="li"> Canal 1: El canal 1, es un canal de onda cuadrada con ciclo de trabajo modificable, con envolvente y portamento.</div>
</li>
<li class="level1"><div class="li"> Canal 2: Es un canal de onda cuadrada con ciclo de trabajo modificable, con envolvente.</div>
</li>
<li class="level1"><div class="li"> Canal 3: Canal de onda programable con una tabla RAM de 32 pasos. </div>
</li>
<li class="level1"><div class="li"> Canal 4: Canal de ruido blanco con envolvente.</div>
</li>
</ul>

<p>
Bien, para empezar, voy a explicar un poco de teoria musical, bueno, sólo lo que nos interesa, el ciclo de trabajo, la envolvente y el portamento.
</p>

<p>
El <strong>ciclo de trabajo</strong>, es algo muy sencillo, si tenemos que la onda es cuadrada, es simplemente cuanto del tiempo de la duración de la nota, tenemos el nivel alto, y cuanto tiempo el nivel bajo. Esto se expresa en tanto por ciento. Asi en la GamebBoy podemos elegir ciclos de trabajo del 12,5%, 25%, 50%, y 75%. Vamos a explicarlo con una imagen robada de por ahi:
</p>

<p>
<a href="../external.gif?link=http://wiki.ladecadence.net/lib/exe/detail.php?id=tutorial_de_ensamblador&amp;media=pwm-duty_cycle2.gif" class="media" title="pwm-duty_cycle2.gif"><img src="../external.gif?link=http://wiki.ladecadence.net/lib/exe/fetch.php?media=pwm-duty_cycle2.gif" class="media" alt="" /></a>
</p>

<p>
Como veis, las ondas tienen la misma frecuencia (todas empiezan en el mismo momento), pero dependiendo del ciclo de trabajo, unas se pasan más tiempo arriba y otras más tiempo abajo.
</p>

<p>
<strong>La envolvente</strong> de una nota, es una función que se aplica a la amplitud de esta, para modificarla y que varie a lo largo de la duración de la misma. En síntesis, se suele usar una envolvente conocida como ADSR, de <em>Attack</em>, <em>Decay</em>, <em>Sustain</em> y <em>Release</em>, es decir, ataque, decaimiento, sostenimiento y relajación.
Vamos a poner un gráfico… wikipedia al rescate. Si tenemos que una nota normal, tendria cierta amplitud (volumen) fija, la gráfica de su amplitud, sería una linea recta. Ahora si le aplicamos una envolvente ADSR modelo, tendriamos algo como esto:
</p>

<p>
<a href="../external.html?link=http://wiki.ladecadence.net/lib/exe/detail.php?id=tutorial_de_ensamblador&amp;media=500px-adsr_envelope_graph.svg.png" class="media" title="500px-adsr_envelope_graph.svg.png"><img src="../external.html?link=http://wiki.ladecadence.net/lib/exe/fetch.php?media=500px-adsr_envelope_graph.svg.png" class="media" alt="" /></a>
</p>

<p>
Con lo que viendo esto, podemos decir, que, el ataque, es el tiempo que tarda la nota en llegar hasta su máxima amplitud, el decaimiento, es el tiempo que tarda en pasar desde el fin del ataque, hasta el valor de sostenimiento, que es el valor de amplitud que mantenemos hasta el fin de la nota, y la relajación, el tiempo que tarda la nota en “desaparecer” desde que la acabamos de tocar.
Con todos estos parámetros de envolvente, podemos modelar las notas de manera que cambien bastante aunque estemos tocando la misma frecuencia.
</p>

<p>
<strong>El portamento</strong>, es cuando el paso de una nota a otra, no es directo, sino que la frecuencia va cambiando progresivamente tocando todos los sonidos intermedios. Esto por ejemplo en una guitarra se hace cuando se arrastra el dedo sobre todos los trastes entre dos notas que se quieran tocar. En la GameBoy, este hardware de portamento, nos permite variar una nota con el tiempo, pudiendo definir un incremento o decremento de la frecuencia base con el tiempo, y cuanto cambia esta frecuencia.
</p>

<p>
Vamos a ver a continuación los registros del sistema de sonido y sus funciones:
</p>

</div>

<h3 class="sectionedit24" id="canal_1_-_tono_y_portamento">Canal 1 - Tono y portamento</h3>
<div class="level3">

</div>

<h4 id="ff10_-_nr10_-_registro_de_portamento_del_canal_1_r_w">$FF10 - NR10 - Registro de portamento del canal 1(R/W)</h4>
<div class="level4">
<pre class="code">Bit 6-4 - Duración del portamento
Bit 3   - Incremento/Decremento del portamento
           0: Adicción     (la frecuencia se incrementa)
           1: Sustracción (la frecuencia se decrementa)
Bit 2-0 - Paso actual del desplazamiento (n: 0-7)</pre>

<p>
Duración del portamento:
</p>
<pre class="code">000: Apagado - sin cambios de frecuencia
001: 7.8 ms  (1/128Hz)
010: 15.6 ms (2/128Hz)
011: 23.4 ms (3/128Hz)
100: 31.3 ms (4/128Hz)
101: 39.1 ms (5/128Hz)
110: 46.9 ms (6/128Hz)
111: 54.7 ms (7/128Hz)</pre>

<p>
El cambio de la frecuencia original (definido en NR13,NR14) en cada paso, se calcula con la siguiente fórmula, donde X(0) es la frecuencia inicial y X(t-1) es la última frecuencia:
</p>
<pre class="code">X(t) = X(t-1) +/- X(t-1)/2^n</pre>

</div>

<h4 id="ff11_-_nr11_-_canal_1_duracion_ciclo_de_trabajo_r_w">$FF11 - NR11 - Canal 1 duración/ciclo de trabajo (R/W)</h4>
<div class="level4">
<pre class="code">Bit 7-6 - Ciclo de trabajo (R/W)
Bit 5-0 - Longitud (R) (t1: 0-63)</pre>

<p>
Ciclo de trabajo:
</p>
<pre class="code">00: 12.5% ( _-------_-------_------- )
01: 25%   ( __------__------__------ )
10: 50%   ( ____----____----____---- ) (normal)
11: 75%   ( ______--______--______-- )</pre>

<p>
Longitud = (64-t1)*(1/256) segundos
La longitud solo se utiliza si el Bit 6 en NR14 está a uno.
</p>

</div>

<h4 id="ff12_-_nr12_-_canal_1_-_envolvente_r_w">$FF12 - NR12 - Canal 1 - Envolvente (R/W)</h4>
<div class="level4">
<pre class="code">Bit 7-4 - Volumen inicial de la envolvente (0-0Fh) (0=Sin sonido)
Bit 3   - Dirección de la envolvente (0=Decrece, 1=Crece)
Bit 2-0 - Periodo (n: 0-7)
          (si es cero, la envolvente no actua.)</pre>

<p>
Longitud de un paso = n*(1/64) segundos
</p>

</div>

<h4 id="ff13_-_nr13_-_canal_1_-_frecuencia_low_w">$FF13 - NR13 - Canal 1 - Frecuencia (low) (W)</h4>
<div class="level4">

<p>
8 bits bajos de los 11 bit de la frecuencia (x).
Los siguientes 3 bits están en NR14 ($FF14)
</p>

</div>

<h4 id="ff14_-_nr14_-_canal_1_-_frecuencia_hi_r_w">$FF14 - NR14 - Canal 1 - Frecuencia (hi) (R/W)</h4>
<div class="level4">
<pre class="code">Bit 7   - Disparador (1=Reinicia el sonido) (W)
Bit 6   - Activa o desactiva la longitud (R/W)
          (1=Detiene el sonido cuando alcanza la longitud en NR11)
Bit 2-0 - 3 bits altos de la frecuencia (x) (W)</pre>

<p>
Frecuencia = 131072/(2048-x) Hz
</p>

</div>

<h3 class="sectionedit25" id="canal_2_-_tono">Canal 2 - Tono</h3>
<div class="level3">

<p>
Este canal funciona exactamente igual que el 1, pero no tiene un registro de portamento.
</p>

</div>

<h4 id="ff16_-_nr21_-_canal_2_longitud_ciclo_de_trabajo_r_w">$FF16 - NR21 - Canal 2 Longitud/Ciclo de trabajo (R/W)</h4>
<div class="level4">
<pre class="code">Bit 7-6 - Ciclo de trabajo (R/W)
Bit 5-0 - Longitud (R) (t1: 0-63)</pre>

<p>
Ciclo de trabajo:
</p>
<pre class="code">00: 12.5% ( _-------_-------_------- )
01: 25%   ( __------__------__------ )
10: 50%   ( ____----____----____---- ) (normal)
11: 75%   ( ______--______--______-- )</pre>

<p>
Longitud = (64-t1)*(1/256) segundos
La longitud solo se utiliza si el Bit 6 en NR14 está a uno.
</p>

</div>

<h4 id="ff17_-_nr22_-_canal_2_envolvente_r_w">$FF17 - NR22 - Canal 2 Envolvente (R/W)</h4>
<div class="level4">
<pre class="code">Bit 7-4 - Volumen inicial de la envolvente (0-0Fh) (0=Sin sonido)
Bit 3   - Dirección de la envolvente (0=Decrece, 1=Crece)
Bit 2-0 - Periodo (n: 0-7)
          (si es cero, la envolvente no actua.)</pre>

<p>
Longitud de un paso = n*(1/64) segundos
</p>

</div>

<h4 id="ff18_-_nr23_-_canal_2_-_frecuencia_lo_w">$FF18 - NR23 - Canal 2 - Frecuencia (lo) (W)</h4>
<div class="level4">

<p>
8 bits bajos de los 11 bit de la frecuencia (x).
Los siguientes 3 bits están en NR24 ($FF19)
</p>

</div>

<h4 id="ff19_-_nr24_-_canal_2_-_frecuencia_hi_r_w">$FF19 - NR24 - Canal 2 - Frecuencia (hi) (R/W)</h4>
<div class="level4">
<pre class="code">Bit 7   - Disparador (1=Reinicia el sonido) (W)
Bit 6   - Activa o desactiva la longitud (R/W)
          (1=Detiene el sonido cuando alcanza la longitud en NR21)
Bit 2-0 - 3 bits altos de la frecuencia (x) (W)</pre>

<p>
Frecuencia = 131072/(2048-x) Hz
</p>

</div>

<h3 class="sectionedit26" id="canal_3_-_onda_programable">Canal 3 - Onda programable</h3>
<div class="level3">

<p>
Este canal se puede usar para reproducir sonido digital, pero la longitud del buffer de samples (RAM de onda) Está limitada a 32 valores de 4 Bits. Se podria usar este canal para sacar notas normales si inicicalizamos la memoria de onda con los valores de una onda cuadrada. No dispone de control de envolvente.
</p>

</div>

<h4 id="ff1a_-_nr30_-_canal_3_on_off_r_w">$FF1A - NR30 - Canal 3 on/off (R/W)</h4>
<div class="level4">
<pre class="code">Bit 7 - Apaga o enciende el canal  (0=Detenido, 1=Reproduce)  (R/W)</pre>

</div>

<h4 id="ff1b_-_nr31_-_canal_3_-_longitud">$FF1B - NR31 - Canal 3 - Longitud</h4>
<div class="level4">
<pre class="code">Bit 7-0 - Longitud (t1: 0 - 255)</pre>

<p>
Longitud = (256-t1)*(1/256) segundos.
Este valor sólo se usa si el bit 6 de NR34 está a uno.
</p>

</div>

<h4 id="ff1c_-_nr32_-_canal_3_-_nivel_de_salida_r_w">$FF1C - NR32 - Canal 3 - Nivel de salida (R/W)</h4>
<div class="level4">
<pre class="code">Bit 6-5 - Seleccionar volumen de la salida (R/W)</pre>

<p>
Posibles valores son:
</p>
<pre class="code">00: Apagado (sin sonido)
01: 100% Volumen (Datos de la RAM de onda tal cual)
10:  50% Volumen (Datos de la RAM de onda desplazados una vez a la derecha)
11:  25% Volumen (Datos de la RAM de onda desplazados dos veces a la derecha)</pre>

</div>

<h4 id="ff1d_-_nr33_-_canal_3_-_frecuencia_lo_w">$FF1D - NR33 - Canal 3 - Frecuencia (lo) (W)</h4>
<div class="level4">

<p>
8 bits bajos de la frecuencia del canal(x).
</p>

</div>

<h4 id="ff1e_-_nr34_-_canal_3_-_frecuencia_hi_r_w">$FF1E - NR34 - Canal 3 - Frecuencia (hi) (R/W)</h4>
<div class="level4">
<pre class="code">Bit 7   - Disparador (1=Reinicia el sonido) (W)
Bit 6   - Activa o desactiva la longitud (R/W)
          (1=Detiene el sonido cuando alcanza la longitud en NR11)
Bit 2-0 - 3 bits altos de la frecuencia (x) (W)</pre>

<p>
Frecuencia = 131072/(2048-x) Hz
</p>

</div>

<h4 id="ff30-_ff3f_-_memoria_de_onda">$FF30-$FF3F - Memoria de onda</h4>
<div class="level4">

<p>
Contiene los valores para la generación de la onda.
</p>

<p>
Esta memoria se organiza en 32 valores de 4 bit que se reproducen con los 4 bits altos en primer lugar.
</p>

</div>

<h3 class="sectionedit27" id="canal_4_-_ruido">Canal 4 - Ruido</h3>
<div class="level3">

<p>
Este canal se usa para reproducir ruido blanco. Esto se logra variando la amplitud aleatoriamente dada una frecuencia. Dependiendo de la frecuencia, el ruido parecerá más “duro” o “blando”.
</p>

<p>
También se puede influenciar la salida del generador de números aleatorios, permitiendo menos variación y asi una salida de tono casi normal.
</p>

</div>

<h4 id="ff20_-_nr41_-_canal_4_-_longitud_r_w">$FF20 - NR41 - Canal 4 - Longitud (R/W)</h4>
<div class="level4">
<pre class="code">Bit 5-0 - Longitud (R) (t1: 0-63)</pre>

<p>
Longitud = (64-t1)*(1/256) segundos
La longitud solo se utiliza si el Bit 6 en NR44 está a uno.
</p>

</div>

<h4 id="ff21_-_nr42_-_canal_4_-_envolvente_r_w">$FF21 - NR42 - Canal 4 - Envolvente (R/W)</h4>
<div class="level4">
<pre class="code">Bit 7-4 - Volumen inicial de la envolvente (0-0Fh) (0=Sin sonido)
Bit 3   - Dirección de la envolvente (0=Decrece, 1=Crece)
Bit 2-0 - Periodo (n: 0-7)
          (si es cero, la envolvente no actua.)</pre>

<p>
Longitud de un paso = n*(1/64) segundos
</p>

</div>

<h4 id="ff22_-_nr43_-_canal_4_-_contador_polinomico_r_w">$FF22 - NR43 - Canal 4 - Contador polinómico (R/W)</h4>
<div class="level4">

<p>
La amplitud se cambia aleatoriamente entre alto y bajo a la frecuencia dada. Una frecuencia alta hará el ruido más “suave”.
Cuando el bit 3 está a uno, la salida es más regular, y algunas frecuencias suenan más como tono que como ruido.
</p>
<pre class="code">Bit 7-4 - Frecuencia del reloj de desplazamiento (s)
Bit 3   - Longitud del contador (0=15 bits, 1=7 bits)
Bit 2-0 - Radio de división de las frecuencias (r)</pre>

<p>
Frecuencia = 524288 Hz / r / 2^(s+1) ; Para r=0, se comporta como si r=0.5
</p>

</div>

<h4 id="ff23_-_nr44_-_channel_4_-_contadordisparador_r_w">$FF23 - NR44 - Channel 4 - Contador; Disparador (R/W)</h4>
<div class="level4">
<pre class="code">Bit 7   - Disparador (1=Reinicia el sonido) (W)
Bit 6   - Activa o desactiva la longitud (R/W)
          (1=Detiene el sonido cuando alcanza la longitud en NR41)</pre>

</div>

<h3 class="sectionedit28" id="registros_de_control_generales_del_sonido">Registros de control generales del sonido</h3>
<div class="level3">

</div>

<h4 id="ff24_-_nr50_-_control_de_volumen_5_canal_r_w">$FF24 - NR50 - Control de volumen / 5º Canal (R/W)</h4>
<div class="level4">

<p>
Los bits de volumen controlan el Volumen principal de las salidas izquierda y derecha.
</p>
<pre class="code">Bit 7   - Vin sale por SO2 (1=activado)
Bit 6-4 - Volumen de SO2 (0-7)
Bit 3   - Vin sale por SO1 (1=Activado)
Bit 2-0 - Volumen de SO1 (0-7)</pre>

<p>
La señal Vin viene del bus del cartucho, permitiendo a hardware externo en este, añadir un quinto canal a los cuatro internos de la GameBoy.
</p>

</div>

<h4 id="ff25_-_nr51_-_seleccion_de_salida_de_cada_canal_r_w">$FF25 - NR51 - Selección de salida de cada canal (R/W)</h4>
<div class="level4">

<p>
Nos permite enviar cada canal a la salida izquierda o derecha (o a ambas o ninguna).
</p>
<pre class="code">Bit 7 - Canal 4 a la salida SO2
Bit 6 - Canal 3 a la salida SO2
Bit 5 - Canal 2 a la salida SO2 
Bit 4 - Canal 1 a la salida SO2
Bit 3 - Canal 4 a la salida SO1
Bit 2 - Canal 3 a la salida SO1
Bit 1 - Canal 2 a la salida SO1
Bit 0 - Canal 1 a la salida SO1</pre>

</div>

<h4 id="ff26_-_nr52_-_sonido_encendido_apagado">$FF26 - NR52 - Sonido Encendido/Apagado</h4>
<div class="level4">

<p>
Si tus programas de GameBoy no usan sonido, escribir 00h en este registro, te ahorrará un 16% o más de consumo eléctrico. Deshabilitar el sistema de sonido poniendo a cero el Bit 7 destruye el contenido de todos los registros de sonido. Además, deja inaccesibles todos estos registros (excepto el mismo $FF26) mientras el sistema de sonido esté apagado.
</p>
<pre class="code">Bit 7 - Activa o desactiva todo el sonido  (0: Detener todos los circuitos de sonido) (R/W)
Bit 3 - Canal 4 ON (R)
Bit 2 - Canal 3 ON (R)
Bit 1 - Canal 2 ON (R)
Bit 0 - Canal 1 ON (R)</pre>

<p>
Los Bits 0-3 de este registro, son sólamente bits de estátus, escribir en ellos no activa o desactiva el sonido de esos canales. Estos flags se ponen a uno cuando se activa el flag “Disparador” del canal (Bit 7 en NR14-NR44), el flag permanece a uno mientras dure la longitud del sonido (si está activa). Una envolvente que ha hecho bajar la amplitud a cero, no desactivaria este flag.
</p>

</div>

<h3 class="sectionedit29" id="ejemplo">Ejemplo</h3>
<div class="level3">

<p>
Bien, vamos con un ejemplo, rescatamos el programa del sprite, y le añadimos música, bueno, si a esto se le puede llamar música <img src="../external.gif?link=http://wiki.ladecadence.net/lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />
Lo que hago es ir tocando las notas de la escala (Do, Re, Mi, Fa, Sol, La, Si), de la 5ª octava cada cierto tiempo. Tengo una linea de datos con los valores bajos de la frecuencia de estas notas, y el valor alto, que es siempre el mismo en las notas de la 5ª octava, lo meto fijo en el registro correspondiente.
Para todo esto uso el canal 2. Atentos a las funciones <em>iniciar_sonido</em>, donde activo el sistema de sonido y preparo la salida por ambos altavoces, y preparo el canal 2, longitud, ciclo de trabajo, envolvente y meto el valor alto de la frecuencia y activo la longitud, y a la función <em>cambia_nota</em> que comprueba si tenemos que tocar la nota (dependiendo de la constante TEMPO) y toca la nota y prepara la siguente.
</p>
<dl class="code">
<dt><a href="../external.html?link=http://wiki.ladecadence.net/doku.php?do=export_code&amp;id=tutorial_de_ensamblador&amp;codeblock=43" title="Descargar trozo de código fuente" class="mediafile mf_agb">holasonido.agb</a></dt>
<dd><pre class="code asm"><span class="co1">; Hola sonido</span>
<span class="co1">; David Pello 2010</span>
<span class="co1">; ladecadence.net</span>
<span class="co1">; Para el tutorial en:</span>
<span class="co1">; http://wiki.ladecadence.net/doku.php?id=tutorial_de_ensamblador</span>
&nbsp;
INCLUDE <span class="st0">&quot;gbhw.inc&quot;</span>                      <span class="co1">; importamos el archivo de definiciones</span>
&nbsp;
<span class="co1">; Velocidad de la musica, no es un tempo real en el sentido musical</span>
_TEMPO          <span class="kw5">EQU</span>             <span class="nu0">20</span>
&nbsp;
<span class="co1">; definimos unas constantes para trabajar con nuestro sprite</span>
_SPR0_Y         <span class="kw5">EQU</span>             _OAMRAM <span class="co1">; la Y del sprite 0, es el inicio de la mem de sprites</span>
_SPR0_X         <span class="kw5">EQU</span>             _OAMRAM<span class="sy1">+</span><span class="nu0">1</span>
_SPR0_NUM       <span class="kw5">EQU</span>             _OAMRAM<span class="sy1">+</span><span class="nu0">2</span>
_SPR0_ATT       <span class="kw5">EQU</span>             _OAMRAM<span class="sy1">+</span><span class="nu0">3</span>
&nbsp;
<span class="co1">; creamos un par de variables para ver hacia donde tenemos que mover el sprite</span>
_MOVX           <span class="kw5">EQU</span>             _RAM    <span class="co1">; inicio de la ram dispobible para datos</span>
_MOVY           <span class="kw5">EQU</span>             _RAM<span class="sy1">+</span><span class="nu0">1</span>
&nbsp;
<span class="co1">; guarda la nota actual</span>
_NOTA           <span class="kw5">EQU</span>             _RAM<span class="sy1">+</span><span class="nu0">2</span>
<span class="co1">; contador para el tempo</span>
_CONT_MUS       <span class="kw5">EQU</span>             _RAM<span class="sy1">+</span><span class="nu0">3</span>
&nbsp;
<span class="co1">; El programa comienza aqui:</span>
<span class="kw5">SECTION</span> <span class="st0">&quot;start&quot;</span><span class="sy1">,</span>ROM0<span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">0100</span><span class="br0">&#93;</span>
    <span class="kw1">nop</span>
    <span class="kw1">jp</span>          inicio
&nbsp;
<span class="co1">; Cabecera de la ROM (Macro definido en gbhw.inc)</span>
<span class="co1">; define una rom sin mapper, de 32K y sin RAM, lo más básico</span>
<span class="co1">; (como por ejemplo la del tetris)</span>
        ROM_HEADER  ROM_NOMBC<span class="sy1">,</span> ROM_SIZE_32KBYTE<span class="sy1">,</span> RAM_SIZE_0KBYTE
&nbsp;
<span class="co1">; aqui empieza nuestro programa</span>
inicio<span class="sy1">:</span>
        <span class="kw1">nop</span>
        <span class="kw4">di</span>                                              <span class="co1">; deshabilita las interrupciones</span>
        ld              <span class="kw4">sp</span><span class="sy1">,</span> <span class="sy2">$</span>ffff               <span class="co1">; apuntamos la pila al tope de la ram</span>
&nbsp;
inicializacion<span class="sy1">:</span>
        ld              a<span class="sy1">,</span> <span class="nu0">%11100100</span>    <span class="co1">; Colores de paleta desde el mas oscuro al</span>
                                                        <span class="co1">; más claro, 11 10 01 00</span>
        ld              <span class="br0">&#91;</span>rBGP<span class="br0">&#93;</span><span class="sy1">,</span> a               <span class="co1">; escribimos esto en el registro de paleta de fondo</span>
        ld              <span class="br0">&#91;</span>rOBP0<span class="br0">&#93;</span><span class="sy1">,</span> a              <span class="co1">; y en la paleta 0 de sprites</span>
&nbsp;
        ld              a<span class="sy1">,</span> <span class="nu0">0</span>                    <span class="co1">; escribimos 0 en los registros de scroll X e Y</span>
        ld              <span class="br0">&#91;</span>rSCX<span class="br0">&#93;</span><span class="sy1">,</span> a               <span class="co1">; con lo que posicionamos la pantalla visible</span>
        ld              <span class="br0">&#91;</span>rSCY<span class="br0">&#93;</span><span class="sy1">,</span> a               <span class="co1">; al inicio (arriba a la izq) del fondo.</span>
&nbsp;
        <span class="kw1">call</span>    inicia_sonido           <span class="co1">; iniciamos el sistema de sonido</span>
&nbsp;
        <span class="kw1">call</span>    apaga_LCD               <span class="co1">; llamamos a la rutina que apaga el LCD</span>
&nbsp;
        <span class="co1">; cargamos los tiles en la memoria de tiles</span>
&nbsp;
        ld              hl<span class="sy1">,</span> Tiles               <span class="co1">; cargamos en HL la dirección de nuestro tile</span>
        ld              de<span class="sy1">,</span> _VRAM               <span class="co1">; en DE dirección de la memoria de video</span>
        ld              b<span class="sy1">,</span> <span class="nu0">32</span>                   <span class="co1">; b = 32, numero de bytes a copiar (2 tiles)</span>
&nbsp;
<span class="sy1">.</span>bucle_carga<span class="sy1">:</span>
        ld              a<span class="sy1">,</span><span class="br0">&#91;</span>hl<span class="br0">&#93;</span>                  <span class="co1">; cargamos en A el dato apuntado por HL</span>
        ld              <span class="br0">&#91;</span>de<span class="br0">&#93;</span><span class="sy1">,</span> a                 <span class="co1">; y lo metemos en la dirección apuntada en DE</span>
        <span class="kw1">dec</span>             b                               <span class="co1">; decrementamos b, b=b-1</span>
        jr              z<span class="sy1">,</span> <span class="sy1">.</span>fin_bucle_carga <span class="co1">; si b = 0, terminamos, no queda nada por copiar</span>
        <span class="kw1">inc</span>             hl                              <span class="co1">; incrementamos la dirección a leer de</span>
        <span class="kw1">inc</span>             de                              <span class="co1">; incrementamos la dirección a escribir en</span>
        jr              <span class="sy1">.</span>bucle_carga    <span class="co1">; seguimos</span>
<span class="sy1">.</span>fin_bucle_carga<span class="sy1">:</span>
&nbsp;
        <span class="co1">; ahora limpiamos la pantalla (llenamos todo el mapa de fondo), con el tile 0</span>
&nbsp;
        ld              hl<span class="sy1">,</span> _SCRN0
        ld              de<span class="sy1">,</span> <span class="nu0">32</span><span class="sy1">*</span><span class="nu0">32</span>               <span class="co1">; numero de tiles en el mapa de fondo</span>
<span class="sy1">.</span>bucle_limpieza<span class="sy1">:</span>
        ld              a<span class="sy1">,</span> <span class="nu0">0</span>                    <span class="co1">; el tile 0 es nuestro tile vacio</span>
        ld              <span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> a
        <span class="kw1">dec</span>             de
        <span class="co1">; ahora tengo que comprobar si de es cero, para ver si tengo que</span>
        <span class="co1">; terminar de copiar. dec de no modifica ningñun flag, asi que no puedo</span>
        <span class="co1">; comprobar el flag zero directamente, pero para que de sea cero, d y e</span>
        <span class="co1">; tienen que ser cero los dos, asi que puedo hacer un or entre ellos,</span>
        <span class="co1">; y si el resultado es cero, ambos son cero.</span>
        ld              a<span class="sy1">,</span> d                    <span class="co1">; cargamos d en a</span>
        <span class="kw1">or</span>              e                               <span class="co1">; y hacemos un or con e</span>
        <span class="kw1">jp</span>              z<span class="sy1">,</span> <span class="sy1">.</span>fin_bucle_limpieza  <span class="co1">; si d OR e es cero, de es cero. Terminamos.</span>
        <span class="kw1">inc</span>             hl                              <span class="co1">; incrementamos la dirección a escribir en</span>
        <span class="kw1">jp</span>              <span class="sy1">.</span>bucle_limpieza
<span class="sy1">.</span>fin_bucle_limpieza
&nbsp;
        <span class="co1">; bien, tenemos todo el mapa de tiles lleno con el tile 0,</span>
        <span class="co1">; ahora vamos a crear el sprite.</span>
&nbsp;
        ld              a<span class="sy1">,</span> <span class="nu0">30</span>
        ld              <span class="br0">&#91;</span>_SPR0_Y<span class="br0">&#93;</span><span class="sy1">,</span> a    <span class="co1">; posición Y del sprite</span>
        ld              a<span class="sy1">,</span> <span class="nu0">30</span>
        ld              <span class="br0">&#91;</span>_SPR0_X<span class="br0">&#93;</span><span class="sy1">,</span> a    <span class="co1">; posición X del sprite</span>
        ld              a<span class="sy1">,</span> <span class="nu0">1</span>
        ld              <span class="br0">&#91;</span>_SPR0_NUM<span class="br0">&#93;</span><span class="sy1">,</span> a  <span class="co1">; número de tile en la tabla de tiles que usaremos</span>
        ld              a<span class="sy1">,</span> <span class="nu0">0</span>
        ld              <span class="br0">&#91;</span>_SPR0_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a  <span class="co1">; atributos especiales, de momento nada.</span>
&nbsp;
        <span class="co1">; configuramos y activamos el display</span>
        ld      a<span class="sy1">,</span> LCDCF_ON|LCDCF_BG8000|LCDCF_BG9800|LCDCF_BGON|LCDCF_OBJ8|LCDCF_OBJON
        ld      <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
        <span class="co1">; preparamos las variables de la animacion</span>
        ld              a<span class="sy1">,</span> <span class="nu0">1</span>
        ld              <span class="br0">&#91;</span>_MOVX<span class="br0">&#93;</span><span class="sy1">,</span> a
        ld              <span class="br0">&#91;</span>_MOVY<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
        <span class="co1">;preparamos las variables para el sonido</span>
        <span class="co1">; nota actual</span>
        ld              a<span class="sy1">,</span> <span class="nu0">0</span>
        ld              <span class="br0">&#91;</span>_NOTA<span class="br0">&#93;</span><span class="sy1">,</span> a
        <span class="co1">; contador retardo musical</span>
        ld              <span class="br0">&#91;</span>_CONT_MUS<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
        <span class="co1">; bucle infinito</span>
animacion<span class="sy1">:</span>
        <span class="co1">; lo primero, esperamos por el VBlank, ya que no podemos modificar</span>
        <span class="co1">; la VRAM fuera de él, o pasarán cosas raras</span>
<span class="sy1">.</span>wait<span class="sy1">:</span>
        ld              a<span class="sy1">,</span> <span class="br0">&#91;</span>rLY<span class="br0">&#93;</span>
        cp              <span class="nu0">145</span>
        jr              nz<span class="sy1">,</span> <span class="sy1">.</span>wait
        <span class="co1">; incrementamos las y</span>
        ld              a<span class="sy1">,</span> <span class="br0">&#91;</span>_SPR0_Y<span class="br0">&#93;</span>    <span class="co1">; cargamos la posición Y actual del sprite</span>
        ld              hl<span class="sy1">,</span> _MOVY               <span class="co1">; en hl, la dirección del incremento Y</span>
        <span class="kw1">add</span>             a<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>                 <span class="co1">; sumamos</span>
        ld              hl<span class="sy1">,</span> _SPR0_Y
        ld              <span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> a                 <span class="co1">; guardamos</span>
        <span class="co1">; comparamos para ver si hay que cambiar el sentido</span>
        cp              <span class="nu0">152</span>                             <span class="co1">; para que no se salga de la pantalla (max Y)</span>
        jr              z<span class="sy1">,</span> <span class="sy1">.</span>dec_y
        cp              <span class="nu0">16</span>
        jr              z<span class="sy1">,</span> <span class="sy1">.</span>inc_y               <span class="co1">; lo mismo, minima coord (min Y = 16)</span>
        <span class="co1">; no hay que cambiar</span>
        jr              <span class="sy1">.</span>end_y
<span class="sy1">.</span>dec_y<span class="sy1">:</span>
        ld              a<span class="sy1">,</span> <span class="sy1">-</span><span class="nu0">1</span>                   <span class="co1">; ahora hay que decrementar las Y</span>
        ld              <span class="br0">&#91;</span>_MOVY<span class="br0">&#93;</span><span class="sy1">,</span> a
        jr              <span class="sy1">.</span>end_y
<span class="sy1">.</span>inc_y<span class="sy1">:</span>
        ld              a<span class="sy1">,</span> <span class="nu0">1</span>                    <span class="co1">; ahora hay que incrementar las Y</span>
        ld              <span class="br0">&#91;</span>_MOVY<span class="br0">&#93;</span><span class="sy1">,</span> a
<span class="sy1">.</span>end_y<span class="sy1">:</span>
        <span class="co1">; vamos con las X, lo mismo pero cambiando los márgenes</span>
        ld              a<span class="sy1">,</span> <span class="br0">&#91;</span>_SPR0_X<span class="br0">&#93;</span>    <span class="co1">; cargamos la posición X actual del sprite</span>
        ld              hl<span class="sy1">,</span> _MOVX               <span class="co1">; en hl, la dirección del incremento X</span>
        <span class="kw1">add</span>             a<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>                 <span class="co1">; sumamos</span>
        ld              hl<span class="sy1">,</span> _SPR0_X
        ld              <span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> a                 <span class="co1">; guardamos</span>
        <span class="co1">; comparamos para ver si hay que cambiar el sentido</span>
        cp              <span class="nu0">160</span>                             <span class="co1">; para que no se salga de la pantalla (max X)</span>
        jr              z<span class="sy1">,</span> <span class="sy1">.</span>dec_x
        cp              <span class="nu0">8</span>                               <span class="co1">; lo mismo, minima coord izq = 8</span>
        jr              z<span class="sy1">,</span> <span class="sy1">.</span>inc_x
        <span class="co1">; no hay que cambiar</span>
        jr              <span class="sy1">.</span>end_x
<span class="sy1">.</span>dec_x<span class="sy1">:</span>
        ld              a<span class="sy1">,</span> <span class="sy1">-</span><span class="nu0">1</span>                   <span class="co1">; ahora hay que decrementar las X</span>
        ld              <span class="br0">&#91;</span>_MOVX<span class="br0">&#93;</span><span class="sy1">,</span> a
        jr              <span class="sy1">.</span>end_x
<span class="sy1">.</span>inc_x<span class="sy1">:</span>
        ld              a<span class="sy1">,</span> <span class="nu0">1</span>                    <span class="co1">; ahora hay que incrementar las X</span>
        ld              <span class="br0">&#91;</span>_MOVX<span class="br0">&#93;</span><span class="sy1">,</span> a
<span class="sy1">.</span>end_x<span class="sy1">:</span>
        <span class="co1">; un pequeño retardo</span>
        <span class="kw1">call</span> retardo
        <span class="co1">; tocamos la nota siguiente</span>
        <span class="kw1">call</span> cambia_nota
        <span class="co1">; volvemos a empezar</span>
        jr              animacion
&nbsp;
<span class="co1">; Rutina de apagado del LCD</span>
apaga_LCD<span class="sy1">:</span>
        ld              a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>
        rlca                    <span class="co1">; Pone el bit alto de LCDC en el flag de acarreo</span>
        <span class="kw1">ret</span>             nc              <span class="co1">; La pantalla ya está apagada, volver.</span>
&nbsp;
        <span class="co1">; esperamos al VBlank, ya que no podemos apagar la pantalla</span>
        <span class="co1">; en otro momento</span>
&nbsp;
<span class="sy1">.</span>espera_VBlank
        ld              a<span class="sy1">,</span> <span class="br0">&#91;</span>rLY<span class="br0">&#93;</span>
        cp              <span class="nu0">145</span>
        jr              nz<span class="sy1">,</span> <span class="sy1">.</span>espera_VBlank
&nbsp;
        <span class="co1">; estamos en VBlank, apagamos el LCD</span>
        ld              a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>               <span class="co1">; en A, el contenido del LCDC</span>
        res             <span class="nu0">7</span><span class="sy1">,</span>a                             <span class="co1">; ponemos a cero el bit 7 (activado del LCD)</span>
        ld              <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span>a               <span class="co1">; escribimos en el registro LCDC el contenido de A</span>
&nbsp;
        <span class="kw1">ret</span>                                             <span class="co1">; volvemos</span>
&nbsp;
<span class="co1">; rutina de retardo</span>
retardo<span class="sy1">:</span>
        ld              de<span class="sy1">,</span> <span class="nu0">2000</span>                <span class="co1">; numero de veces a ejecutar el bucle</span>
<span class="sy1">.</span>delay<span class="sy1">:</span>
        <span class="kw1">dec</span>             de                              <span class="co1">; decrementamos</span>
        ld              a<span class="sy1">,</span> d                    <span class="co1">; vemos si es cero</span>
        <span class="kw1">or</span>              e
        jr              z<span class="sy1">,</span> <span class="sy1">.</span>fin_delay
        <span class="kw1">nop</span>
        jr              <span class="sy1">.</span>delay
<span class="sy1">.</span>fin_delay<span class="sy1">:</span>
        <span class="kw1">ret</span>
&nbsp;
<span class="co1">; rutina para iniciar el sistema de sonido</span>
inicia_sonido<span class="sy1">:</span>
        <span class="co1">; activamos sistema de sonido</span>
        ld              a<span class="sy1">,</span> <span class="nu0">%10000000</span>
        ld              <span class="br0">&#91;</span>rNR52<span class="br0">&#93;</span><span class="sy1">,</span> a
        <span class="co1">; iniciamos los volumenes, etc</span>
        ld              a<span class="sy1">,</span> <span class="nu0">%01110111</span>            <span class="co1">; SO1 y S02 a tope de volumen</span>
        ld              <span class="br0">&#91;</span>rNR50<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
        ld              a<span class="sy1">,</span> <span class="nu0">%00000010</span>            <span class="co1">; Canal 2, sale por SO1 y S02</span>
        ld              <span class="br0">&#91;</span>rNR51<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
        <span class="co1">; canal 2, longitud 63, ciclo 50%</span>
        ld              a<span class="sy1">,</span> <span class="nu0">%10111111</span>
        ld              <span class="br0">&#91;</span>rNR21<span class="br0">&#93;</span><span class="sy1">,</span> a
        <span class="co1">; canal 2, envolvente, volumen inicial maximo, decreciente</span>
        ld              a<span class="sy1">,</span> <span class="nu0">%11110111</span>
        ld              <span class="br0">&#91;</span>rNR22<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
        <span class="co1">; canal 2, longitud activada y valor de la frecuencia alta</span>
        ld              a<span class="sy1">,</span> <span class="nu0">%01000110</span>            <span class="co1">; 1 en el bit 6, longitud activa, y</span>
        ld              <span class="br0">&#91;</span>rNR24<span class="br0">&#93;</span><span class="sy1">,</span> a              <span class="co1">; escribimos %110 en los tres bits altos de la frecuencia.</span>
&nbsp;
        <span class="kw1">ret</span>
&nbsp;
cambia_nota<span class="sy1">:</span>
        ld              a<span class="sy1">,</span> <span class="br0">&#91;</span>_CONT_MUS<span class="br0">&#93;</span>          <span class="co1">; vemos si hay que tocar la nota o esperar</span>
        cp              a<span class="sy1">,</span> _TEMPO
        jr              z<span class="sy1">,</span> <span class="sy1">.</span>toca_nota
        <span class="kw1">inc</span>             a
        ld              <span class="br0">&#91;</span>_CONT_MUS<span class="br0">&#93;</span><span class="sy1">,</span> a
        <span class="kw1">ret</span>
<span class="sy1">.</span>toca_nota<span class="sy1">:</span>
        <span class="co1">; reiniciamos el contador</span>
        ld              a<span class="sy1">,</span> <span class="nu0">0</span>
        ld              <span class="br0">&#91;</span>_CONT_MUS<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
        <span class="co1">; pasamos a tocar la nota</span>
        ld              a<span class="sy1">,</span> <span class="br0">&#91;</span>_NOTA<span class="br0">&#93;</span>              <span class="co1">; obtenemos el numero de nota a tocar</span>
        ld              c<span class="sy1">,</span> a                    <span class="co1">; lo guardamos</span>
        ld              b<span class="sy1">,</span> <span class="nu0">0</span>
        ld              hl<span class="sy1">,</span> Notas               <span class="co1">; en hl la dirección de las notas</span>
        <span class="kw1">add</span>             hl<span class="sy1">,</span> bc                  <span class="co1">; ahora tenemos la dirección de la nota a tocar</span>
        ld              a<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>                 <span class="co1">; cargamos la Nota</span>
        ld              <span class="br0">&#91;</span>rNR23<span class="br0">&#93;</span><span class="sy1">,</span> a              <span class="co1">; la escribimos en el registro de frecuencia del canal 2</span>
        <span class="co1">; reiniciamos la nota</span>
        ld              a<span class="sy1">,</span> <span class="br0">&#91;</span>rNR24<span class="br0">&#93;</span>
        set             <span class="nu0">7</span><span class="sy1">,</span>a
        ld              <span class="br0">&#91;</span>rNR24<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
        <span class="co1">; pasamos a la siguiente nota y comprobamos si tenemos que reiniciar</span>
        ld              a<span class="sy1">,</span> c
        <span class="kw1">inc</span>             a
        cp              a<span class="sy1">,</span> EndNotas <span class="sy1">-</span> Notas     <span class="co1">; hemos llegado al final?</span>
        jr              z<span class="sy1">,</span> <span class="sy1">.</span>resetea_notas
        <span class="co1">; no, guardamos y volvemos</span>
        ld              <span class="br0">&#91;</span>_NOTA<span class="br0">&#93;</span><span class="sy1">,</span> a
        <span class="kw1">ret</span>
<span class="sy1">.</span>resetea_notas<span class="sy1">:</span>
        <span class="co1">;si, reiniciarmos, guardamos y volvemos</span>
        ld              a<span class="sy1">,</span> <span class="nu0">0</span>
        ld              <span class="br0">&#91;</span>_NOTA<span class="br0">&#93;</span><span class="sy1">,</span> a
        <span class="kw1">ret</span>
&nbsp;
<span class="co1">; Datos de nuestros tiles</span>
Tiles<span class="sy1">:</span>
        <span class="kw5">DB</span>      <span class="sy2">$</span>AA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">44</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span>AA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">11</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>
        <span class="kw5">DB</span>      <span class="sy2">$</span>AA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">44</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span>AA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">11</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>
        <span class="kw5">DB</span>      <span class="sy2">$</span>3E<span class="sy1">,</span> <span class="sy2">$</span>3E<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">7F</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span>6B<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">7F</span>
        <span class="kw5">DB</span>      <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">63</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">7F</span><span class="sy1">,</span> <span class="sy2">$</span>3E<span class="sy1">,</span> <span class="sy2">$</span>3E<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>
EndTiles<span class="sy1">:</span>
&nbsp;
<span class="co1">; Datos de la musica</span>
<span class="co1">; Vamos a usar la quinta octava, porque sus valores comparten los mismos</span>
<span class="co1">; tres bits superiores, %110, asi no tendremos que variarlos.</span>
Notas<span class="sy1">:</span>
        <span class="co1">; 5ª Octava, Do, Re, Mi, Fa, Sol, La, Si (poniendo $6 en freq hi)</span>
        <span class="kw5">DB</span>      <span class="sy2">$</span>0A<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">42</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">72</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">89</span><span class="sy1">,</span> <span class="sy2">$</span>B2<span class="sy1">,</span> <span class="sy2">$</span>D6<span class="sy1">,</span> <span class="sy2">$</span>F7
EndNotas<span class="sy1">:</span></pre>
</dd></dl>

<p>
Y aqui la ROM por si quereis escucharlo:
<a href="../external.html?link=http://wiki.ladecadence.net/lib/exe/fetch.php?media=hola-sonido1.gb" class="media mediafile mf_gb" title="hola-sonido1.gb (32 KB)">hola-sonido1.gb</a>
</p>

</div>

<h1 class="sectionedit30" id="hola_color">Hola Color</h1>
<div class="level1">

<p>
Aunque este tutorial está pensando principalmente para la Gameboy Original (DMG y GBP), la Gameboy Color incorporó numerosas mejoras para satisfacer la demanda de recursos que implica añadir color a la arquitectura de la GameBoy. Principalmente tenemos por supuesto el color, una pantalla de la misma resolución que la GameBoy, 160&times;144 pixeles, pero con 32.768 colores posibles, con capacidad de mostrar 56 de ellos a la vez. Además duplica la velocidad del procesador hasta los 8.388Mhz (por defecto usa un modo compatible con la <abbr title="Gigabyte">GB</abbr> original a 4.194MHz), se incrementa la RAM interna hasta los 32K (en 8 bancos) y la memoria de vídeo hasta los 16K (en 2 bancos), y añade varios registros y zonas mapeadas en memoria para los datos de las paletas en color y algunas mejoras para el manejo de sprites.
</p>

<p>
Para empezar, en la definición de cabecera del juego deberemos de poner el byte $143 a $80 para especificar que la GameBoy arranque en modo Color. En el archivo gbhw.inc tenemos para ello una definición extra del macro que inserta la cabecera, llamado ROM_HEADER_COLOR. Después podemos comprobar si realmente estamos en una GameBoy Color. Para hacerlo podemos comprobar el registro <em>a</em> nada más empezar la ejecución del programa, antes de hacer nada. Si este registro contiene el valor $11 en hexadecimal, estamos ante una GameBoy Color. Además podría ser que estuvieramos usando una GameBoy Advance en modo GameBoy. Para saber si esto es asi, podemos comprobar además el registro <em>b</em>, si el bit 0 está a 1, es una GBA. Saber si es una GBA es importante porque los colores no son exactamente iguales que en la GBC habiendo cambios de brillo y saturación, por ello algunos juegos de GBC se ven horribles en una GBA. Si lo detectamos podemos usar paletas diferentes al ejecutar el juego en una GBA.  
También hay juegos que pueden correr tanto en GameBoy normal como en GameBoy Color, simplemente cargando o no las paletas de color y haciendo un buen uso de las tablas de paletas, con lo que podríamos diseñar nuestro juego de esa manera (un gran ejemplo es el Link&#039;s Awakening DX).
</p>

<p>
También debemos decidir si queremos usar el modo de doble velocidad de la GameBoy Color, para lo que debemos usar el registro rKEY1 ($FF4D), que nos permite ver el modo en que estamos actualmente, y en caso de requerirlo, pedir el cambio de modo. El modo de doble velocidad de 8.4MHz también consume más energía de nuestras pilas, asi que recomiendo no usarlo a no ser que sea necesario. Por defecto la GBC se inicia en el modo de velocidad normal. Para cambiar entre modos, da igual si es de uno a otro o de otro a uno, debemos de pedir el cambio escribiendo un 1 en el registro rKEY1 (previamente deberíamos comprobar en que modo estamos), y después usar una instrucción stop para que se produzca el cambio.
</p>

<p>
Luego deberemos cargar las paletas que vamos a usar. Al igual que en la GameBoy original, los objetos (tiles y sprites), pueden tener cuatro colores, pero estos cuatro colores se pueden elegir de entre 32768 colores (16 bit). Estos colores se definen en paletas de 4 colores, cada color formado por 2 bytes, de la siguiente manera: 
</p>
<pre class="code">XBBBBBGG GGGRRRRR : Blue Green Red</pre>

<p>
Los colores en la GBC no se mezclan de manera similar a como los veríamos en una pantalla moderna de ordenador, hay que tenerlo en cuenta a la hora de diseñar nuestras paletas. Afortunadamente, herramientas como el GBTD nos hacen una traducción de colores bastante fiel a la GBC real.
</p>

<p>
En total podemos tener 8 paletas para fondos y otras 8 para sprites. Para definir nuestras paletas, tenemos dos registros que nos ofrecen punteros a la tabla de paletas, <em>rBGPI</em> y <em>rOBPI</em>, uno a la tabla de paletas de fondos (tiles) y otro a la tabla de paletas de objetos (sprites). Estos registros junto con los registros de datos de paleta de fondo y de sprites, rBGPD y rOBPD, nos permiten escribir los datos de paleta de una manera sencilla empezando desde 0, y pudiendo definir que vayan haciendo autoincremento al escribir los datos en los registros de datos. Para ello ponemos a 1 el bit 7 de los registros rBGPI o rOBPI para que hagan autoincremento, y vamos escribiendo los datos de paleta en los registros rBGPD o rOBPD. En el programa de ejemplo a continuación, esto se hace en los bucles <em>.bucle_paleta_fondo</em> y <em>.bucle_paleta_sprites</em>. Defino una paleta para el fondo, al ser la única definida, los tiles de fondo que por defecto tendrán sus atributos de paleta a 0, usarán esta. Para los sprites, defino 8 paletas. Luego cuando se producen las “colisiones” con los lados de la pantalla (copiado del ejemplo “holasprite” visto anteriormente, lo que hago es cambiar la paleta a usar por el sprite. Habíamos visto que los sprites tenian una tabla de atributos, la <em>Sprite Atributte Table</em>, que definia las coordenadas X e Y, el número de sprite a usar, y un byte de atributos, cuyos bits 0 a 2 no se usaban en la GameBoy original. Pues son estos bits los que nos permiten seleccionar una paleta de las 8 disponibles. Para los fondos, que en la GameBoy original no tenian una entrada de atributos, en la GameBoy Color si la tienen, pero está en el banco extra de VRAM, asi que deberíamos cambiar al banco 1 de VRAM usando el registro rVBK (usando el bit 0, a 0 o a 1 para seleccionar banco 0 o 1), y escribir entonces en la dirección que estaría el mapa de fondos ($9800) definiremos atributos para cada uno de los tiles en la tabla de tiles (mapa) del banco 1. En el ejemplo sólo usamos una paleta de fondo, asi que no nos hace falta hacer esto. La tabla de atributos de fondo consistiria en bytes cada uno organizado de la siguiente manera:
</p>
<pre class="code">Bit 0-2  Numero de paleta de fondo  (BGP0-7)
Bit 3    Banco de RAM del tile      (0=Banco 0, 1=Baco 1)
Bit 4    No usado
Bit 5    Flip Horizontal            (0=Normal, 1=Espejar horizontalmente)
Bit 6    Flip Vertical              (0=Normal, 1=Espejar verticalmente)
Bit 7    Prioridad BG-to-OAM        (0=Usar el bit de prioridad OAM, 1=Prioridad de Fondos)</pre>

<p>
Ahora con el programa de ejemplo. En el bucle principal, uso una variable _SPR0_PAL para guardar el número de paleta a usar en cada momento por el sprite0, al principio de bucle aplico la paleta al sprite modificando los bits de sus atributos en la tabla, y cada vez que se produce una colisión incremento ese número teniendo en cuenta de resetearlo a 0 si llega a 8.
Con esto tenemos nuestra cara sonriente cambiando de color cada vez que “rebota” en los bordes de la pantalla.
</p>
<dl class="code">
<dt><a href="../external.html?link=http://wiki.ladecadence.net/doku.php?do=export_code&amp;id=tutorial_de_ensamblador&amp;codeblock=44" title="Descargar trozo de código fuente" class="mediafile mf_asm">holacolor.asm</a></dt>
<dd><pre class="code asm"><span class="co1">; Hola color</span>
<span class="co1">; David Pello 2018</span>
<span class="co1">; ladecadence.net</span>
<span class="co1">; Para el tutorial en:</span>
<span class="co1">; http://wiki.ladecadence.net/doku.php?id=tutorial_de_ensamblador</span>
&nbsp;
INCLUDE <span class="st0">&quot;gbhw.inc&quot;</span>          <span class="co1">; importamos el archivo de definiciones</span>
&nbsp;
<span class="co1">; definimos unas constantes para trabajar con nuestro sprite</span>
_SPR0_Y     <span class="kw5">EQU</span>     _OAMRAM <span class="co1">; la Y del sprite 0, es el inicio de la mem de sprites</span>
_SPR0_X     <span class="kw5">EQU</span>     _OAMRAM<span class="sy1">+</span><span class="nu0">1</span>
_SPR0_NUM   <span class="kw5">EQU</span>     _OAMRAM<span class="sy1">+</span><span class="nu0">2</span>
_SPR0_ATT   <span class="kw5">EQU</span>     _OAMRAM<span class="sy1">+</span><span class="nu0">3</span>
&nbsp;
<span class="co1">; creamos un par de variables para ver hacia donde tenemos que mover el sprite</span>
_MOVX       <span class="kw5">EQU</span>     _RAM    <span class="co1">; inicio de la ram dispobible para datos</span>
_MOVY       <span class="kw5">EQU</span>     _RAM<span class="sy1">+</span><span class="nu0">1</span>
<span class="co1">; y otra para guardar su paleta</span>
_SPR0_PAL   <span class="kw5">EQU</span>	    _RAM<span class="sy1">+</span><span class="nu0">2</span>
&nbsp;
<span class="co1">; El programa comienza aqui:</span>
<span class="kw5">SECTION</span> <span class="st0">&quot;start&quot;</span><span class="sy1">,</span>ROM0<span class="br0">&#91;</span><span class="sy2">$</span><span class="nu0">0100</span><span class="br0">&#93;</span>
    <span class="kw1">nop</span>
    <span class="kw1">jp</span>      inicio
&nbsp;
<span class="co1">; Cabecera de la ROM (Macro definido en gbhw.inc)</span>
<span class="co1">; define una rom de GBColor, sin mapper, de 32K y sin RAM, lo más básico</span>
    ROM_HEADER_COLOR  ROM_NOMBC<span class="sy1">,</span> ROM_SIZE_32KBYTE<span class="sy1">,</span> RAM_SIZE_0KBYTE
&nbsp;
<span class="co1">; aqui empieza nuestro programa</span>
inicio<span class="sy1">:</span>
    <span class="kw1">nop</span>
    <span class="kw4">di</span>                      <span class="co1">; deshabilita las interrupciones</span>
    ld      <span class="kw4">sp</span><span class="sy1">,</span> <span class="sy2">$</span>ffff       <span class="co1">; apuntamos la pila al tope de la ram</span>
&nbsp;
inicializacion<span class="sy1">:</span>
    <span class="kw1">call</span>    apaga_LCD       <span class="co1">; llamamos a la rutina que apaga el LCD</span>
&nbsp;
    <span class="co1">; Escribir datos de paleta</span>
    <span class="co1">; Fondos</span>
    ld	    a<span class="sy1">,</span> <span class="nu0">%10000000</span>    <span class="co1">; Primera dirección del indice, con autoincremento</span>
    ld      <span class="br0">&#91;</span>rBGPI<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    ld 	    hl<span class="sy1">,</span> PaletaFondo <span class="co1">; Dirección de los datos de paleta de fondo</span>
    ld      b<span class="sy1">,</span> <span class="nu0">4</span>	    <span class="co1">; Cuatro colores (8 bytes)</span>
&nbsp;
<span class="sy1">.</span>bucle_paleta_fondo<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>
    ld      <span class="br0">&#91;</span>rBGPD<span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="kw1">inc</span>	    hl
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>
    ld      <span class="br0">&#91;</span>rBGPD<span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="kw1">dec</span>     b
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>fin_bucle_paleta_fondo
    <span class="kw1">inc</span>     hl
    <span class="kw1">jp</span>      <span class="sy1">.</span>bucle_paleta_fondo
<span class="sy1">.</span>fin_bucle_paleta_fondo<span class="sy1">:</span>
&nbsp;
    <span class="co1">; Sprites</span>
    ld	    a<span class="sy1">,</span> <span class="nu0">%10000000</span>    <span class="co1">; Primera dirección del indice, con autoincremento</span>
    ld      <span class="br0">&#91;</span>rOBPI<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    ld 	    hl<span class="sy1">,</span> PaletaSprites
    ld      b<span class="sy1">,</span> <span class="nu0">4</span><span class="sy1">*</span><span class="nu0">8</span>	    <span class="co1">; 4 colores por 8 paletas</span>
&nbsp;
<span class="sy1">.</span>bucle_paleta_sprites<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>
    ld      <span class="br0">&#91;</span>rOBPD<span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="kw1">inc</span>	    hl
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>
    ld      <span class="br0">&#91;</span>rOBPD<span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="kw1">dec</span>     b
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>fin_bucle_paleta_sprites
    <span class="kw1">inc</span>     hl
    <span class="kw1">jp</span>      <span class="sy1">.</span>bucle_paleta_sprites
<span class="sy1">.</span>fin_bucle_paleta_sprites<span class="sy1">:</span>
&nbsp;
&nbsp;
    ld      a<span class="sy1">,</span> <span class="nu0">%11100100</span>    <span class="co1">; Colores de paleta desde el mas oscuro al</span>
                            <span class="co1">; más claro, 11 10 01 00</span>
    ld      <span class="br0">&#91;</span>rBGP<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; escribimos esto en el registro de paleta de fondo</span>
    ld	    a<span class="sy1">,</span> <span class="nu0">%01101100</span>
    ld      <span class="br0">&#91;</span>rOBP0<span class="br0">&#93;</span><span class="sy1">,</span> a      <span class="co1">; y en la paleta 0 de sprites</span>
&nbsp;
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>            <span class="co1">; escribimos 0 en los registros de scroll X e Y</span>
    ld      <span class="br0">&#91;</span>rSCX<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; con lo que posicionamos la pantalla visible</span>
    ld      <span class="br0">&#91;</span>rSCY<span class="br0">&#93;</span><span class="sy1">,</span> a       <span class="co1">; al inicio (arriba a la izq) del fondo.</span>
&nbsp;
&nbsp;
    <span class="co1">; cargamos los tiles en la memoria de tiles</span>
&nbsp;
    ld      hl<span class="sy1">,</span> Tiles       <span class="co1">; cargamos en HL la dirección de nuestro tile</span>
    ld      de<span class="sy1">,</span> _VRAM       <span class="co1">; en DE dirección de la memoria de video</span>
    ld      b<span class="sy1">,</span> <span class="nu0">32</span>           <span class="co1">; b = 32, numero de bytes a copiar (2 tiles)</span>
&nbsp;
<span class="sy1">.</span>bucle_carga<span class="sy1">:</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>hl<span class="br0">&#93;</span>          <span class="co1">; cargamos en A el dato apuntado por HL</span>
    ld      <span class="br0">&#91;</span>de<span class="br0">&#93;</span><span class="sy1">,</span> a         <span class="co1">; y lo metemos en la dirección apuntada en DE</span>
    <span class="kw1">dec</span>     b               <span class="co1">; decrementamos b, b=b-1</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>fin_bucle_carga <span class="co1">; si b = 0, terminamos, no queda nada por copiar</span>
    <span class="kw1">inc</span>     hl              <span class="co1">; incrementamos la dirección a leer de</span>
    <span class="kw1">inc</span>     de              <span class="co1">; incrementamos la dirección a escribir en</span>
    jr      <span class="sy1">.</span>bucle_carga    <span class="co1">; seguimos</span>
<span class="sy1">.</span>fin_bucle_carga<span class="sy1">:</span>
&nbsp;
    <span class="co1">; ahora limpiamos la pantalla (llenamos todo el mapa de fondo), con el tile 0</span>
&nbsp;
    ld      hl<span class="sy1">,</span> _SCRN0
    ld      de<span class="sy1">,</span> <span class="nu0">32</span><span class="sy1">*</span><span class="nu0">32</span>       <span class="co1">; numero de tiles en el mapa de fondo</span>
<span class="sy1">.</span>bucle_limpieza<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>            <span class="co1">; el tile 0 es nuestro tile vacio</span>
    ld      <span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> a
    <span class="kw1">dec</span>     de
    <span class="co1">; ahora tengo que comprobar si 'de' es cero, para ver si tengo que</span>
    <span class="co1">; terminar de copiar. 'dec de' no modifica ningún flag, asi que no puedo</span>
    <span class="co1">; comprobar el flag zero directamente, pero para que 'de' sea cero, d y e</span>
    <span class="co1">; tienen que ser cero los dos, asi que puedo hacer un or entre ellos,</span>
    <span class="co1">; y si el resultado es cero, ambos son cero.</span>
    ld      a<span class="sy1">,</span> d            <span class="co1">; cargamos d en a</span>
    <span class="kw1">or</span>      e               <span class="co1">; y hacemos un or con e</span>
    <span class="kw1">jp</span>      z<span class="sy1">,</span> <span class="sy1">.</span>fin_bucle_limpieza  <span class="co1">; si d OR e es cero, de es cero. Terminamos.</span>
    <span class="kw1">inc</span>     hl              <span class="co1">; incrementamos la dirección a escribir en</span>
    <span class="kw1">jp</span>      <span class="sy1">.</span>bucle_limpieza
<span class="sy1">.</span>fin_bucle_limpieza
&nbsp;
    <span class="co1">; bien, tenemos todo el mapa de tiles lleno con el tile 0,</span>
    <span class="co1">; ahora vamos a crear el sprite.</span>
&nbsp;
    ld      a<span class="sy1">,</span> <span class="nu0">30</span>
    ld      <span class="br0">&#91;</span>_SPR0_Y<span class="br0">&#93;</span><span class="sy1">,</span> a    <span class="co1">; posición Y del sprite</span>
    ld      a<span class="sy1">,</span> <span class="nu0">30</span>
    ld      <span class="br0">&#91;</span>_SPR0_X<span class="br0">&#93;</span><span class="sy1">,</span> a    <span class="co1">; posición X del sprite</span>
    ld      a<span class="sy1">,</span> <span class="nu0">1</span>
    ld      <span class="br0">&#91;</span>_SPR0_NUM<span class="br0">&#93;</span><span class="sy1">,</span> a  <span class="co1">; número de tile en la tabla de tiles que usaremos</span>
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>
    ld      <span class="br0">&#91;</span>_SPR0_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a  <span class="co1">; atributos especiales, de momento nada.</span>
&nbsp;
    <span class="co1">; configuramos y activamos el display</span>
    ld      a<span class="sy1">,</span> LCDCF_ON|LCDCF_BG8000|LCDCF_BG9800|LCDCF_BGON|LCDCF_OBJ8|LCDCF_OBJON
    ld      <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; preparamos las variables de la animacion</span>
    ld      a<span class="sy1">,</span> <span class="nu0">1</span>
    ld      <span class="br0">&#91;</span>_MOVX<span class="br0">&#93;</span><span class="sy1">,</span> a
    ld      <span class="br0">&#91;</span>_MOVY<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    ld	    a<span class="sy1">,</span> <span class="nu0">0</span>
    ld      <span class="br0">&#91;</span>_SPR0_PAL<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    <span class="co1">; bucle infinito</span>
animacion<span class="sy1">:</span>
    <span class="co1">; lo primero, esperamos por el VBlank, ya que no podemos modificar</span>
    <span class="co1">; la VRAM fuera de él, o pasarán cosas raras</span>
<span class="sy1">.</span>wait<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rLY<span class="br0">&#93;</span>
    cp      <span class="nu0">145</span>
    jr      nz<span class="sy1">,</span> <span class="sy1">.</span>wait
&nbsp;
    <span class="co1">; cambiamos la paleta del objeto 0</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_SPR0_ATT<span class="br0">&#93;</span>	<span class="co1">; cargamos los atributos del objeto 0</span>
    <span class="kw1">and</span>     a<span class="sy1">,</span> <span class="nu0">%11111000</span>        <span class="co1">; borramos los tres primeros bits (paleta)</span>
    ld      hl<span class="sy1">,</span> _SPR0_PAL       <span class="co1">; cargamos en b la paleta actual</span>
    ld      b<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>	
    <span class="kw1">or</span>      b			<span class="co1">; hacemos un OR con a para añadir la paleta</span>
    ld      <span class="br0">&#91;</span>_SPR0_ATT<span class="br0">&#93;</span><span class="sy1">,</span> a      <span class="co1">; lo escribimos</span>
&nbsp;
    <span class="co1">; incrementamos las y</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_SPR0_Y<span class="br0">&#93;</span>    <span class="co1">; cargamos la posición Y actual del sprite</span>
    ld      hl<span class="sy1">,</span> _MOVY       <span class="co1">; en hl, la dirección del incremento Y</span>
    <span class="kw1">add</span>     a<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>         <span class="co1">; sumamos</span>
    ld      hl<span class="sy1">,</span> _SPR0_Y
    ld      <span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> a         <span class="co1">; guardamos</span>
    <span class="co1">; comparamos para ver si hay que cambiar el sentido</span>
    cp      <span class="nu0">152</span>             <span class="co1">; para que no se salga de la pantalla (max Y)</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>dec_y
    cp      <span class="nu0">16</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>inc_y       <span class="co1">; lo mismo, minima coord Y=16</span>
    <span class="co1">; no hay que cambiar</span>
    jr      <span class="sy1">.</span>end_y
<span class="sy1">.</span>dec_y<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="sy1">-</span><span class="nu0">1</span>           <span class="co1">; ahora hay que decrementar las Y</span>
    ld      <span class="br0">&#91;</span>_MOVY<span class="br0">&#93;</span><span class="sy1">,</span> a
			    <span class="co1">; y cambiar la paleta</span>
    ld      hl<span class="sy1">,</span> _SPR0_PAL
    <span class="kw1">inc</span>	    <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>
    jr      <span class="sy1">.</span>end_y
<span class="sy1">.</span>inc_y<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="nu0">1</span>            <span class="co1">; ahora hay que incrementar las Y</span>
    ld      <span class="br0">&#91;</span>_MOVY<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    ld      hl<span class="sy1">,</span> _SPR0_PAL    <span class="co1">; y cambiar la paleta</span>
    <span class="kw1">inc</span>	    <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>
&nbsp;
<span class="sy1">.</span>end_y<span class="sy1">:</span>
    <span class="co1">; vamos con las X, lo mismo pero cambiando los márgenes</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_SPR0_X<span class="br0">&#93;</span>    <span class="co1">; cargamos la posición X actual del sprite</span>
    ld      hl<span class="sy1">,</span> _MOVX       <span class="co1">; en hl, la dirección del incremento X</span>
    <span class="kw1">add</span>     a<span class="sy1">,</span> <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>         <span class="co1">; sumamos</span>
    ld      hl<span class="sy1">,</span> _SPR0_X
    ld      <span class="br0">&#91;</span>hl<span class="br0">&#93;</span><span class="sy1">,</span> a         <span class="co1">; guardamos</span>
    <span class="co1">; comparamos para ver si hay que cambiar el sentido</span>
    cp      <span class="nu0">160</span>             <span class="co1">; para que no se salga de la pantalla (max X)</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>dec_x
    cp      <span class="nu0">8</span>               <span class="co1">; lo mismo, minima coord izq = 8</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>inc_x
    <span class="co1">; no hay que cambiar</span>
    jr      <span class="sy1">.</span>end_x
<span class="sy1">.</span>dec_x<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="sy1">-</span><span class="nu0">1</span>           <span class="co1">; ahora hay que decrementar las X</span>
    ld      <span class="br0">&#91;</span>_MOVX<span class="br0">&#93;</span><span class="sy1">,</span> a
    ld      hl<span class="sy1">,</span> _SPR0_PAL    <span class="co1">; y cambiar la paleta</span>
    <span class="kw1">inc</span>	    <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>
    jr      <span class="sy1">.</span>end_x
<span class="sy1">.</span>inc_x<span class="sy1">:</span>
    ld      a<span class="sy1">,</span> <span class="nu0">1</span>            <span class="co1">; ahora hay que incrementar las X</span>
    ld      <span class="br0">&#91;</span>_MOVX<span class="br0">&#93;</span><span class="sy1">,</span> a
&nbsp;
    ld      hl<span class="sy1">,</span> _SPR0_PAL    <span class="co1">; y cambiar la paleta</span>
    <span class="kw1">inc</span>	    <span class="br0">&#91;</span>hl<span class="br0">&#93;</span>
&nbsp;
<span class="sy1">.</span>end_x<span class="sy1">:</span>
    <span class="co1">; probar que no nos hemos pasado del limite de paletas (8)</span>
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>_SPR0_PAL<span class="br0">&#93;</span>
    cp      <span class="nu0">8</span>
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>reset_spr_pal
    jr      <span class="sy1">.</span>end_anim
<span class="sy1">.</span>reset_spr_pal
    ld      a<span class="sy1">,</span> <span class="nu0">0</span>
    ld      <span class="br0">&#91;</span>_SPR0_PAL<span class="br0">&#93;</span><span class="sy1">,</span> a
<span class="sy1">.</span>end_anim
    <span class="co1">; un pequeño retardo</span>
    <span class="kw1">call</span> retardo
    <span class="co1">; volvemos a empezar</span>
    jr      animacion
&nbsp;
<span class="co1">; Rutina de apagado del LCD</span>
apaga_LCD<span class="sy1">:</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>
    rlca                    <span class="co1">; Pone el bit alto de LCDC en el flag de acarreo</span>
    <span class="kw1">ret</span>     nc              <span class="co1">; La pantalla ya está apagada, volver.</span>
&nbsp;
    <span class="co1">; esperamos al VBlank, ya que no podemos apagar la pantalla</span>
    <span class="co1">; en otro momento</span>
&nbsp;
<span class="sy1">.</span>espera_VBlank
    ld      a<span class="sy1">,</span> <span class="br0">&#91;</span>rLY<span class="br0">&#93;</span>
    cp      <span class="nu0">145</span>
    jr      nz<span class="sy1">,</span> <span class="sy1">.</span>espera_VBlank
&nbsp;
    <span class="co1">; estamos en VBlank, apagamos el LCD</span>
    ld      a<span class="sy1">,</span><span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span>       <span class="co1">; en A, el contenido del LCDC</span>
    res     <span class="nu0">7</span><span class="sy1">,</span>a             <span class="co1">; ponemos a cero el bit 7 (activado del LCD)</span>
    ld      <span class="br0">&#91;</span>rLCDC<span class="br0">&#93;</span><span class="sy1">,</span>a       <span class="co1">; escribimos en el registro LCDC el contenido de A</span>
&nbsp;
    <span class="kw1">ret</span>                     <span class="co1">; volvemos</span>
&nbsp;
<span class="co1">; rutina de retardo</span>
retardo<span class="sy1">:</span>
    ld      de<span class="sy1">,</span> <span class="nu0">2000</span>        <span class="co1">; numero de veces a ejecutar el bucle</span>
<span class="sy1">.</span>delay<span class="sy1">:</span>
    <span class="kw1">dec</span>     de              <span class="co1">; decrementamos</span>
    ld      a<span class="sy1">,</span> d            <span class="co1">; vemos si es cero</span>
    <span class="kw1">or</span>      e
    jr      z<span class="sy1">,</span> <span class="sy1">.</span>fin_delay
    <span class="kw1">nop</span>
    jr      <span class="sy1">.</span>delay
<span class="sy1">.</span>fin_delay<span class="sy1">:</span>
    <span class="kw1">ret</span>
&nbsp;
<span class="co1">; Datos de nuestros tiles</span>
Tiles<span class="sy1">:</span>
    <span class="kw5">DB</span>  <span class="sy2">$</span>AA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">44</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span>AA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">11</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>
    <span class="kw5">DB</span>  <span class="sy2">$</span>AA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">44</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span>AA<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">11</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>
    <span class="kw5">DB</span>  <span class="sy2">$</span>3E<span class="sy1">,</span> <span class="sy2">$</span>3E<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">7F</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span>6B<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">7F</span>
    <span class="kw5">DB</span>  <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">63</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">41</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">7F</span><span class="sy1">,</span> <span class="sy2">$</span>3E<span class="sy1">,</span> <span class="sy2">$</span>3E<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span><span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">00</span>
EndTiles<span class="sy1">:</span>
&nbsp;
PaletaFondo<span class="sy1">:</span>
    <span class="kw5">DW</span>  <span class="sy2">$</span>76BD<span class="sy1">,</span> <span class="sy2">$</span>753D<span class="sy1">,</span> <span class="sy2">$</span>14B4<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">0019</span>
EndPaletaFondo<span class="sy1">:</span>
&nbsp;
PaletaSprites<span class="sy1">:</span>
    <span class="kw5">DW</span> <span class="sy2">$</span>77DF<span class="sy1">,</span> <span class="sy2">$</span>47EB<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">7101</span><span class="sy1">,</span> <span class="sy2">$</span>14BD
    <span class="kw5">DW</span> <span class="sy2">$</span><span class="nu0">0003</span><span class="sy1">,</span> <span class="sy2">$</span>5B63<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">0204</span><span class="sy1">,</span> <span class="sy2">$</span>D671
    <span class="kw5">DW</span> <span class="sy2">$</span>A5D4<span class="sy1">,</span> <span class="sy2">$</span>BBFD<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">9569</span><span class="sy1">,</span> <span class="sy2">$</span>FFE3
    <span class="kw5">DW</span> <span class="sy2">$</span><span class="nu0">2014</span><span class="sy1">,</span> <span class="sy2">$</span>3B09<span class="sy1">,</span> <span class="sy2">$</span>4A8E<span class="sy1">,</span> <span class="sy2">$</span>934A
    <span class="kw5">DW</span> <span class="sy2">$</span><span class="nu0">0416</span><span class="sy1">,</span> <span class="sy2">$</span>96BE<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">0164</span><span class="sy1">,</span> <span class="sy2">$</span>B9DA
    <span class="kw5">DW</span> <span class="sy2">$</span>9B62<span class="sy1">,</span> <span class="sy2">$</span>35DF<span class="sy1">,</span> <span class="sy2">$</span>10B2<span class="sy1">,</span> <span class="sy2">$</span>D12F
    <span class="kw5">DW</span> <span class="sy2">$</span><span class="nu0">1E09</span><span class="sy1">,</span> <span class="sy2">$</span>F91B<span class="sy1">,</span> <span class="sy2">$</span><span class="nu0">0445</span><span class="sy1">,</span> <span class="sy2">$</span>48F9
    <span class="kw5">DW</span> <span class="sy2">$</span>840E<span class="sy1">,</span> <span class="sy2">$</span>D972<span class="sy1">,</span> <span class="sy2">$</span>0A15<span class="sy1">,</span> <span class="sy2">$</span>AF6F
EndPaletaSprites<span class="sy1">:</span></pre>
</dd></dl>

<p>
<a href="../external.html?link=http://wiki.ladecadence.net/lib/exe/detail.php?id=tutorial_de_ensamblador&amp;media=holacolor-1.png" class="media" title="holacolor-1.png"><img src="../external.html?link=http://wiki.ladecadence.net/lib/exe/fetch.php?media=holacolor-1.png" class="media" alt="" /></a> <a href="../external.html?link=http://wiki.ladecadence.net/lib/exe/detail.php?id=tutorial_de_ensamblador&amp;media=holacolor-0.png" class="media" title="holacolor-0.png"><img src="../external.html?link=http://wiki.ladecadence.net/lib/exe/fetch.php?media=holacolor-0.png" class="media" alt="" /></a>
</p>

<p>
La ROM: <a href="../external.html?link=http://wiki.ladecadence.net/lib/exe/fetch.php?media=holacolor.gb" class="media mediafile mf_gb" title="holacolor.gb (32 KB)">holacolor.gb</a>
</p>

</div>

                    <!-- wikipage stop -->
                                    </div>

                <div class="docInfo"><bdi>tutorial_de_ensamblador.txt</bdi> · Última modificación: 13/03/2018 11:09 por <bdi>zako</bdi></div>

                            </div></div><!-- /content -->

            <hr class="a11y" />

            <!-- PAGE ACTIONS -->
            <div id="dokuwiki__pagetools">
                <h3 class="a11y">Herramientas de la página</h3>
                <div class="tools">
                    <ul>
                        <li><a href="../external.html?link=http://wiki.ladecadence.net/doku.php?id=tutorial_de_ensamblador&amp;do=edit"  class="action source" accesskey="v" rel="nofollow" title="Ver la fuente de esta página [V]"><span>Ver la fuente de esta página</span></a></li><li><a href="../external.html?link=http://wiki.ladecadence.net/doku.php?id=tutorial_de_ensamblador&amp;do=revisions"  class="action revs" accesskey="o" rel="nofollow" title="Revisiones antiguas [O]"><span>Revisiones antiguas</span></a></li><li><a href="../external.html?link=http://wiki.ladecadence.net/doku.php?id=tutorial_de_ensamblador&amp;do=backlink"  class="action backlink" rel="nofollow" title="Enlaces a esta página"><span>Enlaces a esta página</span></a></li><li><a href="#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Volver arriba [T]"><span>Volver arriba</span></a></li>                    </ul>
                </div>
            </div>
        </div><!-- /wrapper -->

        
<!-- ********** FOOTER ********** -->
<div id="dokuwiki__footer"><div class="pad">
    <div class="license">Excepto donde se indique lo contrario, el contenido de este wiki esta bajo la siguiente licencia: <bdi><a href="../external.html?link=http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="license" class="urlextern">CC Attribution-Noncommercial-Share Alike 4.0 International</a></bdi></div>
    <div class="buttons">
        <a href="../external.html?link=http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="license"><img src="../external.html?link=http://wiki.ladecadence.net/lib/images/license/button/cc-by-nc-sa.png" alt="CC Attribution-Noncommercial-Share Alike 4.0 International" /></a>        <a href="../external.html?link=http://www.dokuwiki.org/donate" title="Donate" ><img
            src="../external.gif?link=http://wiki.ladecadence.net/lib/tpl/dokuwiki/images/button-donate.gif" width="80" height="15" alt="Donate" /></a>
        <a href="../external.html?link=http://php.net/" title="Powered by PHP" ><img
            src="../external.gif?link=http://wiki.ladecadence.net/lib/tpl/dokuwiki/images/button-php.gif" width="80" height="15" alt="Powered by PHP" /></a>
        <a href="../external.html?link=http://validator.w3.org/check/referer" title="Valid HTML5" ><img
            src="../external.html?link=http://wiki.ladecadence.net/lib/tpl/dokuwiki/images/button-html5.png" width="80" height="15" alt="Valid HTML5" /></a>
        <a href="../external.html?link=http://jigsaw.w3.org/css-validator/check/referer?profile=css3" title="Valid CSS" ><img
            src="../external.html?link=http://wiki.ladecadence.net/lib/tpl/dokuwiki/images/button-css.png" width="80" height="15" alt="Valid CSS" /></a>
        <a href="../external.html?link=http://dokuwiki.org/" title="Driven by DokuWiki" ><img
            src="../external.html?link=http://wiki.ladecadence.net/lib/tpl/dokuwiki/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" /></a>
    </div>
</div></div><!-- /footer -->

    </div></div><!-- /site -->

    <div class="no"><img src="../external.html?link=http://wiki.ladecadence.net/lib/exe/indexer.php?id=tutorial_de_ensamblador&amp;1555209396" width="2" height="1" alt="" /></div>
    <div id="screen__mode" class="no"></div></body>

<!-- Mirrored from wiki.ladecadence.net/doku.php?id=tutorial_de_ensamblador by HTTraQt Website Copier/1.x [Karbofos 2012-2017] Sun, 14 Apr 2019 02:34:08 GMT -->
</html>
